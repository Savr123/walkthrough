/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/m/MessageToast","sap/m/MessageItem","sap/m/MessageView","sap/m/Button","sap/m/Dialog","sap/ui/core/MessageType","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(M,a,b,B,D,c,F,d){'use strict';var t=this;function f(){var p;function i(P){return P.property?'( ${'+P.property+'} ? ("<p>'+P.property.substr(Math.max(P.property.lastIndexOf('/'),P.property.lastIndexOf('.'))+1)+' : " + '+'${'+P.property+'} + "<p/>") : "" )':'';}function k(P){var H='';if(P.groupName&&P.property&&P.groupName!==p){H+='( ${'+P.property+'} ? "<br/><h3>'+P.groupName+'</h3>" : "" ) + ';p=P.groupName;}return H;}function l(){var T="technicalDetails";return[{'groupName':'','property':T+"/status"},{'groupName':'','property':T+"/statusText"},{'groupName':'Application','property':T+"/error/@SAP__common.Application/ComponentId"},{'groupName':'Application','property':T+"/error/@SAP__common.Application/ServiceId"},{'groupName':'Application','property':T+"/error/@SAP__common.Application/ServiceRepository"},{'groupName':'Application','property':T+"/error/@SAP__common.Application/ServiceVersion"},{'groupName':'ErrorResolution','property':T+"/error/@SAP__common.ErrorResolution/Analysis"},{'groupName':'ErrorResolution','property':T+"/error/@SAP__common.ErrorResolution/Note"},{'groupName':'ErrorResolution','property':T+"/error/@SAP__common.ErrorResolution/DetailedNote"},{'groupName':'ErrorResolution','property':T+"/error/@SAP__common.ExceptionCategory"},{'groupName':'ErrorResolution','property':T+"/error/@SAP__common.TimeStamp"},{'groupName':'ErrorResolution','property':T+"/error/@SAP__common.TransactionId"},{'groupName':'Messages','property':T+"/error/code"},{'groupName':'Messages','property':T+"/error/message"}];}var H='Object.keys('+'${technicalDetails}'+').length > 0 ? "<h2>Technical Details</h2>" : "" ';l().forEach(function(P){H=H+k(P)+''+i(P)+' + ';});return H;}function e(){var H='(${'+'description} ? ("<h2>Description</h2>" + ${'+'description}) : "")';return H;}function s(p){p=p||{};var u=h(p.includeBoundMessages),o=sap.ui.getCore().getMessageManager(),i=[];if(u.length===0&&!p.additionalMessages){return Promise.resolve(true);}else if(u.length===1&&u[0].getType()===c.Success&&!p.additionalMessages){return new Promise(function(k,l){M.show(u[0].message);o.removeMessages(u);});}else{return new Promise(function(k,l){t.resolve=k;t.includeBoundMessages=p.includeBoundMessages;sap.ui.getCore().getLibraryResourceBundle("sap.fe",true).then(function(R){t.oMessageTemplate=t.oMessageTemplate||new a({counter:'{counter}',title:'{message}',subtitle:'{additionalText}',longtextUrl:'{descriptionUrl}',type:'{type}',description:'{= ${'+'description} || ${technicalDetails} ? '+'"<html><body>" + '+e()+' + '+f()+'"</body></html>"'+' : "" }',markupDescription:true});i.push(new F({path:'target',operator:d.EQ,value1:''}));if(p.includeBoundMessages){i.push(new F({path:'target',operator:d.EQ,value1:p.includeBoundMessages}));}if(t.oMessageView){t.oMessageView.getBinding("items").filter(i);}t.oMessageView=t.oMessageView||new b({showDetailsPageHeader:false,itemSelect:function(){t.oBackButton.setVisible(true);},items:{path:'/',filters:[new F({filters:i,and:false})],template:t.oMessageTemplate}});t.oBackButton=t.oBackButton||new B({icon:sap.ui.core.IconPool.getIconURI("nav-back"),visible:false,press:function(){t.oMessageView.navigateBack();this.setVisible(false);}});if(p.additionalMessages&&p.additionalMessages.length){p.additionalMessages.forEach(function(n){o.addMessages(new sap.ui.core.message.Message({message:n.text,type:n.type,target:'',persistent:true}));});}t.oMessageView.setModel(o.getMessageModel());t.oDialog=t.oDialog||new D({resizable:true,content:t.oMessageView,state:'Error',beginButton:new B({press:function(){t.oDialog.close();r();if(t.includeBoundMessages){g(t.includeBoundMessages);}},text:R.getText('SAPFE_CLOSE')}),customHeader:new sap.m.Bar({contentMiddle:[new sap.m.Text({text:R.getText('SAPFE_ERROR')})],contentLeft:[t.oBackButton]}),contentWidth:"37.5em",contentHeight:"21.5em",verticalScrolling:false,afterClose:function(E){t.resolve();}});t.oDialog.open();});});}}function r(){j();}function g(T){j(T);}function h(T,k){var o=sap.ui.getCore().getMessageManager(),l=o.getMessageModel(),n=l.getObject('/'),p=[];for(var i=0;i<n.length;i++){if((!k||n[i].persistent)&&(n[i].target===T||n[i].target==='')){p.push(n[i]);}}return p;}function j(T){var i=h(T,true);if(i.length>0){sap.ui.getCore().getMessageManager().removeMessages(i);}}var m={showUnboundMessages:s,removeUnboundTransitionMessages:r,removeBoundTransitionMessages:g};return m;});
