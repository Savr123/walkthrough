/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(['sap/ui/thirdparty/jquery','sap/ui/model/json/JSONModel','sap/ui/model/base/ManagedObjectModel','sap/ui/model/resource/ResourceModel','sap/ui/core/cache/CacheManager',"sap/base/Log",'sap/ui/core/mvc/View'],function(q,J,M,R,C,L,V){"use strict";var r=new R({bundleName:"sap.fe.messagebundle",async:true}),o=new Promise(function(b,d){r.attachRequestCompleted(b);});function a(n,i){this.name=n;this.currentPath=i||'';this.lastPath='';this.set=function(N){while(N.indexOf('../')===0){this.currentPath=this.currentPath.substr(0,this.currentPath.lastIndexOf(this.lastPath)-1);this.lastPath=this.currentPath.substr(this.currentPath.lastIndexOf('/')+1);N=N.substr(3);}if(N){this.lastPath=N;}this.currentPath+=N;L.info(this.name+' is now : '+this.currentPath);};this.get=function(){return this.currentPath;};this.delete=function(){this.currentPath='';L.info(this.name+' has been deleted');};}function c(p){var s=p.viewName,A=p.appComponent,e=p.entitySet,m=p.viewData,b=p.model.getMetaModel(),S=p.viewId,d;var k=A.getMetadata().getName()+"_"+S+"_"+sap.ui.getCore().getConfiguration().getLanguageTag(),P=[];P.push(Promise.all([C.get(k),b.requestObject("/")]).then(function(f){var g=f[0];function h(u,j){var E=b.getETags();return new Promise(function(l,n){if(!E[u]){q.ajax(u,{method:'GET'}).then(function(t,T,w){if(j!==w.getResponseHeader('ETag')&&j!==w.getResponseHeader('Last-Modified')){l(false);}else{l(true);}},function(t,T,w){l(false);});}else if(j!==E[u]){l(false);}else{l(true);}});}function i(j){var l=[];Object.keys(j).forEach(function(u){l.push(h(u,j[u]));});return Promise.all(l);}if(g){return i(JSON.parse(g.newCacheKey)).then(function(j){d=g.newCacheKey;if(j.every(function(l){return l;})){return{keys:[g.oldCacheKey]};}else{return{keys:[d]};}});}else{d='initial';var E=b.getETags();Object.keys(E).forEach(function(u){if(!E[u]){d=null;}});return{keys:[d]};}}).catch(function(f){return{keys:[null]};}));P.push(o);return Promise.all(P).then(function(f){var D=new J(sap.ui.Device),g=new J(A.getMetadata().getManifest()),h=new J(m),i=new J({currentPath:new a('CurrentPath','/'),navigationPath:new a('NavigationPath')}),j={type:"XML",preprocessors:{xml:{bindingContexts:{entitySet:e?b.createBindingContext("/"+e):null,viewData:m?h.createBindingContext("/"):null},models:{entitySet:b,'sap.fe.i18n':r,'sap.ui.mdc.metaModel':b,'sap.fe.deviceModel':D,'manifest':g,'viewData':h,'metaPath':i}}},id:S,viewName:s,viewData:m,cache:f[0]||{keys:[null]},height:"100%"};D.setDefaultBindingMode("OneWay");return A.runAsOwner(function(){return V.create(j).then(function(l){l.setModel(new M(l),"$view");var n=JSON.stringify(b.getETags());if(d&&d!==n){var t={};t.newCacheKey=n;t.oldCacheKey=d;C.set(k,t);}return l;});});});}var v={create:c};return v;});
