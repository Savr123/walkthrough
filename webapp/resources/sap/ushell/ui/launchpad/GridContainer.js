// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Control","sap/ui/core/Icon","sap/m/Input","sap/m/Text","sap/ushell/resources","sap/f/GridContainer","sap/f/GridContainerSettings","sap/f/GridContainerItemLayoutData","sap/ushell/utils","sap/ushell/ui/launchpad/Tile","sap/m/library","sap/ushell/library","sap/ushell/ui/launchpad/GridContainerRenderer"],function(C,I,a,T,r,U,b,c,d,e,m){"use strict";var H=m.HeaderLevel;var G=C.extend("sap.ushell.ui.launchpad.GridContainer",{metadata:{library:"sap.ushell",properties:{groupId:{type:"string",group:"Misc",defaultValue:null},showHeader:{type:"boolean",group:"Misc",defaultValue:true},defaultGroup:{type:"boolean",group:"Misc",defaultValue:false},isLastGroup:{type:"boolean",group:"Misc",defaultValue:false},headerText:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.m.HeaderLevel",group:"Misc",defaultValue:H.H2},groupHeaderLevel:{type:"sap.m.HeaderLevel",group:"Misc",defaultValue:H.H4},showGroupHeader:{type:"boolean",group:"Misc",defaultValue:true},homePageGroupDisplay:{type:"string",defaultValue:null},isGroupLocked:{type:"boolean",group:"Misc",defaultValue:null},isGroupSelected:{type:"boolean",group:"Misc",defaultValue:false},editMode:{type:"boolean",group:"Misc",defaultValue:false},showBackground:{type:"boolean",group:"Misc",defaultValue:false},icon:{type:"string",group:"Misc",defaultValue:"sap-icon://locked"},showIcon:{type:"boolean",group:"Misc",defaultValue:false},enableHelp:{type:"boolean",group:"Misc",defaultValue:false},tileActionModeActive:{type:"boolean",group:"Misc",defaultValue:false},ieHtml5DnD:{type:"boolean",group:"Misc",defaultValue:false},showEmptyLinksArea:{type:"boolean",group:"Misc",defaultValue:false},showEmptyLinksAreaPlaceHolder:{type:"boolean",group:"Misc",defaultValue:false},supportLinkPersonalization:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{tiles:{type:"sap.ui.core.Control",multiple:true,singularName:"tile",forwarding:{getter:"_getInternalGrid",aggregation:"items"}},links:{type:"sap.ui.core.Control",multiple:true,singularName:"link"},_grid:{type:"sap.f.GridContainer",multiple:false,visibility:"hidden"},beforeContent:{type:"sap.ui.core.Control",multiple:true,singularName:"beforeContent"},afterContent:{type:"sap.ui.core.Control",multiple:true,singularName:"afterContent"},footerContent:{type:"sap.ui.core.Control",multiple:true,singularName:"footerContent"},headerActions:{type:"sap.ui.core.Control",multiple:true,singularName:"headerAction"}},events:{afterRendering:{},titleChange:{}}}});G.prototype.init=function(){this.setAggregation("_grid",new U({snapToRow:true,layout:new b({rowSize:"5.25rem",columnSize:"5.25rem",gap:"0.5rem"}),layoutS:new b({rowSize:"4.375rem",columnSize:"4.375rem",gap:"0.5rem"})}));this.oNoLinksText=new T({text:r.i18n.getText("emptyLinkContainerInEditMode")}).addStyleClass("sapUshellNoLinksAreaPresentTextInner");this.oTransformationErrorText=new T({text:r.i18n.getText("transformationErrorText")}).addStyleClass("sapUshellTransformationErrorText");this.oTransformationErrorIcon=new I({src:"sap-icon://message-error"}).addStyleClass("sapUshellTransformationErrorIcon");this.oIcon=new I({src:this.getIcon()});this.oIcon.addStyleClass("sapUshellContainerIcon");this.oEditInputField=new a({placeholder:r.i18n.getText("new_group_name"),value:this.getHeaderText()}).addStyleClass("sapUshellTileContainerTitleInput");this.oEditInputField.addEventDelegate({onfocusout:this.setEditMode.bind(this,false),onsapenter:this.setEditMode.bind(this,false)});};G.prototype.exit=function(){if(this.oNoLinksText){this.oNoLinksText.destroy();}if(this.oTransformationErrorText){this.oTransformationErrorText.destroy();}if(this.oTransformationErrorIcon){this.oTransformationErrorIcon.destroy();}if(this.oIcon){this.oIcon.destroy();}if(this.oEditInputField){this.oEditInputField.destroy();}C.prototype.exit.apply(this,arguments);};G.prototype.onAfterRendering=function(){var t=this;var o=window.document.getElementById(this.getId()+"-titleText");if(o){o.addEventListener("click",function(){var f=t.getModel()&&t.getModel().getProperty("/enableRenameLockedGroup"),g=(f||!t.getIsGroupLocked())&&!t.getDefaultGroup()&&t.getTileActionModeActive();t.setEditMode(g);});}var E=this.oEditInputField.getDomRef();if(E){setTimeout(function(){E.querySelector("input").focus();},100);}this.fireAfterRendering();};G.prototype.getShowPlaceholder=function(){return false;};G.prototype.setGroupId=function(v){this.setProperty("groupId",v,true);return this;};G.prototype.groupHasTiles=function(){var t=this.getTiles();if(this.getBindingContext()){var p=this.getBindingContext().sPath;t=this.getModel().getProperty(p).tiles;}return d.groupHasVisibleTiles(t,[]);};G.prototype.getInnerContainersDomRefs=function(){var o=this.getDomRef();if(!o){return null;}var i=o.querySelector(".sapUshellTilesContainer-sortable"),l=o.querySelector(".sapUshellLineModeContainer");return[i,l];};G.prototype.setEditMode=function(v){if(this.getEditMode()===v){return;}this.setProperty("editMode",v,false);this.getModel().setProperty("/editTitle",v,false);if(v){this.addStyleClass("sapUshellEditing");this.oEditInputField.setValue(this.getHeaderText());var E=sap.ui.getCore().getEventBus();E.publish("launchpad","scrollToGroup",{group:this,groupChanged:false,focus:false});}else{this.removeStyleClass("sapUshellEditing");var n=this.oEditInputField.getValue();n=n.substring(0,256).trim()||this.oEditInputField.getPlaceholder();if(n!==this.getHeaderText()){this.fireTitleChange({newTitle:n});this.setHeaderText(n);}}};G.prototype.setShowEmptyLinksArea=function(v){this.setProperty("showEmptyLinksArea",v,true);this.toggleStyleClass("sapUshellLinksAreaHidden",!v);};G.prototype.setShowEmptyLinksAreaPlaceHolder=function(v){this.setProperty("showEmptyLinksArea",v,true);this.toggleStyleClass("sapUshellTileContainerEditMode",v);this.toggleStyleClass("sapUshellTileContainerTabsModeEmptyLinksArea",v);this.toggleStyleClass("sapUshellEmptyLinksAreaPlaceHolder",!v);};G.prototype._getInternalGrid=function(){return this.getAggregation("_grid");};G.prototype.addAggregation=function(A,o){C.prototype.addAggregation.apply(this,arguments);if(A==="tiles"){this._addItemLayoutData(o);}return this;};G.prototype.insertAggregation=function(A,o,i){C.prototype.insertAggregation.apply(this,arguments);if(A==="tiles"){this._addItemLayoutData(o);}return this;};G.prototype._addItemLayoutData=function(i){var l,o;if(i instanceof e){l={rows:2,columns:{path:"long",formatter:G._getItemLayoutColumn}};}else{var f=i.getManifest(),s=d.getMember(f,"sap|flp.rows")||3,g=d.getMember(f,"sap|flp.columns")||3;l={rows:parseInt(s,10),columns:parseInt(g,10)};}o=new c(l);i.setLayoutData(o);};G._getItemLayoutColumn=function(l){return l?4:2;};return G;});
