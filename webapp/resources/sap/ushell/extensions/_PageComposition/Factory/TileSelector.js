// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/model/json/JSONModel","sap/ushell/extensions/_PageComposition/Factory/utils","sap/ushell/ui/pagecomposer/TileSelector.controller"],function(J,f,t){"use strict";var F=null;function s(L,g){function a(b){var S=sap.ui.getCore().byId("viewPortContainer");if(S){S.setBusy(b);}}return new Promise(function(r,R){if(!F){a(true);var m=new J({groupTitle:g,searchText:"",catalogTiles:[]});F=f.setupXMLFragment("sap.ushell.ui.pagecomposer.TileSelector",m,t);L().then(function(i){m.setProperty("/catalogTiles",i);}).finally(function(){a(false);});}return F.then(function(o){o._resolveSelectedItemsPromise=r;t.reset(g);o.open();});});}function l(){var C=[];var S=sap.ushell.Container.getService("LaunchPage");function g(b){C=b.map(function(o){var d=S.getCatalogId(o)||"";return S.getCatalogTitle(o)||d.split(":").slice(1).join(":");});return Promise.all(b.map(function(o){return S.getCatalogTiles(o);}));}function a(d){var i=[];d.forEach(function(T,b){T.forEach(function(o){i.push({id:S.getCatalogTileId(o),title:S.getCatalogTilePreviewTitle(o),icon:S.getCatalogTilePreviewIcon(o),info:S.getCatalogTilePreviewSubtitle(o)||C[b]});});});return i;}return Promise.resolve(S.getCatalogs()).then(g).then(a);}function c(L){return{selectTiles:s.bind(null,L)};}return{create:c,loadCatalogTileData:l};});
