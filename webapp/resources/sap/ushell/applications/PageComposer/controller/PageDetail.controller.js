// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/applications/PageComposer/controller/BaseController","sap/ui/model/json/JSONModel","sap/ushell/applications/PageComposer/model/formatter","sap/ushell/resources","sap/m/MessageToast","sap/base/Log","sap/base/strings/formatMessage"],function(B,J,f,r,M,L,a){"use strict";return B.extend("sap.ushell.applications.PageComposer.controller.PageDetail",{onInit:function(){var R=this.getRouter();R.getRoute("detail").attachPatternMatched(this._onPageMatched,this);this.oDeleteDialogModel=new J({approvalText:""});this.oCopyDialogModel=new J({page:null,approvalText:""});},formatter:f,formatMessage:a,_onPageMatched:function(e){var p=e.getParameter("arguments").pageId;this._loadPage(decodeURIComponent(p)).then(function(P){this.setModel(new J({page:P}));}.bind(this));},_loadPage:function(p){return sap.ushell.Container.getServiceAsync("PagePersistence").then(function(P){return P.getPage(p);});},_navigateToEdit:function(p){this.getRouter().navTo("edit",{pageId:encodeURIComponent(p)});},_navigateToPageOverview:function(){this.getRouter().navTo("overview");},onDeleteCancel:function(){var d=this.byId("pageOverviewDeleteDialog");d.close();},_deletePage:function(e){var d=e.getSource().getParent();var p=this.getModel().getProperty("/page/content/id");return sap.ushell.Container.getServiceAsync("PagePersistence").then(function(P){P.deletePage(p);}).then(function(){this._navigateToPageOverview();M.show(r.i18nModel.getProperty("pageOverviewSuccess"));d.close();}.bind(this)).catch(L.error);},_copyPage:function(){},onEdit:function(){this._navigateToEdit(this.getModel().getProperty("/page/content/id"));},onDelete:function(){var p=this.getModel().getProperty("/page");var A=this.getResourceBundle().getText("pageComposerDetailDeleteText",[p.content.id,p.content.title]);this.oDeleteDialogModel.setProperty("/approvalText",A);this.getOwnerComponent().showDeleteDialog(this.oDeleteDialogModel,this._deletePage.bind(this));},onCopy:function(){var p=this.getModel().getProperty("/page");var A=this.getResourceBundle().getText("pageDetailCopyText",[p.content.id,p.content.title]);this.oCopyDialogModel.setProperty("/page",p);this.oCopyDialogModel.setProperty("/approvalText",A);this.getOwnerComponent().showCopyDialog(this.oCopyDialogModel,this._copyPage.bind(this));},onCopyInputChange:function(e){var t=e.getParameter("value");var p=e.getSource().getParent().getParent();p.getBeginButton().setEnabled(t.length>0);}});});
