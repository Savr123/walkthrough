// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/appRuntime/ui5/AppRuntimePostMessageAPI","sap/ushell/appRuntime/ui5/AppRuntimeService","sap/ui/thirdparty/jquery","sap/ushell/appRuntime/ui5/services/TunnelsAgent","sap/ushell/appRuntime/ui5/services/AppDelegationBootstrap"],function(A,a,q,t,d){"use strict";function b(c){var e=this,f,C,o={},r,R,g={};this.getAppInfo=function(m,h,i){sap.ui.require([m.replace(/\./g,"/")],function(f){e.init(f,h,i);});};this.init=function(h,i,j){f=h;C=i;R=j;A.regiterCommHandlers({"sap.ushell.services.appLifeCycle":{"oInboundActions":{"create":{executeServiceCallFn:function(m){var M=JSON.parse(m.oMessage.data),s=q.sap.getUriParameters(M.body.sUrl).get("sap-ui-app-id");window.hasher.replaceHash(M.body.sHash);e.create(s);}},"destroy":{executeServiceCallFn:function(m){var M=JSON.parse(m.oMessage.data);e.destroy(M.body.sCacheId);}},"store":{executeServiceCallFn:function(m){var M=JSON.parse(m.oMessage.data);e.store(M.body.sCacheId);}},"restore":{executeServiceCallFn:function(m){var M=JSON.parse(m.oMessage.data);window.hasher.replaceHash(M.body.sHash);e.restore(M.body.sCacheId);}}}},"sap.ushell.eventDelegation":{"oInboundActions":{"registerEventHandler":{executeServiceCallFn:function(s){var E=JSON.parse(s.oMessageData.body.sEventObject),k=E.eventKey,l=E.eventData;if(g.hasOwnProperty(k)){var m=g[k];for(var n=0;n<m.length;n++){m[n](l);}}return new q.Deferred().resolve().promise();}}}}});this.initialSetup();};this.initialSetup=function(){d.bootstrap();a.sendMessageToOuterShell("sap.ushell.services.appLifeCycle.setup",{isStateful:true,isKeepAlive:true,lifecycle:{bActive:true,bSwitch:true,bStorageIdentifier:true},settings:{bTheme:true,bLocal:true},session:{bSignOffSupport:true,bExtendSessionSupport:true}});};this.restore=function(s){var h=o[s],i=h.getComponentInstance();h.setVisible(true);if(i){if(i.restore){i.restore();}if(i.getRouter&&i.getRouter()&&i.getRouter().initialize){i.getRouter().initialize();}r=h;}};this.store=function(s){var h=r,i;o[s]=h;i=h.getComponentInstance();h.setVisible(false);if(i){if(i.suspend){i.suspend();}if(i.getRouter&&i.getRouter()){i.getRouter().stop();}}};this.create=function(h){var i=new Promise(function(j){f.getAppInfo(h).then(function(k){j(k);});}).then(function(j){C(h,j).then(function(k){R(k);});});return i;};this.setComponent=function(h){r=h;};this.destroy=function(s){if(s){if(o[s]===r){r=undefined;}o[s].destroy();delete o[s];}else if(r){r.destroy();r=undefined;}};this.jsonStringifyFn=function(j){var s=JSON.stringify(j,function(k,v){return(typeof v==="function")?v.toString():v;});return s;};}return new b();},true);
