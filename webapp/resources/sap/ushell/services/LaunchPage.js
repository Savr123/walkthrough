// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/services/ContentExtensionAdapterFactory","sap/ui/thirdparty/jquery","sap/ushell/resources"],function(C,q,r){"use strict";function L(a){var t=this,T=[],A=C.getAdapters();this.oAdapters={"default":a};A.then(function(o){q.extend(this.oAdapters,o);}.bind(this));this.getGroups=function(){var d=new q.Deferred();A.then(function(){var g=Object.keys(t.oAdapters).map(function(s){return t._getAdapter(s).getGroups();});q.when.apply(q,g).done(function(){var b=[].concat.apply([],arguments);d.resolve(b);}).fail(function(){q.sap.log.error("getGroups failed");});});return d.promise();};this.getGroupsForBookmarks=function(g){var d=q.Deferred();Promise.all([this.getGroups(),this.getDefaultGroup()]).then(function(b){var G=b[0],D=b[1];if(G.length>0){G=G.filter(function(c){if(g!==undefined&&g===true){return t.isGroupVisible(c);}else{return(!t.isGroupLocked(c)&&t.isGroupVisible(c));}}).map(function(c){return{title:(c===D&&r.i18n.getText("my_group"))||t.getGroupTitle(c),object:c};});}d.resolve(G);}).catch(function(e){q.sap.log.error("getGroupsForBookmarks failed: "+e.message);});return d.promise();};this.getDefaultGroup=function(){var p=this._getAdapter().getDefaultGroup();p.fail(function(){q.sap.log.error("getDefaultGroup failed");});return p;};this.getGroupTitle=function(g){return this._getAdapter(g.contentProvider).getGroupTitle(g);};this.getGroupId=function(g){return this._getAdapter(g.contentProvider).getGroupId(g);};this.getGroupById=function(g){var D=q.Deferred();this.getGroups().then(function(G){G=q.grep(G,function(e){return e.id===g;});D.resolve((G&&G.length>0?G[0]:undefined));});return D.promise();};this.getGroupTiles=function(g){return this._getAdapter(g.contentProvider).getGroupTiles(g);};this.getTilesByGroupId=function(g){var D=q.Deferred(),t=this;this.getGroupById(g).then(function(G){if(G){var b=t._getAdapter(G.contentProvider).getGroupTiles(G);if(b){b=b.map(function(o){return{id:t.getTileId(o),title:t.getTileTitle(o),url:t.getTileTarget(o),groupId:g};});}else{b=[];}D.resolve(b);}else{D.resolve([]);}});return D.promise();};this.getLinkTiles=function(g){return this._getAdapter(g.contentProvider).getLinkTiles(g);};this.addGroupAt=function(s,i){var p,b=i,a=this._getAdapter();if(a.addGroupAt){p=a.addGroupAt(s,i);p.fail(function(){q.sap.log.error("addGroup "+s+" failed");});}else{var d=new q.Deferred();p=a.addGroup(s);p.done(function(n){var m=this.moveGroup(n,b),c=n;m.done(function(){d.resolve(c);});m.fail(function(){d.reject();});}.bind(this));p.fail(function(){q.sap.log.error("addGroup "+s+" failed");d.reject();});return d.promise();}return p;};this.addGroup=function(s){var p=this._getAdapter().addGroup(s);p.fail(function(){q.sap.log.error("addGroup "+s+" failed");});return p;};this.removeGroup=function(g,i){var p=this._getAdapter(g.contentProvider).removeGroup(g,i);p.fail(function(){q.sap.log.error("Fail to removeGroup "+t.getGroupTitle(g));});return p;};this.resetGroup=function(g,i){var p=this._getAdapter(g.contentProvider).resetGroup(g,i);p.fail(function(){q.sap.log.error("Fail to resetGroup "+t.getGroupTitle(g));});return p;};this.isGroupRemovable=function(g){return this._getAdapter(g.contentProvider).isGroupRemovable(g);};this.isGroupLocked=function(g){var a=this._getAdapter(g.contentProvider);if(typeof a.isGroupLocked==="function"){return a.isGroupLocked(g);}return false;};this.isGroupFeatured=function(g){var a=this._getAdapter(g.contentProvider);if(typeof a.isGroupFeatured==="function"){return a.isGroupFeatured(g);}return false;};this.moveGroup=function(g,n){var p=this._getAdapter(g.contentProvider).moveGroup(g,n);p.fail(function(){q.sap.log.error("Fail to moveGroup "+t.getGroupTitle(g));});return p;};this.setGroupTitle=function(g,s){var p=this._getAdapter(g.contentProvider).setGroupTitle(g,s);p.fail(function(){q.sap.log.error("Fail to set Group title: "+t.getGroupTitle(g));});return p;};this.hideGroups=function(h){var d=new q.Deferred(),a=this._getAdapter();if(typeof a.hideGroups!=="function"){d.reject("hideGroups() is not implemented in the Adapter.");}else{a.hideGroups(h).done(function(){d.resolve();}).fail(function(m){q.sap.log.error("Fail to store groups visibility."+m);d.reject();});}return d.promise();};this.isGroupVisible=function(g){var a=this._getAdapter(g.contentProvider);if(typeof a.isGroupVisible==="function"){return a.isGroupVisible(g);}return true;};this.addTile=function(c,g){var p=this._getAdapter(g.contentProvider).addTile(c,g);p.fail(function(){q.sap.log.error("Fail to add Tile: "+t.getCatalogTileId(c));});return p;};this.removeTile=function(g,o,i){var p=this._getAdapter(g.contentProvider).removeTile(g,o,i);p.fail(function(){q.sap.log.error("Fail to remove Tile: "+t.getTileId(o));});return p;};this.moveTile=function(o,s,i,S,b,n){var p=this._getAdapter().moveTile(o,s,i,S,b,n);p.fail(function(){q.sap.log.error("Fail to move Tile: "+t.getTileId(o));});return p;};this.isLinkPersonalizationSupported=function(o){var s=o&&o.contentProvider,a=this._getAdapter(s);if(typeof a.isLinkPersonalizationSupported==="function"){return a.isLinkPersonalizationSupported(o);}return false;};this.getTileId=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getTileId(o);};this.getTileTitle=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getTileTitle(o);};this.getTileType=function(o){var s=o&&o.contentProvider,a=this._getAdapter(s);if(a.getTileType){return a.getTileType(o);}return"tile";};this.getTileView=function(o){var s=o&&o.contentProvider,d=this._getAdapter(s).getTileView(o);if(!q.isFunction(d.promise)){d=new q.Deferred().resolve(d).promise();}return d;};this.getCardManifest=function(g){var s=g&&g.contentProvider;return this._getAdapter(s).getCardManifest(g);};this.getAppBoxPressHandler=function(o){var s=o&&o.contentProvider,a=this._getAdapter(s);if(a.getAppBoxPressHandler){return a.getAppBoxPressHandler(o);}return undefined;};this.getTileSize=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getTileSize(o);};this.getTileTarget=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getTileTarget(o);};this.getTileDebugInfo=function(o){var s=o&&o.contentProvider,a=this._getAdapter(s);if(typeof a.getTileDebugInfo==="function"){return a.getTileDebugInfo(o);}return undefined;};this.isTileIntentSupported=function(o){var s=o&&o.contentProvider,a=this._getAdapter(s);if(typeof a.isTileIntentSupported==="function"){return a.isTileIntentSupported(o);}return true;};this.refreshTile=function(o){var s=o&&o.contentProvider;this._getAdapter(s).refreshTile(o);};this.setTileVisible=function(o,n){var s=o&&o.contentProvider;return this._getAdapter(s).setTileVisible(o,n);};this.registerTileActionsProvider=function(p){if(typeof p!=="function"){throw new Error("Tile actions Provider is not a function");}T.push(p);};this.getTileActions=function(o){var b=[],c,s=o&&o.contentProvider,a=this._getAdapter(s);if(typeof a.getTileActions==="function"){c=a.getTileActions(o);if(c&&c.length&&c.length>0){b.push.apply(b,c);}}for(var i=0;i<T.length;i++){c=T[i](o);if(c&&c.length&&c.length>0){b.push.apply(b,c);}}return b;};this.getCatalogs=function(){return this._getAdapter().getCatalogs();};this.isCatalogsValid=function(){return this._getAdapter().isCatalogsValid();};this.getCatalogData=function(c){var l=this._getAdapter();if(typeof l.getCatalogData!=="function"){q.sap.log.warning("getCatalogData not implemented in adapter",null,"sap.ushell.services.LaunchPage");return{id:this.getCatalogId(c)};}return l.getCatalogData(c);};this.getCatalogError=function(c){return this._getAdapter().getCatalogError(c);};this.getCatalogId=function(c){return this._getAdapter().getCatalogId(c);};this.getCatalogTitle=function(c){return this._getAdapter().getCatalogTitle(c);};this.getCatalogTiles=function(c){var p=this._getAdapter().getCatalogTiles(c);p.fail(function(){q.sap.log.error("Fail to get Tiles of Catalog: "+t.getCatalogTitle(c));});return p;};this.getCatalogTileId=function(o){return this._getAdapter(o.contentProvider).getCatalogTileId(o);};this.getCatalogTileTitle=function(c){var s=c&&c.contentProvider;return this._getAdapter(s).getCatalogTileTitle(c);};this.getCatalogTileSize=function(c){var s=c&&c.contentProvider;return this._getAdapter(s).getCatalogTileSize(c);};this.getCatalogTileViewControl=function(c){var s=c&&c.contentProvider;var l=this._getAdapter(s);if(typeof l.getCatalogTileViewControl==="function"){return l.getCatalogTileViewControl(c);}var d=new q.Deferred(),R=this.getCatalogTileView(c);d.resolve(R);return d.promise();};this.getCatalogTileView=function(c){var s=c&&c.contentProvider;return this._getAdapter(s).getCatalogTileView(c);};this.getCatalogTileTargetURL=function(c){var s=c&&c.contentProvider;return this._getAdapter(s).getCatalogTileTargetURL(c);};this.getCatalogTileTags=function(c){var s=c&&c.contentProvider;var l=this._getAdapter(s);if(typeof l.getCatalogTileTags==="function"){return l.getCatalogTileTags(c);}return[];};this.getCatalogTileKeywords=function(c){var s=c&&c.contentProvider;return this._getAdapter(s).getCatalogTileKeywords(c);};this.getCatalogTilePreviewTitle=function(c){var s=c&&c.contentProvider;return this._getAdapter(s).getCatalogTilePreviewTitle(c);};this.getCatalogTilePreviewInfo=function(c){var s=c&&c.contentProvider;return this._getAdapter(s).getCatalogTilePreviewInfo(c);};this.getCatalogTilePreviewSubtitle=function(c){var s=c&&c.contentProvider;var l=this._getAdapter(s);if(l.getCatalogTilePreviewSubtitle){return l.getCatalogTilePreviewSubtitle(c);}};this.getCatalogTilePreviewIcon=function(c){var s=c&&c.contentProvider;return this._getAdapter(s).getCatalogTilePreviewIcon(c);};this.addBookmark=function(p,g){var P,d,m,s;if(!p.title){q.sap.log.error("Add Bookmark - Missing title");throw new Error("Title missing in bookmark configuration");}if(!p.url){q.sap.log.error("Add Bookmark - Missing URL");throw new Error("URL missing in bookmark configuration");}if(g&&this.isGroupLocked(g)){d=new q.Deferred();P=d.promise();m="Tile cannot be added, target group ("+this.getGroupTitle(g)+")is locked!";d.reject(m);q.sap.log.error(m);}else{s=g&&g.contentProvider;P=this._getAdapter(s).addBookmark(p,g);P.fail(function(){q.sap.log.error("Fail to add bookmark for URL: "+p.url+" and Title: "+p.title);});}return P;};this.countBookmarks=function(u){if(!u||typeof u!=="string"){q.sap.log.error("Fail to count bookmarks. No valid URL");throw new Error("Missing URL");}var p=this._getAdapter().countBookmarks(u);p.fail(function(){q.sap.log.error("Fail to count bookmarks");});return p;};this.deleteBookmarks=function(u){if(!u||typeof u!=="string"){throw new Error("Missing URL");}var p=this._getAdapter().deleteBookmarks(u);p.fail(function(){q.sap.log.error("Fail to delete bookmark for: "+u);});return p;};this.updateBookmarks=function(u,p){if(!u||typeof u!=="string"){q.sap.log.error("Fail to update bookmark. No valid URL");throw new Error("Missing URL");}if(!p||typeof p!=="object"){q.sap.log.error("Fail to update bookmark. No valid parameters, URL is: "+u);throw new Error("Missing parameters");}var P=this._getAdapter().updateBookmarks(u,p);P.fail(function(){q.sap.log.error("Fail to update bookmark for: "+u);});return P;};this.onCatalogTileAdded=function(s){return this._getAdapter().onCatalogTileAdded(s);};}L.prototype._getAdapter=function(a){return this.oAdapters[a]||this.oAdapters.default;};L.hasNoAdapter=false;return L;},true);
