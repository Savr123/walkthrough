// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/resources","sap/ushell/components/applicationIntegration/AppLifeCycle","sap/ushell/components/SharedComponentUtils","sap/ushell/Config","sap/ui/thirdparty/jquery","sap/base/Log","sap/ushell/ui5service/UserStatus","sap/ushell/utils"],function(r,A,s,C,q,L,U,u){"use strict";function _(){return sap.ushell.Container.getRenderer("fiori2");}function a(){return A.getElementsModel().getModel();}function G(v,j,k,l,t,o,m,n,p,w,M,x,y){this.view=null;this.getView=function(){if(!this.view||!sap.ui.getCore().byId(v)){if(k==="xml"){this.view=sap.ui.xmlview(v,j);}else{this.view=sap.ui.jsview(v,j);}}if(M){this.view.setModel(M);}return this.view;};return{entryHelpID:l,title:t,valueResult:null,onSave:o?o.bind(this):function(){if(this.getView().getController().onSave){return this.getView().getController().onSave();}}.bind(this),onCancel:m?m.bind(this):function(){if(this.getView().getController().onCancel){return this.getView().getController().onCancel();}}.bind(this),contentFunc:n?n.bind(this):function(){if(this.getView().getController().getContent){return this.getView().getController().getContent();}}.bind(this),valueArgument:p?p.bind(this):function(){var z=new q.Deferred(),B=this;setTimeout(function(){if(B.getView().getController().getValue){B.getView().getController().getValue().done(function(D){z.resolve(D);});}},0);return z.promise();}.bind(this),editable:typeof w==="function"?w():w,contentResult:null,icon:x,defaultVisibility:y};}function c(m){return function(){return this.getView().getController()[m]();};}function b(p){var E={entryHelpID:p.entryHelpId,title:r.i18n.getText(p.i18nTitleKey),editable:true,valueResult:null,contentResult:null,icon:p.icon,getView:function(){var j=p.viewType==="xml"?sap.ui.xmlview:sap.ui.jsview;var v=sap.ui.getCore().byId(p.viewId);if(!v){v=j(p.viewId,p.componentNamespace);}return v;}};E.valueArgument=c("getValue").bind(E);E.onSave=c("onSave").bind(E);E.onCancel=c("onCancel").bind(E);E.contentFunc=c("getContent").bind(E);return E;}function d(){return b({entryHelpId:"language",i18nTitleKey:"languageRegionTit",icon:"sap-icon://globe",viewId:"languageRegionSelector",componentNamespace:"sap.ushell.components.shell.UserSettings.LanguageRegionSelector"});}function e(){return b({entryHelpId:"UserActivitiesEntry",i18nTitleKey:"userActivities",icon:"sap-icon://laptop",viewId:"userActivitiesHandler",componentNamespace:"sap.ushell.components.shell.UserSettings.userActivitiesHandler"});}function f(){var S=_().getShellConfig();var j=(S.enableOnlineStatus&&U.prototype.isEnabled)||S.enableUserImgConsent;var v=j?"userAccountSelector":"userAccountSetting";var k=j?"sap.ushell.components.shell.UserSettings.userAccount.UserAccountSelector":"sap.ushell.components.shell.UserSettings.userAccount.UserAccountSetting";return b({entryHelpId:"userAccountEntry",i18nTitleKey:"UserAccountFld",icon:"sap-icon://account",viewId:v,componentNamespace:k,viewType:"xml"});}function g(){var m=a(),o=sap.ushell.Container.getUser();var t=new G("userPrefThemeSelector","sap.ushell.components.shell.UserSettings.ThemeSelector","xml","themes",r.i18n.getText("Appearance"),function(){var x=this.getView().getController().onSave();x.done(function(){if(C.last("/core/home/enableTilesOpacity")){u.handleTilesOpacity();}});return x;},undefined,undefined,undefined,function(){if(C.last("/core/shell/model/setTheme")!==undefined){return C.last("/core/shell/model/setTheme")&&o.isSetThemePermitted();}return o.isSetThemePermitted();},m,"sap-icon://palette");var j=new G("userPrefUsageAnalyticsSelector","sap.ushell.components.shell.UserSettings.UsageAnalyticsSelector","js","usageAnalytics",r.i18n.getText("usageAnalytics"),undefined,undefined,undefined,undefined,sap.ushell.Container.getService("UsageAnalytics").isSetUsageAnalyticsPermitted());var k=new G("defaultParametersSelector","sap.ushell.components.shell.UserSettings.DefaultParameters","js",undefined,r.i18n.getText("defaultsValuesEntry"),undefined,undefined,undefined,undefined,true,undefined,undefined,false);var l=new G("userProfilingView","sap.ushell.components.shell.UserSettings.UserProfiling","js","userProfiling",r.i18n.getText("userProfiling"),undefined,undefined,undefined,undefined,false,m,"sap-icon://user-settings",false);var n=[new f(),t,new d()],p=[];p.push(j);var v=C.last("/core/shell/enableRecentActivity");if(v){n.push(new e());}n.push(l);if(C.last("/core/shell/model/enableNotifications")===true){var N=sap.ushell.Container.getService("Notifications")._getNotificationSettingsAvalability(),w;w=new G("notificationSettings","sap.ushell.components.shell.Notifications.Settings","js",undefined,r.i18n.getText("notificationSettingsEntry_title"),undefined,undefined,undefined,undefined,true,undefined,"sap-icon://bell",false);n.push(w);N.done(function(S){if(S.settingsAvailable){w.visible=true;C.last("/core/shell/model/userPreferences/entries").every(function(x,y){if(x.title===r.i18n.getText("notificationSettingsEntry_title")){m.setProperty("/userPreferences/entries/"+y+"/visible",true);return false;}return true;});}});}if(C.last("/core/shell/model/userDefaultParameters")){n.push(k);}var E=C.last("/core/home/enableHomePageSettings");if(E!==false){n.push(h());}return{dialogTitle:r.i18n.getText("userSettings"),isDetailedEntryMode:false,activeEntryPath:null,entries:n,profiling:p};}function h(){var R=_(),o=r.i18n;var j;var E={title:o.getText("FlpSettings_entry_title"),entryHelpID:"flpSettingsEntry",valueArgument:function(){return q.Deferred().resolve(" ");},contentFunc:function(){var D=new q.Deferred();s.getEffectiveHomepageSetting("/core/home/homePageGroupDisplay","/core/home/enableHomePageSettings").then(function(k){j=sap.ui.xmlview({viewName:"sap.ushell.components.shell.UserSettings.FlpSettings",viewData:{initialDisplayMode:k||"scroll"}});D.resolve(j);});return D;},onSave:function(){var D=j.getController().onSave();var k=s.getPersonalizer("homePageGroupDisplay",R).setPersData(D);k.fail(function(l){L.error("Failed to save the anchor bar mode in personalization",l,"sap.ushell.components.flp.settings.FlpSettings");});C.emit("/core/home/homePageGroupDisplay",D);return q.Deferred().resolve();},onCancel:function(){return q.Deferred().resolve();},icon:"sap-icon://home"};return E;}function i(){var j=C.last("/core/shell/model/userPreferences/entries");var D=g();D.entries=D.entries.concat(j);D.entries=_().reorderUserPrefEntries(D.entries);a().setProperty("/userPreferences",D);}return{setModel:i};});
