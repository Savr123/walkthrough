// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/Device","sap/ushell/utils","sap/ushell/library","sap/m/MessagePopover","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/thirdparty/URI","sap/ushell/EventHub","sap/ui/core/Icon","sap/ushell/System","sap/ushell/User","sap/m/Text","sap/base/util/UriParameters","sap/base/util/deepEqual","sap/base/security/encodeXML"],function(D,u,a,M,C,b,c,U,E,I,S,d,T,f,g,h){"use strict";var p="sap.ushell.components.container.",s=p+"ApplicationContainer",i="sap.ushell.Container.dirtyState.",l,o,H,r;var j=["sap-ach","sap-fiori-id","sap-hide-intent-link","sap-priority","sap-tag","sap-ui-app-id-hint","sap-ui-debug","sap-ui-fl-control-variant-id","sap-ui-fl-max-layer","sap-ui-tech-hint","sap-ui2-tcode","sap-ui2-wd-app-id","sap-ui2-wd-conf-id","sap-ushell-cdm-site-url","sap-ushell-defaultedParameterNames","sap-ushell-navmode","sap-ushell-next-navmode","sap-ushell-url"];function k(e){var _=sap.ushell.Container.getService("CrossApplicationNavigation");_.isUrlSupported(e.url).done(function(){e.promise.resolve({"allowed":true,"id":e.id});}).fail(function(){e.promise.resolve({"allowed":false,"id":e.id});});}function m(e){var _={"asyncURLHandler":$.prototype._adaptIsUrlSupportedResultForMessagePopover};if(M&&M.setDefaultHandlers){M.setDefaultHandlers(_);}E.emit("StepDone",e.stepName);}E.once("initMessagePopover").do(m);l=new u.Map();function n(e){return l.get(e.getId());}function q(){return o;}function t(e){var _=new f(e).mParams,a1=_["sap-xapp-state"],b1;delete _["sap-xapp-state"];b1={startupParameters:_};if(a1){b1["sap-xapp-state"]=a1;}return b1;}function v(e,_){if(!r){r=jQuery.sap.resources({url:jQuery.sap.getModulePath(p)+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});}return r.getText(e,_);}function w(){return new I({size:"2rem",src:"sap-icon://error",tooltip:$.prototype._getTranslatedText("an_error_has_occured")});}function x(e){var _=e.getAggregation("child"),a1;if(_ instanceof b){a1=_.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");jQuery.sap.log.debug("unloading component "+a1,null,s);}e.destroyAggregation("child");}function y(e,_,a1){var b1,c1,d1,e1,f1,g1,h1,i1={},j1,k1;d1=_.indexOf("?");if(d1>=0){g1=$.prototype._getParameterMap(_);i1=g1.startupParameters;_=_.slice(0,d1);}if(_.slice(-1)!=="/"){_+="/";}if(/\.view\.(\w+)$/i.test(a1)){f1=/^SAPUI5=(?:([^/]+)\/)?([^/]+)\.view\.(\w+)$/i.exec(a1);if(!f1){jQuery.sap.log.error("Invalid SAPUI5 URL",a1,s);return $.prototype._createErrorControl();}h1=f1[1];j1=f1[2];k1=f1[3].toUpperCase();if(h1){j1=h1+"."+j1;}else{e1=j1.lastIndexOf(".");if(e1<1){jQuery.sap.log.error("Missing namespace",a1,s);return $.prototype._createErrorControl();}h1=j1.slice(0,e1);}}else{h1=a1.replace(/^SAPUI5=/,"");}jQuery.sap.registerModulePath(h1,_+h1.replace(/\./g,"/"));$.prototype._destroyChild(e);if(j1){if(e.getApplicationConfiguration()){i1.config=e.getApplicationConfiguration();}c1=sap.ui.view({id:e.getId()+"-content",type:k1,viewData:i1||{},viewName:j1});e.fireEvent("applicationConfiguration");}else{jQuery.sap.log.debug("loading component "+h1,null,s);var l1=g1?{startupParameters:g1.startupParameters}:{startupParameters:{}};if(g1&&g1["sap-xapp-state"]){l1["sap-xapp-state"]=g1["sap-xapp-state"];}if(e.getApplicationConfiguration()){l1.config=e.getApplicationConfiguration();}b1=sap.ui.component({id:e.getId()+"-component",componentData:l1,name:h1});e.fireEvent("applicationConfiguration",{"configuration":b1.getMetadata().getConfig()});c1=new b({id:e.getId()+"-content",component:b1});}c1.setWidth(e.getWidth());c1.setHeight(e.getHeight());c1.addStyleClass("sapUShellApplicationContainer");e.setAggregation("child",c1,true);return c1;}function z(e,_){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell",e,_);},0);}function A(e,_,a1){var b1,c1,d1,e1,f1={startupParameters:{}},g1,h1=e.getComponentHandle(),i1=sap.ushell.Container.getService("PluginManager"),j1,k1;u.addTime("createUi5Component");b1=_.indexOf("?");if(b1>=0){e1=$.prototype._getParameterMap(_);f1={startupParameters:e1.startupParameters};if(e1["sap-xapp-state"]){f1["sap-xapp-state"]=e1["sap-xapp-state"];}_=_.slice(0,b1);}if(e.getApplicationConfiguration()){f1.config=e.getApplicationConfiguration();}if(_.slice(-1)!=="/"){_+="/";}$.prototype._destroyChild(e);g1={id:e.getId()+"-component",name:a1,componentData:f1};jQuery.sap.log.debug("Creating component instance for "+a1,JSON.stringify(g1),s);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:a1});if(h1){c1=h1.getInstance(g1);}else{jQuery.sap.registerModulePath(a1,_);jQuery.sap.log.error("No component handle available for '"+a1+"'; fallback to component.load()",null,s);c1=sap.ui.component({id:e.getId()+"-component",name:a1,componentData:f1});}e.fireEvent("applicationConfiguration",{"configuration":c1.getMetadata().getConfig()});d1=new b({id:e.getId()+"-content",component:c1});d1.setHeight(e.getHeight());d1.setWidth(e.getWidth());d1.addStyleClass("sapUShellApplicationContainer");e._disableRouterEventHandler=$.prototype._disableRouter.bind(this,c1);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);e.setAggregation("child",d1,true);if(i1){j1=i1.getPluginLoadingPromise("RendererExtensions");k1=j1&&j1.state();if(k1==="pending"){j1.done(function(){$.prototype._publishExternalEvent("appComponentLoaded",{component:c1});}).fail(function(){$.prototype._publishExternalEvent("appComponentLoaded",{component:c1});});}if(k1==="resolved"||k1==="rejected"){$.prototype._publishExternalEvent("appComponentLoaded",{component:c1});}}else{$.prototype._publishExternalEvent("appComponentLoaded",{component:c1});}return d1;}function B(e){var _;if((e instanceof C)&&(typeof e.getRouter==="function")){_=e.getRouter();if(_&&(typeof _.stop==="function")){jQuery.sap.log.info("router stopped for instance "+e.getId());_.stop();}}}function F(e){var _=document.createElement("a"),a1=new f(e).get("sap-client"),b1;_.href=e;b1=_.protocol+"//"+_.host;return new S({alias:a1?b1+"?sap-client="+a1:b1,baseUrl:b1,client:a1||undefined,platform:"abap"});}function G(e,_){var a1=false,b1=e.getDomRef(),c1,d1;if(b1){c1=U(b1.src||window.location&&window.location.href||"");d1=c1.protocol()+"://"+c1.host();a1=(_.source===b1.contentWindow)||(_.origin===d1);}return a1;}function J(e,_,a1){var b1=JSON.stringify({type:"request",service:_,request_id:jQuery.sap.uid(),body:{}});jQuery.sap.log.debug("Sending post message request to origin ' "+a1+"': "+b1,null,"sap.ushell.components.container.ApplicationContainer");e.postMessage(b1,a1);}function K(){var e=this.getDomRef();if(!e||e.tagName!=="IFRAME"){if(jQuery.sap.getUriParameters().get("sap-post")==="true"&&e&&e.getAttribute&&e.getAttribute("sap-iframe-app")=="true"){return jQuery("#"+e.getAttribute("id")+"-iframe")[0];}return null;}return e;}function L(e,_){var a1=e.getUi5ComponentName&&e.getUi5ComponentName(),b1=_.data;if(typeof a1==="string"){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(b1)+"' on container of UI5 application '"+a1+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}if(!e.getActive()){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(b1)+"' on inactive container '"+e.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}H(e,_);}function N(e,_){var a1=e._getIFrame(),b1=e.getApplicationType();if(u.isApplicationTypeEmbeddedInIframe(e.getApplicationType(b1))&&a1){a1.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),"*");_.preventDefault();}}function O(e,_,a1){e.write("<div").writeControlData(_).writeAccessibilityState(_).addClass("sapUShellApplicationContainer").writeClasses(_).addStyle("height",_.getHeight()).addStyle("width",_.getWidth()).writeStyles().write(">").renderControl(a1);e.write("</div>");}function P(e,_,a1,b1){var c1,d1=function(){var j1=u.getParameterValueBoolean("sap-accessibility");if(j1!==undefined){return j1;}return sap.ushell.Container.getUser().getAccessibilityMode();},e1=function(){var j1=false,k1=new f(e)||{mParams:{}};j1=sap.ui.getCore().getConfiguration().getStatistics()&&k1.mParams["sap-statistics"]===undefined;return j1;},f1=function(){var j1=window.hasher&&window.hasher.getHash(),h1="",k1;if(j1&&j1.length>0&&j1.indexOf("sap-iapp-state=")>0){k1=/(?:sap-iapp-state=)([^&/]+)/.exec(j1);if(k1&&k1.length===2){h1=k1[1];}}return h1;},g1=function(){var j1="";var k1=(!!jQuery("body.sapUiSizeCompact").length);var l1=(!!jQuery("body.sapUiSizeCozy").length);if(k1===true){j1="0";}else if(l1){j1="1";}return j1;};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";c1=sap.ushell.Container.getUser().getTheme(d.prototype.constants.themeFormat.NWBC);if(c1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(c1);}if(a1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(a1);}if(d1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X";}if(e1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true";}if(b1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1";}var h1=f1();if(h1&&h1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-iapp-state="+h1;}var i1=g1();if(i1&&i1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-touch="+i1;}return u.appendSapShellParam(e,_);}function Q(e,_,a1,b1){var c1=_.getAggregation("child");if(!c1||_._bRecreateChild){c1=$.prototype._createUi5Component(_,a1,b1);_._bRecreateChild=false;}$.prototype._renderControlInDiv(e,_,c1);}function R(e,_,a1){var b1=e.getProperty(_);if(g(b1,a1)){return;}e.setProperty(_,a1);e._bRecreateChild=true;}function V(e,_,a1,b1,c1){var d1;localStorage.removeItem(_.globalDirtyStorageKey);if(c1&&c1.indexOf("SAPUI5.Component=")===0&&a1===sap.ushell.components.container.ApplicationType.URL){Q(e,_,b1,c1.replace(/^SAPUI5\.Component=/,""));return;}if(c1&&c1.indexOf("SAPUI5=")===0&&a1===sap.ushell.components.container.ApplicationType.URL){$.prototype._renderControlInDiv(e,_,$.prototype._createUi5View(_,b1,c1));return;}jQuery.sap.log.debug("Not resolved as \"SAPUI5.Component=\" or \"SAPUI5=\" , "+"will attempt to load into iframe "+c1);if(!_.getActive()){jQuery.sap.log.debug("Skipping rendering container iframe","Container '"+_.getId()+"' is inactive");return;}try{b1=_.getFrameSource(a1,b1,c1);}catch(ex){jQuery.sap.log.error(ex.message||ex,null,s);_.fireEvent("applicationConfiguration");e.renderControl($.prototype._createErrorControl());return;}if(sap.ushell.Container){d1=$.prototype._getLogoutHandler(_);if(!d1){if(u.isApplicationTypeEmbeddedInIframe(a1)){d1=$.prototype._logout.bind(null,_);l.put(_.getId(),d1);sap.ushell.Container.attachLogoutEvent(d1);sap.ushell.Container.addRemoteSystem($.prototype._createSystemForUrl(b1));}}else if(!u.isApplicationTypeEmbeddedInIframe(a1)){sap.ushell.Container.detachLogoutEvent(d1);l.remove(_.getId());}}if(u.isApplicationTypeEmbeddedInIframe(a1)){var f1=_.getTargetNavigationMode();b1=$.prototype._adjustNwbcUrl(b1,a1,f1,_.getIsStateful());u.localStorageSetItem(_.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL);}var g1=new U();if(g1.query(true).hasOwnProperty("sap-isolation-enabled")){var h1=sap.ushell.Container.getService("URLParsing"),i1=h1.getHash(g1.toString());if(i1){var j1=h1.parseShellHash("#"+i1);var k1=h1.paramsToString(j1.params);if(k1&&k1.length>0){b1=b1.split("#")[0]+"&sap-startup-params="+encodeURIComponent(k1)+"#"+window.hasher.getHash();}else{b1=b1.split("#")[0]+"#"+window.hasher.getHash();}}else{b1+="#"+window.hasher.getHash();}}if(jQuery.sap.getUriParameters().get("sap-post")==="true"&&u.isApplicationTypeEmbeddedInIframe(a1)){b1=$.prototype._filterURLParams(b1);var l1=[];var m1=$.prototype._getParamKeys(b1,l1);if(m1.length>0){var n1=sap.ushell.Container.getService("CrossApplicationNavigation");$.prototype._generateRootElementForIFrame(e,_);n1.getAppStateData(m1).then(function(e1){var o1;var p1=jQuery("#"+_.getId());if(p1){o1=sap.ui.getCore().createRenderManager();$.prototype._buildHTMLElements(o1,_,e1,l1,b1);o1.flush(p1[0]);o1.destroy();}},function(e1){$.prototype._buildHTMLElements(e,_,undefined,l1,b1);});}else{$.prototype._buildHTMLElements(e,_,undefined,l1,b1);}return;}_.fireEvent("applicationConfiguration");e.write("<iframe").writeControlData(_).writeAccessibilityState(_).writeAttributeEscaped("src",b1).addClass("sapUShellApplicationContainer").writeClasses(_).addStyle("height",_.getHeight()).addStyle("width",_.getWidth()).writeStyles().write("></iframe>");}function W(e){var _=new U(e);_=_.removeSearch(j);return _.toString();}function X(e,_){var a1=[],b1;if(e.indexOf("sap-intent-param=")>0){b1=/(?:sap-intent-param=)([^&/]+)/.exec(e);if(b1&&b1.length===2){a1.push([b1[1]]);_.push("sap-intent-param-data");}}if(e.indexOf("sap-xapp-state=")>0){b1=/(?:sap-xapp-state=)([^&/]+)/.exec(e);if(b1&&b1.length===2){a1.push([b1[1]]);_.push("sap-xapp-state-data");}}if(e.indexOf("sap-iapp-state=")>0){b1=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(b1&&b1.length===2){a1.push([b1[1]]);_.push("sap-iapp-state-data");}}return a1;}function Y(e,_,a1,b1,c1){var d1=_.getId()+"-form";var e1="";var f1="";if(a1===undefined){a1=[];}a1.push([sap.ushell.Container.getFLPUrl(true)]);b1.push("sap-flp-url");var g1="";b1.forEach(function(h1,i1){if(h1==="sap-intent-param-data"){var j1=a1[i1][0].split("&");j1.forEach(function(k1){e1="<input name=\""+k1.split("=")[0]+"\" value=\""+h(k1.split("=")[1])+"\"/>";f1+=e1;});}else{if(typeof a1[i1][0]==="object"){g1=JSON.stringify(a1[i1][0]);}else{g1=a1[i1][0];}e1="<input name=\""+h1+"\" value=\""+h(g1)+"\"/>";f1+=e1;}});_.fireEvent("applicationConfiguration");e.write("<form").writeAttributeEscaped("method","post").writeAttributeEscaped("id",d1).writeAttributeEscaped("name",d1).writeAttributeEscaped("target",_.getId()+"-iframe").writeAttributeEscaped("action",c1).addStyle("display","none").writeStyles().write(">").writeAttributeEscaped(f1).write("</form>");e.write("<iframe").writeAttributeEscaped("name",_.getId()+"-iframe").writeControlData(_).writeAccessibilityState(_).addClass("sapUShellApplicationContainer").writeClasses(_).addStyle("height",_.getHeight()).addStyle("width",_.getWidth()).writeStyles().write("></iframe>");e.write("<script>document.forms[\""+d1+"\"].submit();</script>");}function Z(e,_){e.write("<div").writeControlData(_).writeAccessibilityState(_).writeAttributeEscaped("sap-iframe-app","true").addClass("sapUShellApplicationContainer").writeClasses(_).addStyle("height",_.getHeight()).addStyle("width",_.getWidth()).writeStyles().write("></div>");}var $=c.extend(s,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:p+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{defaultValue:undefined,type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"}},events:{"applicationConfiguration":{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,_=this;if(sap.ushell.Container){e=$.prototype._getLogoutHandler(_);if(e){sap.ushell.Container.detachLogoutEvent(e);l.remove(_.getId());}}localStorage.removeItem(_.globalDirtyStorageKey);if(_._unloadEventListener){removeEventListener("unload",_._unloadEventListener);}if(_._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",_._disableRouterEventHandler);}if(_._storageEventListener){removeEventListener("storage",_._storageEventListener);}if(_._messageEventListener){removeEventListener("message",_._messageEventListener);}$.prototype._destroyChild(_);if(c.exit){c.exit.apply(_);}},setHandleMessageEvent:function(e){H=e;},init:function(){var e=this;e.globalDirtyStorageKey=i+jQuery.sap.uid();e._unloadEventListener=e.exit.bind(e);addEventListener("unload",e._unloadEventListener);e._storageEventListener=function(_){var a1=e.getApplicationType();if(_.key===e.globalDirtyStorageKey&&_.newValue===sap.ushell.Container.DirtyState.PENDING&&u.isApplicationTypeEmbeddedInIframe(a1)){var b1=e._getIFrame();if(b1){jQuery.sap.log.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");b1.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),"*");}}};addEventListener("storage",e._storageEventListener);e._messageEventListener=$.prototype._handleMessageEvent.bind(null,e);addEventListener("message",e._messageEventListener);},onAfterRendering:function(){if(this.getIsStateful()){this.rerender=function(){};}if(D.os.ios&&this.$().prop("tagName")==="IFRAME"){this.$().parent().css("overflow","auto");}},renderer:function(e,_){var a1=_.getApplication(),b1=_.launchpadData,c1;if(!_.getVisible()){$.prototype._renderControlInDiv(e,_);return;}if(_.error){delete _.error;$.prototype._renderControlInDiv(e,_,$.prototype._createErrorControl());}else if(!a1){$.prototype._render(e,_,_.getApplicationType(),_.getUrl(),_.getAdditionalInformation());}else if(!a1.isResolvable()){$.prototype._render(e,_,a1.getType(),a1.getUrl(),"");}else if(b1){$.prototype._render(e,_,b1.applicationType,b1.Absolute.url.replace(/\?$/,""),b1.applicationData);}else{jQuery.sap.log.debug("Resolving "+a1.getUrl(),null,s);a1.resolve(function(d1){jQuery.sap.log.debug("Resolved "+a1.getUrl(),JSON.stringify(d1),s);_.launchpadData=d1;$.prototype._destroyChild(_);},function(d1){var e1=a1.getMenu().getDefaultErrorHandler();if(e1){e1(d1);}$.prototype._destroyChild(_);_.error=d1;});c1=new T({text:$.prototype._getTranslatedText("loading",[a1.getText()])});$.prototype._destroyChild(_);_.setAggregation("child",c1);$.prototype._renderControlInDiv(e,_,c1);}}});$.prototype.getFrameSource=function(e,_){if(!Object.prototype.hasOwnProperty.call(sap.ushell.components.container.ApplicationType,e)){throw new Error("Illegal application type: "+e);}return _;};$.prototype.setUrl=function(e){R(this,"url",e);};$.prototype.setAdditionalInformation=function(e){R(this,"additionalInformation",e);};$.prototype.setApplicationType=function(e){R(this,"applicationType",e);};$.prototype.createPostMessageRequest=function(e,_){var a1=Date.now().toString();return{"type":"request","request_id":a1,"service":e,"body":_};};$.prototype.setNewTRApplicationContext=function(e){var _=this._getIFrame();if(!_){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}e=u.appendSapShellParam(e);var a1=this.createPostMessageRequest("sap.its.startService",{"url":e});return this.postMessageToIframe(a1,_,true).catch(function(b1){return Promise.reject({eventData:b1,message:"Failed to change application context."});});};$.prototype.postMessageToIframe=function(_,a1,b1){var c1=this;var d1=_.request_id;return new Promise(function(e1,f1){function g1(i1){var j1;try{j1=JSON.parse(i1.data,c1);if(d1!==j1.request_id){return;}if(j1.status==="success"){e1(j1);}else{f1(j1);}window.removeEventListener("message",g1);}catch(e){e1();jQuery.sap.log.warning("Obtained bad response from framework in response to message "+_.request_id);jQuery.sap.log.debug("Underlying framework returned invalid response data: '"+i1.data+"'");}}var h1=JSON.stringify(_);jQuery.sap.log.debug("Sending postMessage "+h1+" to application container '"+c1.getId()+"'");if(b1){window.addEventListener("message",g1,false);a1.contentWindow.postMessage(h1,"*");}else{a1.contentWindow.postMessage(h1,"*");e1();}});};$.prototype.postMessageToCurrentIframe=function(e,_){if(_===undefined){_=false;}var a1=this._getIFrame();if(!a1){if(_){return Promise.reject({message:"Expected opened iframe not found."});}return;}return this.postMessageToIframe(e,a1,_);};$.prototype.setNewApplicationContext=function(e,_){var a1=this;var b1=this["setNew"+e+"ApplicationContext"];if(!b1){return Promise.reject({message:"Unsupported application type"});}var c1=this._getIFrame();if(!c1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var d1=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(d1,c1,true).then(function(){return b1.call(a1,_);},function(e1){return Promise.reject({eventData:e1,message:"Failed to change application context."});});};$.prototype.onApplicationOpened=function(e){var _=this.getIsStateful();if(!_){return Promise.resolve();}var a1=this.getApplicationType();if(a1==="TR"&&e!=="TR"){var b1=this._getIFrame();if(!b1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var c1=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(c1,b1,false).catch(function(d1){return Promise.reject({eventData:d1,message:"Failed to change application context."});});}return Promise.resolve();};$.prototype.postMessageRequest=function(e,_){var a1=this._getIFrame();if(!a1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var b1=this.createPostMessageRequest(e,_||{});return this.postMessageToIframe(b1,a1,false).catch(function(c1){return Promise.reject({eventData:c1,message:"Failed to post message."});});};$.prototype._getCommunicationHandlers=q;$.prototype._adaptIsUrlSupportedResultForMessagePopover=k;$.prototype._getLogoutHandler=n;$.prototype._getParameterMap=t;$.prototype._getTranslatedText=v;$.prototype._createErrorControl=w;$.prototype._destroyChild=x;$.prototype._createUi5View=y;$.prototype._publishExternalEvent=z;$.prototype._createUi5Component=A;$.prototype._disableRouter=B;$.prototype._createSystemForUrl=F;$.prototype._isTrustedPostMessageSource=G;$.prototype._handleMessageEvent=L;$.prototype._logout=N;$.prototype._renderControlInDiv=O;$.prototype._adjustNwbcUrl=P;$.prototype._render=V;$.prototype._getParamKeys=X;$.prototype._buildHTMLElements=Y;$.prototype._generateRootElementForIFrame=Z;$.prototype._backButtonPressedCallback=J;$.prototype._getIFrame=K;$.prototype._filterURLParams=W;return $;},true);
