// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/Config","sap/ushell/EventHub","sap/ushell/utils","sap/ushell/utils/clone","sap/ushell/components/StateHelper","sap/ushell/components/_HeaderManager/PropertyStrategiesFactory",'sap/ui/core/theming/Parameters','sap/base/util/ObjectPath','sap/ui/Device'],function(C,E,u,c,S,g,T,O,D){"use strict";var h={application:{},centralAreaElement:null,headEndItems:[],headItems:[],headerVisible:true,showLogo:false,ShellAppTitleState:undefined,rootIntent:"",title:""};var H;var a;var B={"blank":{},"blank-home":{},"home":{"headItems":[]},"app":{"headItems":["backBtn","homeBtn"]},"minimal":{"headItems":["homeBtn"]},"standalone":{"headItems":["backBtn"]},"embedded":{"headItems":["backBtn","homeBtn"]},"embedded-home":{"headItems":[]},"headerless":{"headItems":["backBtn","homeBtn"],"headerVisible":false},"merged":{"headItems":["backBtn","homeBtn"]},"headerless-home":{"headerVisible":false},"merged-home":{},"lean":{"headItems":[]},"lean-home":{}};var d=[];function i(A,F){var I=A&&A.appState?A.appState:"home";H=q(A);a=F;f(D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD));_();o(I);}function b(){e();}function _(){var A=E.on("setHeaderCentralAreaElement").do(function(P){m({propertyName:"centralAreaElement",value:P.id,aStates:S.getPassStates(P.states),bCurrentState:!!P.currentState,bDoNotPropagate:!!P.bDoNotPropagate});});d.push(A);d.push(E.on("ShellFloatingContainerDockedIsResized").do(f));d.push(E.on("updateHeaderOverflowState").do(f));D.media.attachHandler(f,this,D.media.RANGESETS.SAP_STANDARD);}function e(){if(d){d.forEach(function(A){A.off();});}D.media.detachHandler(f,this,D.media.RANGESETS.SAP_STANDARD);}function f(P){v(P);j(P);}function v(P){var A,F=C.last("/core/shell/model/currentState/stateName"),I=F==='merged'||F==='headerless',G=C.last("/core/shell/model/currentViewPortState")==="LeftCenter",J=true;if(P&&P.name){A=P.name;}else{A=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;}if(A==="Phone"&&!G||I){J=false;}m({propertyName:"showLogo",value:J,aStates:["home","app","blank","blank-home","minimal","lean"],bCurrentState:false,bDoNotPropagate:true});}function j(P){var A=C.last("/core/shellHeader/headEndItems");var F={"Phone":true,"Tablet":true};delete F["Tablet"];if(A.length<2||(A.length===2&&A.indexOf("meAreaHeaderButton")!==-1)){return;}function G(){r(["endItemsOverflowBtn"],false,["home","app"]);var J=sap.ui.getCore().byId('headEndItemsOverflow');if(J){J.destroy();}}var I=(P&&P.name)||D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;if(I in F){if(A.indexOf("endItemsOverflowBtn")===-1){k(["endItemsOverflowBtn"],false,["home","app"]);}else{G();window.setTimeout(function(){k(["endItemsOverflowBtn"],false,["home","app"]);});}}else{G();}}function k(I,A,F,G){m({propertyName:"headEndItems",value:I,aStates:F,bCurrentState:!!A,bDoNotPropagate:!!G});}function r(I,A,F){m({propertyName:"headEndItems",value:I,aStates:F,bCurrentState:!!A,action:"remove",bDoNotPropagate:false});}function l(A,F){var G={};Object.keys(A).forEach(function(I){var J=A[I];G[I]=Object.keys(J).reduce(function(K,L){K[L]=J[L];return K;},c(F));});return G;}function m(P){var A=P.propertyName,F=!P.bCurrentState?S.getAllStateToUpdate(P.aStates,P.bDoNotPropagate):[],G=C.last("/core/shellHeader"),I=C.last("/core/shell/model/currentState/stateName"),J=P.value,K;if(A.charAt(0)==="/"){A=A.substring(1);}K=g(A,P.action);if(!K){return;}if(!P.bCurrentState){H=s(H,A,K,F,J);}if(F.indexOf(I)>-1||P.bCurrentState){var L=O.get(A.split("/"),G),N=K.execute(L,J);if(L!==N){O.set(A.split("/"),N,G);w(A,G);}}if(P.bCurrentState){t(A,K,J);}}function n(A){var F;for(F in A){if(A.hasOwnProperty(F)){u.updateProperties(H[F],A[F]);}}}function o(A,F){var G=!F?H[A]:C.last("/core/shellHeader"),I,J;if(!G){throw new Error("the state ("+A+") does not exist");}if(a&&a.customShellState){I=a.customShellState.currentState;}if(F&&a.extendedShellStates[F]){J=a.extendedShellStates[F].customState.currentState;}C.emit("/core/shellHeader",p(G,I,J));}function p(A,F,G){var R={};Object.keys(A).forEach(function(P){var I=g(P),J;if(!I){R[P]=c(A[P]);return;}J=c(A[P]);if(G){J=I.execute(J,G[P]);}if(F){J=I.execute(J,F[P]);}R[P]=J;});R.ShellAppTitleState=C.last("/core/shellHeader/ShellAppTitleState");return R;}function q(A){if(A){h.rootIntent="#"+A.rootIntent;}var F=l(B,h);function G(J,F){var K,L;for(K in F){if(K==="blank"||K==="blank-home"){continue;}if(J==="ActionModeBtn"&&K!=="home"){continue;}if((J==="openCatalogBtn"||J==="userSettingsBtn")&&(K==="lean"||K==="lean-home")){continue;}if(J==="ContactSupportBtn"||J==="EndUserFeedbackBtn"){if(["home","app","minimal","standalone","embedded","embedded-home","lean"].indexOf(K)===-1){continue;}}L=F[K].headEndItems.indexOf(J);if(L===-1){F[K].headEndItems.push(J);}}}function I(J,F){var K;for(K in F){F[K].title=J;}}if(A){if(A.moveEditHomePageActionToShellHeader){G("ActionModeBtn",F);}if(A.moveContactSupportActionToShellHeader){G("ContactSupportBtn",F);}if(A.moveGiveFeedbackActionToShellHeader){G("EndUserFeedbackBtn",F);}if(A.moveAppFinderActionToShellHeader){G("openCatalogBtn",F);}if(A.moveUserSettingsActionToShellHeader){G("userSettingsBtn",F);}if(A.title){I(A.title,F);}}return F;}function s(A,P,F,G,I){if(G.length===0){return A;}var N=c(A);G.forEach(function(J){var K=N[J],L;if(K){L=F.execute(O.get(P.split("/"),K),I);O.set(P.split("/"),L,K);}});return N;}function t(P,A,F){var G,N;if(!a){return;}G=a.customShellState.currentState;N=A.execute(O.get(P.split("/"),G),F);O.set(P.split("/"),N,G);}function w(P,A){var R=P.split("/").shift();C.emit("/core/shellHeader/"+R,A[R]);}function x(A){var F;try{F=H[A];}catch(G){F=undefined;}return F;}function y(A,P){var F;try{F=x(A)[P];}catch(G){F=undefined;}return F;}function z(A){H=A;}return{init:i,destroy:b,updateStates:m,recalculateState:o,extendStates:n,validateShowLogo:v,handleEndItemsOverflow:j,_resetBaseStates:z,_generateBaseHeaderState:l,_createInitialState:q,_getBaseState:x,_getBaseStateMember:y};},false);
