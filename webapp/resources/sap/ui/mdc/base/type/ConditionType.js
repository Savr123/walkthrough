/*!
 * SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/model/SimpleType','sap/ui/model/FormatException','sap/ui/model/ParseException','sap/ui/model/ValidateException','sap/ui/model/type/String','sap/ui/mdc/library','sap/ui/mdc/base/FilterOperatorConfig','sap/ui/mdc/base/Condition','sap/base/util/merge'],function(S,F,P,V,a,l,b,C,m){"use strict";var c=l.FieldDisplay;var d=S.extend("sap.ui.mdc.base.type.ConditionType",{constructor:function(t,u){S.apply(this,arguments);this.sName="Condition";this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");}});d.prototype.destroy=function(){S.prototype.destroy.apply(this,arguments);if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType;}if(this._oFilterOperatorConfig){this._oFilterOperatorConfig.destroy();delete this._oFilterOperatorConfig;}};d.prototype.formatValue=function(t,I){if(t==undefined||t==null){return null;}if(typeof t!=="object"||!t.operator||!t.values||!Array.isArray(t.values)){throw new F("No valid condition provided");}if(!I){I="string";}var T=n.call(this);var u=this.oFormatOptions.isUnit;if(u){t=m({},t);if(t.values[0]&&Array.isArray(t.values[0])){t.values[0]=t.values[0][1];}if(t.operator!=="EQ"&&t.operator!=="EEQ"){t.operator="EQ";if(t.values[1]){t.values.splice(1,1);}}}s.call(this,t,T);switch(this.getPrimitiveType(I)){case"string":case"any":if(this.oFormatOptions.onlyEEQ&&t.operator==="EQ"){t=m({},t);t.operator="EEQ";}var D=k.call(this);var v=q.call(this);if(t.operator==="EEQ"&&D!==c.Value&&!t.values[1]&&v){var B=this.oFormatOptions.bindingContext;var w=v.getTextForKey(t.values[0],t.inParameters,t.outParameters,B);if(w instanceof Promise){return w.then(function(w){t=m({},t);if(t.values.length==1){t.values.push(w);}else{t.values[1]=w;}return _.call(this,t);}.bind(this)).catch(function(E){if(!v.getValidateInput()){return _.call(this,t);}else{throw E;}}.bind(this));}else if(w){t=m({},t);if(t.values.length==1){t.values.push(w);}else{t.values[1]=w;}}else if(v.getValidateInput()){throw new F(this._oResourceBundle.getText("valuehelp.VALUE_NOT_EXIST",[t.values[0]]));}}return _.call(this,t);default:if(T&&t.values.length>=1){return T.formatValue(t.values[0],I);}throw new F("Don't know how to format Condition to "+I);}};function _(t){var D=k.call(this);var T=n.call(this);var u=p.call(this);if(this.oFormatOptions.hideOperator&&t.values.length>=1){return T.formatValue(t.values[0],"string");}var O=u.getOperator(t.operator);return O.format(t.values,t,T,D);}d.prototype.parseValue=function(v,I){if(!I){I="string";}else if(I==="any"&&typeof v==="string"){I="string";}var D=k.call(this);var t=q.call(this);var T=n.call(this);var O=o.call(this);var u=T.getMetadata().getName();var w=p.call(this);if(!v){if(!r.call(this,T)){return null;}}switch(this.getPrimitiveType(I)){case"string":var y=v;var z;var A=false;if(this.oFormatOptions.onlyEEQ){z=w.getOperator("EEQ");if(!z.test(v,T)){y="=="+v;}}else{var B=w.getMatchingOperators(u,y);if(B.length===0){if(t&&!r.call(this,T)){z=w.getOperator("EEQ");if(!z.test(v,T)){y="=="+v;}A=true;}else{x=w.getDefaultOperator(u);z=w.getOperator(x);y=z?z.format([v]):v;}}else{z=B[0];}}if(z){var E;try{E=z.getCondition(y,T,D);}catch(G){if(G instanceof P&&O){O.parseValue(v,"string");}throw G;}if(!E){throw new P("Cannot parse value "+v);}if(z.name==="EEQ"&&t&&!r.call(this,T)){var K=false;if(E.values[0]!==null&&E.values[0]!==undefined){E=f.call(this,E,T,t,A,w,v,D);if(E instanceof Promise){if(this.oFormatOptions.asyncParsing){this.oFormatOptions.asyncParsing(E);}return E;}K=true;}if((E.values[0]===null||E.values[0]===undefined)&&E.values[1]){E=g.call(this,E,T,t,!K,A,w,v,D);if(E instanceof Promise){if(this.oFormatOptions.asyncParsing){this.oFormatOptions.asyncParsing(E);}return E;}}}return e.call(this,E,T);}throw new P("Cannot parse value "+v);default:if(T){var x;if(this.oFormatOptions.onlyEEQ){x="EEQ";}else{x=w.getDefaultOperator(u);}return C.createCondition(x,[T.parseValue(v,I)]);}throw new P("Don't know how to parse Condition from "+I);}};function e(t,T){if(t){var I=this.oFormatOptions.isUnit;if(I){if(t.operator!=="EEQ"&&t.operator!=="EQ"){throw new P("unsupported operator");}var O=o.call(this);var u=t.values[0];var M;if(O._aCurrentValue){var M=O._aCurrentValue[0];}t.values=[[M,u],undefined];s.call(this,t,O);}else{var N=T.getMetadata().getName();if((N==="sap.ui.model.odata.type.Unit"||N==="sap.ui.model.odata.type.Currency"||N==="sap.ui.model.type.Unit"||N==="sap.ui.model.type.Currency")&&!t.values[0][1]&&T._aCurrentValue){t.values[0][1]=T._aCurrentValue[1];if(t.operator==="BT"){t.values[1][1]=T._aCurrentValue[1];}}s.call(this,t,T);}return t;}}function f(t,T,u,v,w,x,D){var B=this.oFormatOptions.bindingContext;var y=u.getTextForKey(t.values[0],undefined,undefined,B);if(y instanceof Promise){return y.then(function(y){t.values[1]=y;return e.call(this,t,T);}.bind(this)).catch(function(E){if(D===c.Value){if(v){t=i.call(this,T,w,x,D);return e.call(this,t,T);}else if(!u.getValidateInput()){return j.call(this,T,w,x,D);}else{throw new P(E.message);}}else{t.values[1]=t.values[0];t.values[0]=null;return g.call(this,t,T,u,false,v,w,x,D);}}.bind(this));}else if(y){t.values[1]=y;}else if(D!==c.Value){t.values[1]=t.values[0];t.values[0]=null;}return t;}function g(t,T,u,v,w,x,y,D){var B=this.oFormatOptions.bindingContext;var K=u.getKeyForText(t.values[1],B);if(K instanceof Promise){return K.then(function(K){t.values[0]=K;return e.call(this,t,T);}.bind(this)).catch(function(E){if(E._bNotUnique){if(!u.getValidateInput()){return j.call(this,T,x,y,D);}else{throw E;}}else{return h.call(this,t,T,u,v,w,x,y,D,E);}}.bind(this));}else if(K!==undefined&&K!==null){t.values[0]=K;}else{return h.call(this,t,T,u,v,w,x,y,D);}return t;}function h(t,T,u,v,w,x,y,D,E){t.values[0]=t.values[1];var z=null;if(v){var B=this.oFormatOptions.bindingContext;z=u.getTextForKey(t.values[0],undefined,undefined,B);if(z instanceof Promise){return z.then(function(z){t.values[1]=z;return e.call(this,t,T);}.bind(this)).catch(function(E){t.values[1]=null;if(w){t=i.call(this,T,x,y,D);return e.call(this,t,T);}else if(!u.getValidateInput()){return j.call(this,T,x,y,D);}throw new P(E.message);}.bind(this));}}if(z){t.values[1]=z;}else{t.values[1]=null;if(w){return i.call(this,T,x,y,D);}else if(!u.getValidateInput()){return j.call(this,T,x,y,D);}if(E){throw E;}else{throw new P(this._oResourceBundle.getText("valuehelp.VALUE_NOT_EXIST",[y]));}}return t;}function i(t,u,v,D){var T=t.getMetadata().getName();var w=u.getDefaultOperator(T);var O=u.getOperator(w);var x=O?O.format([v]):v;var y=O.getCondition(x,t,D);return y;}function j(t,u,v,D){var O;if(this.oFormatOptions.onlyEEQ){O="EEQ";}else{O="EQ";}var w=t.parseValue(v,"string");return C.createCondition(O,[w]);}d.prototype.validateValue=function(t){var T=n.call(this);if(t===undefined){return null;}else if(t===null){if(this.oFormatOptions.onlyEEQ){try{T.validateValue(null);}catch(E){if(E instanceof V){throw E;}else{return null;}}}return null;}if(typeof t!=="object"||!t.operator||!t.values||!Array.isArray(t.values)){throw new V(this._oResourceBundle.getText("field.VALUE_NOT_VALID"));}var u=p.call(this);var O=u.getOperator(t.operator);O.validate(t.values,T);};function k(){var D=this.oFormatOptions.display;if(!D){D=c.Value;}return D;}function n(){var t=this.oFormatOptions.valueType;if(!t){if(!this._oDefaultType){this._oDefaultType=new a();}t=this._oDefaultType;}return t;}function o(){return this.oFormatOptions.originalDateType;}function p(){var t=this.oFormatOptions.filterOperatorConfig;if(!t){if(!this._oFilterOperatorConfig){this._oFilterOperatorConfig=new b();}t=this._oFilterOperatorConfig;}return t;}function q(){var I=this.oFormatOptions.fieldHelpID;if(I){return sap.ui.getCore().byId(I);}return null;}function r(t){return t&&t.isA("sap.ui.model.CompositeType");}function s(t,T){if(r.call(this,T)&&t&&t.values[0]){T._aCurrentValue=t.values[0];}}return d;});
