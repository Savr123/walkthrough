/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/base/Log","./library","./NS","sap/ui/core/Control","./Messages","sap/m/ToggleButton","./NotificationsRenderer","./getResourceBundle"],function(L,v,N,C,M,T,a,g){"use strict";var b=C.extend(N.getName("Notifications"),{metadata:{library:N.getName(),publicMethods:["clearAllMessages"],aggregations:{_messagePopover:{type:"sap.m.MessagePopover",multiple:false,visibility:"hidden"},_messagePopoverToggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"}},events:{allMessagesCleared:{},messageAdded:{}}}});b.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var m;var c=new T({icon:"sap-icon://message-popup",type:sap.m.ButtonType.Emphasized,tooltip:g().getText("MESSAGEPOPOVERBUTTON"),text:"0",press:function(e){if(c.getPressed()){m.openBy(c);}else{m.close();}}});c.addStyleClass("messagePopoverButton");this.setAggregation("_messagePopoverToggleButton",c);m=new sap.m.MessagePopover({headerButton:new sap.m.Button({text:g().getText("MESSAGEPOPOVER_CLEARBUTTON"),type:sap.m.ButtonType.Emphasized,tooltip:g().getText("MESSAGEPOPOVER_CLEARBUTTON"),press:function(e){m.getParent().clearAllMessages();}}),afterClose:c.setPressed.bind(c,false)});m.addStyleClass("sapVizKitNotificationPopover");this.setAggregation("_messagePopover",m);L.addLogListener(this);};b.prototype.exit=function(){L.removeLogListener(this);if(C.prototype.exit){C.prototype.exit.call(this);}};b.prototype.onLogEntry=function(e){if(e.component.startsWith(N.getName())&&(e.level===L.Level.WARNING||e.level===L.Level.ERROR||e.level===L.Level.FATAL)){var m=e.details,c,r,d;if(M[e.details]){m=g().getText(M[e.details].summary);c=g().getText(M[e.details].cause);r=g().getText(M[e.details].resolution);d=g().getText("ERROR_DESCRIPTION_CODE");}var f=g().getText("ERROR_DESCRIPTION_COMPONENT");var h=g().getText("ERROR_DESCRIPTION_DATE");var t=g().getText("ERROR_DESCRIPTION_TIME");var l=g().getText("ERROR_DESCRIPTION_LEVEL");var i=g().getText("ERROR_DESCRIPTION_MESSAGE");var j=g().getText("ERROR_DESCRIPTION_CAUSE");var k=g().getText("ERROR_DESCRIPTION_RESOLUTION");var n="<div><b>"+f+":</b><br>"+e.component+"</div><br>"+"<div><b>"+h+":</b><br>"+e.date+"</div><br>"+(d?"<div><b>"+d+":</b><br>"+e.details+"</div><br>":"")+"<div><b>"+t+":</b><br>"+e.time.slice(0,e.time.indexOf("."))+"</div><br>"+"<div><b>"+l+":</b><br>"+e.level+"</div><br>"+"<div><b>"+i+":</b><br>"+m+"</div><br>"+(c?"<div><b>"+j+":</b><br>"+c+"</div><br>":"")+(r?"<div><b>"+k+":</b><br>"+r+"</div>":"");var o=new sap.m.MessagePopoverItem({markupDescription:true,title:e.message,description:n});var p=this.getAggregation("_messagePopover");p.addItem(o);this.getAggregation("_messagePopoverToggleButton").setText(p.getItems().length);this.fireMessageAdded();}};b.prototype.clearAllMessages=function(){var m=this.getAggregation("_messagePopover");m.removeAllItems();m.close();this.getAggregation("_messagePopoverToggleButton").setText(m.getItems().length);this.fireAllMessagesCleared();return this;};return b;});
