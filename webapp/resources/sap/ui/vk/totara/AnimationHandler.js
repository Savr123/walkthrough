sap.ui.define(["./TotaraUtils"],function(T){"use strict";var A=function(){};A.setPlayback=function(s,c){if(T.checkError(c)){return c;}var r={};var a=s.viewIdSceneIdMap.get(c.viewId);var b=s.getContext(a);var v=s.sceneBuilder.getView(c.viewId,c.sceneId);r.view=v;if(!a){c.error="Try to extract play backs for unmatching scene";return c;}var d,p;if(b.playbackIds){for(d=0;d<c.playbacks.length;d++){p=c.playbacks[d];for(var e=0;e<b.playbackIds.length;e++){if(p.id===b.playbackIds[e]){p.notLoading=false;break;}}if(p.notLoading===undefined){p.notLoading=true;}}delete b.playbackIds;r.onlyLoadingPlaybacks=true;}var f=new Set();for(d=0;d<c.playbacks.length;d++){p=c.playbacks[d];if(p.notLoading){continue;}if(p.id==null){p.id=c.viewId+"-playback";p.sequence.id=c.viewId+"-cont";p.sequenceId=p.sequence.id;A.setSequence(s,{sequences:[p.sequence]});}s.sceneBuilder.insertPlayback(p,c.viewId,a);if(p.sequenceId){var g=s.sceneBuilder.getSequence(p.sequenceId);if(g){continue;}else{f.add(p.sequenceId);s.sequenceIds.add(p.sequenceId);}}}r.sequenceIdSet=f;r.viewId=c.viewId;s.currentViewId=r.viewId;return r;};A.setSequence=function(s,c){if(T.checkError(c)){return c;}var r={};var t=new Set();for(var a=0;a<c.sequences.length;a++){var b=c.sequences[a];if(b.nodes){var n=[];var i=[];for(var d=0;d<b.nodes.length;d++){var e=b.nodes[d];if(e.rotate){var f={};if(e.rotate.trackId){f.trackId=e.rotate.trackId;t.add(e.rotate.trackId);s.trackIds.add(e.rotate.trackId);}else{f.trackId=b.id+"ROTATE"+e.sid;e.rotate.id=f.trackId;i.push(e.rotate);}f.sid=e.sid;f.binding="ROTATE";if(e.rotate.pivot){f.pivot=e.rotate.pivot;}n.push(f);}if(e.translate){var g={};if(e.translate.trackId){g.trackId=e.translate.trackId;t.add(e.translate.trackId);s.trackIds.add(e.translate.trackId);}else{g.trackId=b.id+"TRANSLATE"+e.sid;e.translate.id=g.trackId;i.push(e.translate);}g.sid=e.sid;g.binding="TRANSLATE";if(e.translate.pivot){g.pivot=e.translate.pivot;}n.push(g);}if(e.scale){var h={};if(e.scale.trackId){h.trackId=e.scale.trackId;t.add(e.scale.trackId);s.trackIds.add(e.scale.trackId);}else{h.trackId=b.id+"SCALE"+e.sid;e.scale.id=h.trackId;i.push(e.scale);}h.sid=e.sid;h.binding="SCALE";if(e.scale.pivot){h.pivot=e.scale.pivot;}n.push(h);}if(e.opacity){var o={};if(e.opacity.trackId){o.trackId=e.opacity.trackId;t.add(e.opacity.trackId);s.trackIds.add(e.opacity.trackId);}else{o.trackId=b.id+"OPACITY"+e.sid;e.opacity.id=o.trackId;i.push(e.opacity);}o.sid=e.sid;o.binding="OPACITY";n.push(o);}}if(i.length>0){this.setTrack(s,{tracks:i});}b.nodes=n;}s.sceneBuilder.insertSequence(b);s.sequenceIds.delete(b.id);}r.trackIdSet=t;return r;};A._convertTrack=function(t){t.times=t.time;if(t.vector3){t.values=t.vector3;}else if(t.quaternion){t.values=t.quaternion;t.rotateType="quaternion";for(var v=3;v<t.values.length;v=v+4){t.values[v]=-t.values[v];}}else if(t.angleAxis){t.values=t.angleAxis;t.rotateType="angleAxis";}else if(t.euler){t.values=t.euler;t.rotateType="euler";}else if(t.scalar){t.values=t.scalar;}t.cyclicInfo={};t.cyclicInfo.cyclicStart=t.cyclicStart;t.cyclicInfo.cyclicEnd=t.cyclicEnd;};A.setTrack=function(s,c){if(T.checkError(c)){return c;}var r={};var t=[];for(var a=0;a<c.tracks.length;a++){var b=c.tracks[a];this._convertTrack(b);t.push(b);s.trackIds.delete(b.id);}s.sceneBuilder.insertTracks(t);return r;};A.setHighlightStyle=function(s,c){if(T.checkError(c)){return c;}var r={};s.sceneBuilder.insertHighlightStyle(c);s.highlightStyleIds.delete(c.id);r.id=c.id;return r;};return A;});
