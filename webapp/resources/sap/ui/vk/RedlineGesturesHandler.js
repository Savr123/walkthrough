/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler","./NS","./NativeViewport"],function(E,R,N,a){"use strict";var b=E.extend(N.getName("RedlineGesturesHandler"),{metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(r){this._redlineDesign=r;this._x=0;this._y=0;this._d=0;this._gesture=false;}});b.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false;};b.prototype._getOffset=function(d){var r=d.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};b.prototype._inside=function(e,r){var c=r.getDomRef(),i=false;if(c!==null){var d=this._getOffset(c);var f={x:d.x,y:d.y,width:c.getBoundingClientRect().width,height:c.getBoundingClientRect().height};i=(e.x>=f.x&&e.x<=f.x+f.width&&e.y>=f.y&&e.y<=f.y+f.height);}return i;};b.prototype._onresize=function(e){this._gesture=false;};b.prototype.beginGesture=function(e){var v=this.getViewport();if(this._inside(e,v)){this._gesture=true;this._x=e.x;this._y=e.y;this._d=e.d;this._initd=e.d;e.handled=true;}return this;};b.prototype._pan=function(e){var v=this.getViewport(),d=e.x-this._x,c=e.y-this._y;if(d||c){this._x=e.x;this._y=e.y;var p=v.getPanningRatio();v.firePan({deltaX:d*p,deltaY:c*p});v.getRedlineElements().forEach(function(f){f.setOriginX(f.getOriginX()+v._toVirtualSpace(d));f.setOriginY(f.getOriginY()+v._toVirtualSpace(c));});this._manualRender(v);}};b.prototype._zoom=function(e){var v=this.getViewport(),z=1;var d=e.d-this._d;this._d=e.d;if(this._initd>0){z=1+d*(1/this._initd);}else if(e.n===2){if(e.points[0].y>e.points[1].y){z=Math.max(1-d*0.005,0.333);}else{z=Math.min(1+d*0.005,3);}}var t=v._getTargetViewport();if(t instanceof a){var c=t._getZoomInLimit();var f=t._getZoomOutLimit();var g=t._getZoomFactor();var n=g*z;if(n>c){z=c/g;}else if(n<f){z=f/g;}}var o=this._getOffset(v.getDomRef());var s=1-z,p=v._toVirtualSpace(e.x-o.x,e.y-o.y);v.getRedlineElements().forEach(function(h){h.applyZoom(z);var i=h.getOriginX(),j=h.getOriginY();i+=(p.x-i)*s;j+=(p.y-j)*s;h.setOriginX(i);h.setOriginY(j);});this._manualRender(v);v.fireZoom({originX:e.x-o.x,originY:e.y-o.y,zoomFactor:z});};b.prototype.move=function(e){if(this.getViewport().getDomRef()){if(e.n===1||e.n===2){this._pan(e);}if(e.n===2&&!e.buttons){this._zoom(e);}}e.handled=true;return this;};b.prototype._manualRender=function(r){if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){r.invalidate();}else{var c=sap.ui.getCore().createRenderManager();r.getRedlineElements().forEach(function(e){e.render(c);});c.flush(r.getDomRef(),false,false);c.destroy();var x=r.$();x.html(x.html());}};b.prototype.endGesture=function(e){this._gesture=false;e.handled=true;return this;};b.prototype.contextMenu=function(e){e.handled=true;};b.prototype.getViewport=function(){return this._redlineDesign;};return b;});
