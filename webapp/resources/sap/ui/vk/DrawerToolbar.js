/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./library","./DrawerToolbarRenderer","sap/ui/core/Control","sap/m/VBox","sap/m/FlexItemData","sap/m/OverflowToolbar","sap/ui/core/Icon","sap/m/Button","sap/m/ToolbarSeparator","sap/m/ToggleButton","sap/m/MenuButton","./NS","./tools/Tool","./tools/RotateTurntableTool","./tools/RotateOrbitTool","./tools/RectSelectTool","./tools/CrossSectionTool","sap/m/Menu","sap/m/MenuItem","./ZoomTo","./getResourceBundle","./threejs/Viewport","./Viewport"],function(v,D,C,V,F,O,I,B,T,a,M,N,b,R,c,d,e,f,g,Z,h,i,j){"use strict";var k=C.extend(N.getName("DrawerToolbar"),{metadata:{properties:{expanded:{type:"boolean",defaultValue:true}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}}},associations:{viewport:{type:N.getName("Viewport"),multiple:false}},events:{expanded:{parameters:{expand:{type:"boolean"}}}}},constructor:function(p,S){C.apply(this,arguments);}});var l=[{name:"show",unicode:"e000"},{name:"hide",unicode:"e001"},{name:"turntable",unicode:"e002"},{name:"orbit",unicode:"e003"},{name:"pan",unicode:"e004"},{name:"zoom",unicode:"e005"},{name:"fit-to-view",unicode:"e006"},{name:"rectangular-selection",unicode:"e007"},{name:"structure-browser",unicode:"e008"},{name:"configuration",unicode:"e009"},{name:"setting",unicode:"e00a"},{name:"full-screen",unicode:"e00b"},{name:"predefined-views",unicode:"e00c"},{name:"authoring-app",unicode:"e00d"},{name:"dot",unicode:"e00e"},{name:"empty",unicode:"e00f"},{name:"right-panel-menu",unicode:"e010"},{name:"viewer-app",unicode:"e011"},{name:"hide-association",unicode:"e012"},{name:"cross-section",unicode:"e013"},{name:"cross-section-x",unicode:"e014"},{name:"cross-section-z",unicode:"e015"},{name:"cross-section-y",unicode:"e016"},{name:"reverse-direction",unicode:"e017"},{name:"create-editable-visualisation",unicode:"e018"},{name:"cross-section-z-",unicode:"e019"}],m="vk-icons",n="vk-icons";l.forEach(function(p){sap.ui.core.IconPool.addIcon(p.name,m,n,p.unicode);});var o="sap-icon://vk-icons/";k.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}this._toolbar=new O({width:"auto",design:sap.m.ToolbarDesign.Solid,layoutData:new F({growFactor:0,shrinkFactor:0}),content:this.createButtons()});this._toolbar.ontouchstart=function(p){p.setMarked();};this._container=new V({renderType:sap.m.FlexRendertype.Bare,alignContent:sap.m.FlexAlignContent.Center,alignItems:sap.m.FlexAlignItems.Center,items:[this._toolbar,new I({src:"sap-icon://navigation-up-arrow",noTabStop:true,press:function(p){this._toggleExpanded();}.bind(this),layoutData:new F({growFactor:0,shrinkFactor:0})}).addStyleClass("drawerToolbarIcon")]});};k.prototype._getViewport=function(){var p=sap.ui.getCore().byId(this.getViewport());if(p instanceof i){return p;}if(p instanceof j&&p._implementation instanceof i){return p._implementation;}return null;};var q=[null,new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2)];k.prototype.createButtons=function(){var t=this;var p,u;function w(y,z,A){if(!t._crossSectionTool){t._crossSectionTool=new e();y.addTool(t._crossSectionTool);}p.setPressed(true);t._crossSectionTool.setActive(true,y);if(z!==undefined){t._crossSectionTool.setAxis(z);u.setIcon(o+"cross-section-"+["x","y","z"][z]);}}p=new a({icon:o+"cross-section",type:sap.m.ButtonType.Transparent,tooltip:"Cross Section",press:function(y){var z=t._getViewport();if(z){if(this.getPressed()){w(z);}else if(t._crossSectionTool){t._crossSectionTool.setActive(false,z);}}}});u=new M({type:sap.m.ButtonType.Transparent,tooltip:"Cross Section Axis",icon:o+"cross-section-x",menu:new f({items:[new g({icon:o+"cross-section-x",text:"X",press:function(y){var z=t._getViewport();if(z){w(z,0,false);}}}),new g({icon:o+"cross-section-y",text:"Y",press:function(y){var z=t._getViewport();if(z){w(z,1,false);}}}),new g({icon:o+"cross-section-z",text:"Z",press:function(y){var z=t._getViewport();if(z){w(z,2,false);}}}),new g({icon:o+"reverse-direction",text:"Flip",startsSection:true,press:function(y){var z=t._getViewport();if(z&&t._crossSectionTool&&t._crossSectionTool.getActive()){t._crossSectionTool.setFlip(!t._crossSectionTool.getFlip());}}})]})});this._gestureButtons=[new a({icon:o+"turntable",type:sap.m.ButtonType.Transparent,tooltip:"Turntable",press:function(y){var z=t._getViewport();if(z){t._activateGesture(z,0);}}}),new a({icon:o+"orbit",type:sap.m.ButtonType.Transparent,tooltip:"Orbit",pressed:false,press:function(y){var z=t._getViewport();if(z){t._activateGesture(z,1);}}}),new a({icon:o+"pan",type:sap.m.ButtonType.Transparent,tooltip:"Pan",press:function(y){var z=t._getViewport();if(z){t._activateGesture(z,2);}}}),new a({icon:o+"zoom",type:sap.m.ButtonType.Transparent,tooltip:"Zoom",press:function(){var y=t._getViewport();if(y){t._activateGesture(y,3);}}})];var x=[new B({icon:o+"show",type:sap.m.ButtonType.Transparent,tooltip:"Show",press:function(){var y=t._getViewport();if(y){var z=y._viewStateManager;var A=[];z.enumerateSelection(function(E){A.push(E);});z.setVisibilityState(A,true,false);}}}),new B({icon:o+"hide",type:sap.m.ButtonType.Transparent,tooltip:"Hide",press:function(){var y=t._getViewport();if(y){var z=y._viewStateManager;var A=[];z.enumerateSelection(function(E){A.push(E);});z.setVisibilityState(A,false,false);}}}),new T(),this._gestureButtons[0],this._gestureButtons[1],this._gestureButtons[2],this._gestureButtons[3],new T(),new B({icon:o+"fit-to-view",type:sap.m.ButtonType.Transparent,tooltip:"Fit to View",press:function(){var y=t._getViewport();if(y){y.zoomTo(Z.All,null,0.5,0);}}}),new T(),new a({icon:o+"rectangular-selection",type:sap.m.ButtonType.Transparent,tooltip:"Rectangular Selection",press:function(y){var z=t._getViewport();if(z){if(!t._rectSelectTool){t._rectSelectTool=new d();}t._rectSelectTool.setActive(this.getPressed(),z);}}}),new T(),p,u,new T(),new M({icon:o+"predefined-views",activeIcon:o+"predefined-views",type:sap.m.ButtonType.Transparent,tooltip:h().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:new f({items:[new g({text:h().getText("PREDEFINED_VIEW_INITIAL")}),new g({text:h().getText("PREDEFINED_VIEW_FRONT"),startsSection:true}),new g({text:h().getText("PREDEFINED_VIEW_BACK")}),new g({text:h().getText("PREDEFINED_VIEW_LEFT")}),new g({text:h().getText("PREDEFINED_VIEW_RIGHT")}),new g({text:h().getText("PREDEFINED_VIEW_TOP")}),new g({text:h().getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(y){var z=t._getViewport();if(z){var A=y.getParameters("item").item;var E=this.indexOfItem(A);z._viewportGestureHandler.setView(q[E],1000);}})}),new T(),new a({icon:o+"full-screen",type:sap.m.ButtonType.Transparent,tooltip:h().getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:function(y){var z=t._getViewport();var A=function(G){return!!(G.fullScreen||G.webkitIsFullScreen||G.mozFullScreen||G.msFullscreenElement);};if(this.getPressed()){if(!A(document)){if(!t._fullScreenHandler){t._fullScreenHandler=function(y){var G=A(document);if(!G){document.removeEventListener("fullscreenchange",t._fullScreenHandler);document.removeEventListener("mozfullscreenchange",t._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",t._fullScreenHandler);document.removeEventListener("MSFullscreenChange",t._fullScreenHandler);this.setPressed(false);z.removeStyleClass("sapVizKitViewerFullScreen");}}.bind(this);}var E=document.getElementsByTagName("body")[0];if(E.requestFullscreen){document.addEventListener("fullscreenchange",t._fullScreenHandler);E.requestFullscreen();}else if(E.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",t._fullScreenHandler);E.webkitRequestFullscreen();}else if(E.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",t._fullScreenHandler);E.mozRequestFullScreen();}else if(E.msRequestFullscreen){document.addEventListener("MSFullscreenChange",t._fullScreenHandler);E.msRequestFullscreen();}}z.addStyleClass("sapVizKitViewerFullScreen");}else{if(A(document)){if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}}z.removeStyleClass("sapVizKitViewerFullScreen");}}})];return x;};var r=["drawerToolbarIconTurntable","drawerToolbarIconOrbit","drawerToolbarIconPan","drawerToolbarIconZoom"];var s=function(p){this.viewport=p;this._mode=1;this._gesture=false;this._x=0;this._y=0;};s.prototype.beginGesture=function(p){this._gesture=true;if(this._mode<3){this._x=p.points[0].x;this._y=p.points[0].y;}else{this._x=p.x;this._y=p.y;}};s.prototype.endGesture=function(){this._gesture=false;this.viewport.removeStyleClass(r[this._mode]);};s.prototype.move=function(t){if(this._gesture&&t.n==1){this.viewport.addStyleClass(r[this._mode]);var p=t.points[0];var u=p.x-this._x;var w=p.y-this._y;var x=this.viewport._viewportGestureHandler._cameraController;switch(this._mode){case 0:x.rotate(u,w,true);break;case 1:x.rotate(u,w,false);break;case 2:x.pan(u,w);break;case 3:x.zoom(1+w*0.005);break;default:break;}this._x=p.x;this._y=p.y;t.handled=true;}};s.prototype.hover=function(){};s.prototype.getViewport=function(){return this.viewport;};k.prototype._activateGesture=function(p,t){this._gestureButtons.forEach(function(u,w){u.setPressed(w===t);});if(!this._cameraHandler){this._cameraHandler=new s(p);p._loco.addHandler(this._cameraHandler,0);}this._cameraHandler._mode=t;};k.prototype._getToolbar=function(){return this._toolbar;};k.prototype._toggleExpanded=function(){var p=!this.getExpanded();this.setExpanded(p);this.fireExpanded({expand:p});};k.prototype.setExpanded=function(E){this.setProperty("expanded",E,true);var p=this.getDomRef();if(p){if(!E){p.classList.add("drawerToolbarCollapsed");p.classList.remove("drawerToolbarExpanded");this._container.addStyleClass("vboxCollapsed");}else{p.classList.add("drawerToolbarExpanded");p.classList.remove("drawerToolbarCollapsed");this._container.removeStyleClass("vboxCollapsed");}}return this;};k.prototype.onAfterRendering=function(){var p=this._getViewport();if(p){this._activateGesture(p,1);}};return k;});
