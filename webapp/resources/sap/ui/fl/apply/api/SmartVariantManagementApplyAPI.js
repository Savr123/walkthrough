/*
 * ! OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/DefaultVariant","sap/ui/fl/StandardVariant","sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/registry/Settings","sap/ui/fl/Utils"],function(D,S,C,a,U){"use strict";var b={_PERSISTENCY_KEY:"persistencyKey",loadChanges:function(p){var c=p.control||arguments[0];var A=U.getAppDescriptor(c);var s=U.getSiteId(c);var d=this._getStableId(c);var P={appDescriptor:A,siteId:s,includeVariants:true};var o=C.getChangePersistenceForControl(c);return o.getChangesForVariant(this._PERSISTENCY_KEY,d,P);},getChangeById:function(p){var c=p.control||arguments[0];var i=p.id||arguments[1];if(!i||!c){U.log.error("sId or oControl is not defined");return undefined;}var o=this._getChangeMap(c);return o[i];},isVariantSharingEnabled:function(){return a.getInstance().then(function(i){return i.isVariantSharingEnabled();});},isApplicationVariant:function(p){var c=p.control||arguments[0];if(U.isApplicationVariant(c)){return true;}var o=U.getComponentForControl(c);if(o&&o.getAppComponent){o=o.getAppComponent();if(o){return true;}}return false;},isVendorLayer:function(){return U.isVendorLayer();},isVariantDownport:function(){return b.isVendorLayer()&&U.isHotfixMode();},getDefaultVariantId:function(p){var c=this._getChangeMap(p.control||arguments[0]);return D.getDefaultVariantId(c);},getExecuteOnSelect:function(p){var c=this._getChangeMap(p.control||arguments[0]);return S.getExecuteOnSelect(c);},_getStableId:function(c){if(!c){return undefined;}var s;try{s=c.getPersistencyKey();}catch(e){s="";}return s;},_getChangeMap:function(c){var o=C.getChangePersistenceForControl(c);var s=b._getStableId(c);return o.getSmartVariantManagementChangeMap()[s]||{};}};return b;},true);
