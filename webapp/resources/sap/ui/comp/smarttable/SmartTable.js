/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/thirdparty/jquery','sap/m/library','sap/ui/core/library','sap/m/Column','sap/m/ColumnListItem','sap/m/Label','sap/m/MessageBox','sap/m/Table','sap/m/Text','sap/m/Title','sap/m/OverflowToolbar','sap/m/ToolbarSpacer','sap/m/OverflowToolbarButton','sap/m/ToolbarSeparator','sap/m/VBox','sap/m/FlexItemData','sap/ui/comp/library','sap/ui/comp/providers/TableProvider','sap/ui/comp/smartfilterbar/FilterProvider','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/model/Sorter','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/model/json/JSONModel','sap/ui/table/AnalyticalColumn','sap/ui/table/AnalyticalTable','sap/ui/table/Column','sap/ui/table/Table','sap/ui/table/TreeTable','sap/ui/comp/personalization/Controller','sap/ui/comp/personalization/Util','sap/ui/comp/util/FormatUtil','sap/ui/comp/util/FullScreenUtil','sap/ui/comp/odata/ODataModelUtil','sap/ui/comp/odata/ODataType','sap/ui/comp/state/UIState','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/core/format/NumberFormat','sap/ui/Device','sap/base/Log','sap/base/util/deepEqual','sap/m/MenuButton','sap/m/Menu','sap/m/MenuItem','sap/base/util/merge',"sap/m/ColumnHeaderPopover",'sap/m/ColumnPopoverActionItem','sap/m/ColumnPopoverSortItem'],function(q,M,c,C,a,L,b,R,T,d,O,f,g,h,V,F,l,j,k,S,m,n,o,J,A,p,r,s,t,u,P,v,w,x,y,U,z,N,D,B,E,G,H,I,K,Q,W,X){"use strict";var Y=M.ToolbarDesign;var Z=c.SortOrder;var $=V.extend("sap.ui.comp.smarttable.SmartTable",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smarttable/SmartTable.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},initiallyVisibleFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},tableType:{type:"sap.ui.comp.smarttable.TableType",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useExportToExcel:{type:"boolean",group:"Misc",defaultValue:true},exportType:{type:"sap.ui.comp.smarttable.ExportType",group:"Misc",defaultValue:"UI5Client"},useTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},toolbarStyleClass:{type:"string",group:"Misc",defaultValue:null},enableCustomFilter:{type:"boolean",group:"Misc",defaultValue:true},persistencyKey:{type:"string",group:"Misc",defaultValue:null},useOnlyOneSolidToolbar:{type:"boolean",group:"Misc",defaultValue:false},placeToolbarInTable:{type:"boolean",group:"Misc",defaultValue:false},currentVariantId:{type:"string",group:"Misc",defaultValue:null},editable:{type:"boolean",group:"Misc",defaultValue:false},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},tableBindingPath:{type:"string",group:"Misc",defaultValue:null},editTogglable:{type:"boolean",group:"Misc",defaultValue:false},demandPopin:{type:"boolean",group:"Misc",defaultValue:false},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:false},initialNoDataText:{type:"string",group:"Misc",defaultValue:null}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{customToolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},noData:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},semanticKeyAdditionalControl:{type:"sap.ui.core.Control",multiple:false}},events:{initialise:{},beforeRebindTable:{},editToggled:{},dataRequested:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fieldChange:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},beforePaste:{allowPreventDefault:true,parameters:{columnInfos:{type:"object[]"}}},paste:{parameters:{result:{type:"object"}}}}},renderer:{apiVersion:2},constructor:function(){V.apply(this,arguments);this._aExistingColumns=[];this._aAlwaysSelect=[];this._oTemplate=null;this._mFieldMetadataByKey={};this._createToolbar();this._oP13nDialogSettings=this.data("p13nDialogSettings");if(typeof this._oP13nDialogSettings==="string"){try{this._oP13nDialogSettings=JSON.parse(this._oP13nDialogSettings);}catch(e){this._oP13nDialogSettings=null;}}this._bIsFilterPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.filter)?this._oP13nDialogSettings.filter.visible!==false:true;this._createTable();this.attachModelContextChange(this._initialiseMetadata,this);}});$.prototype.init=function(){V.prototype.init.call(this);this.addStyleClass("sapUiCompSmartTable");this.setFitContainer(true);this._aColumnKeys=[];this._aDeactivatedColumns=[];this._mLazyColumnMap={};};$.prototype._getVariantManagementControl=function(e){var i=null;if(e){if(typeof e==='string'){i=sap.ui.getCore().byId(e);}else{i=e;}if(i){if(!(i instanceof S)){B.error("Control with the id="+e.getId?e.getId():e+" not of expected type");return null;}}}return i;};$.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||(!this.getUseVariantManagement()&&!this.getUseTablePersonalisation())||!this.getPersistencyKey()){return;}var e=new z({type:"table",keyName:"persistencyKey",dataSource:"TODO"});e.setControl(this);var i=this.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){i=this._oSmartFilter.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}}else{this._oVariantManagement=new S(this.getId()+"-variant",{showShare:true});}if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(e);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this);}};$.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding();}};$.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}};$.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()});};$.prototype.setTableBindingPath=function(e){this.setProperty("tableBindingPath",e,true);return this;};$.prototype.setShowTablePersonalisation=function(e){this.setProperty("showTablePersonalisation",e,true);if(this._oTablePersonalisationButton){this._oTablePersonalisationButton.setVisible(e);}return this;};$.prototype.setUseVariantManagement=function(e){this.setProperty("useVariantManagement",e,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!e);}return this;};$.prototype.setShowVariantManagement=function(e){this.setProperty("showVariantManagement",e,true);if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(e);if(this._oSeparator){this._oSeparator.setVisible(e);}}return this;};$.prototype.setToolbarStyleClass=function(e){this.setProperty("toolbarStyleClass",e,true);return this;};$.prototype.setCustomToolbar=function(e){this._oCustomToolbar=e;return this;};$.prototype.getCustomToolbar=function(){return this._oCustomToolbar;};$.prototype.setHeader=function(e){var i=this.getProperty("header"),_;this.setProperty("header",e,true);if(this.bIsInitialised&&this._oToolbar){_=(!i===!e);if(!_){this._createToolbarContent();}else{this._refreshHeaderText();}}return this;};$.prototype.setShowRowCount=function(e){this.setProperty("showRowCount",e,true);this._refreshHeaderText();return this;};$.prototype.setEditable=function(e){this.setProperty("editable",e,true);if(this._oEditModel){this._oEditModel.setProperty("/editable",e);}if(this._oEditButton){this._oEditButton.setIcon(e?"sap-icon://display":"sap-icon://edit");}if(this._isMobileTable&&this._oTable.setKeyboardMode){this._oTable.setKeyboardMode(e?"Edit":"Navigation");}return this;};$.prototype.setDemandPopin=function(e){var i=this.getDemandPopin();if(i===e){return this;}this.setProperty("demandPopin",e,true);if(this.bIsInitialised){if(e){this._updateColumnsPopinFeature();}else{this._deactivateColumnsPopinFeature();}}return this;};$.prototype._refreshHeaderText=function(){if(!this._headerText){return;}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}var e=this.getHeader();this._headerText.setVisible(!!e);if(this.getShowRowCount()){var i=parseInt(this._getRowCount(true));var _=this._oNumberFormatInstance.format(i);e+=" ("+_+")";}this._headerText.setText(e);};$.prototype._addFullScreenButton=function(){if(this._oFullScreenButton){this._oToolbar.removeContent(this._oFullScreenButton);}if(this.getShowFullScreenButton()){if(!this._oFullScreenButton){this._oFullScreenButton=new g(this.getId()+"-btnFullScreen",{press:[function(){this._toggleFullScreen(!this.bFullScreen);},this]});}this._renderFullScreenButton();this._oToolbar.addContent(this._oFullScreenButton);}};$.prototype._createToolbar=function(){var e=null;if(!this._oToolbar){e=this.getCustomToolbar();if(e){this._oToolbar=e;}else{this._oToolbar=new O({design:Y.Transparent});this._oToolbar.addStyleClass("sapUiCompSmartTableToolbar");if(this.getToolbarStyleClass()){this._oToolbar.addStyleClass(this.getToolbarStyleClass());}}this._oToolbar.setLayoutData(new F({shrinkFactor:0}));}};$.prototype._toggleFullScreen=function(e,i){if(!this._oFullScreenButton||(e===this.bFullScreen&&!i)){return;}this.bFullScreen=e;w.toggleFullScreen(this,this.bFullScreen,this._oFullScreenButton,this._toggleFullScreen);this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:e});};$.prototype._renderFullScreenButton=function(){var e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp"),i;i=this.bFullScreen?e.getText("CHART_MINIMIZEBTN_TOOLTIP"):e.getText("CHART_MAXIMIZEBTN_TOOLTIP");this._oFullScreenButton.setTooltip(i);this._oFullScreenButton.setText(i);this._oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen");};$.prototype._createToolbarContent=function(){if(!this._oToolbar){this._createToolbar();}this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addEditTogglableToToolbar();this._addTablePersonalisationToToolbar();this._addExportToExcelToToolbar();this._addFullScreenButton();this._bToolbarInsertedIntoItems=true;this._placeToolbar();};$.prototype._placeToolbar=function(){if(!this.getPlaceToolbarInTable()){this.insertItem(this._oToolbar,0);}else if(this._isMobileTable){this._oTable.setHeaderToolbar(this._oToolbar);}else{this._oTable.addExtension(this._oToolbar);}};$.prototype.getToolbar=function(){return this._oToolbar;};$.prototype._addEditTogglableToToolbar=function(){var e;if(this._oEditButton){this._oToolbar.removeContent(this._oEditButton);}if(this.getEditTogglable()){if(!this._oEditButton){e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EDITTOGGLE_TOOLTIP");this._oEditButton=new g(this.getId()+"-btnEditToggle",{icon:this.getEditable()?"sap-icon://display":"sap-icon://edit",text:e,tooltip:e,press:[function(){var i=this.getEditable();i=!i;this.setEditable(i,true);this.fireEditToggled({editable:i});},this]});}this._oToolbar.addContent(this._oEditButton);}};$.prototype._addHeaderToToolbar=function(){if(this._headerText){this._oToolbar.removeContent(this._headerText);}if(!this._headerText){this._headerText=new d(this.getId()+"-header");this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartTableHeader");}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0);};$.prototype._addSeparatorToToolbar=function(){if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator);}if(this.getHeader()&&this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(!this._oSeparator){this._oSeparator=new h(this.getId()+"-toolbarSeperator");if(!this.getShowVariantManagement()){this._oSeparator.setVisible(false);}}this._oToolbar.insertContent(this._oSeparator,0);}if(this._oToolbar){this._oToolbar.addStyleClass("sapMTBHeader-CTX");}};$.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oToolbar.removeContent(this._oVariantManagement);if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0);if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement());}}}};$.prototype._addSpacerToToolbar=function(){var e=false,_=this._oToolbar.getContent(),i,a1;if(_){a1=_.length;i=0;for(i;i<a1;i++){if(_[i]instanceof f){e=true;break;}}}if(!e){this._oToolbar.addContent(new f(this.getId()+"-toolbarSpacer"));}};$.prototype._addTablePersonalisationToToolbar=function(){var e;if(this._oTablePersonalisationButton){this._oToolbar.removeContent(this._oTablePersonalisationButton);}if(this.getUseTablePersonalisation()){if(!this._oTablePersonalisationButton){e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("TABLE_PERSOBTN_TOOLTIP");this._oTablePersonalisationButton=new g(this.getId()+"-btnPersonalisation",{icon:"sap-icon://action-settings",text:e,tooltip:e,press:[function(i){this._oPersController.openDialog();},this]});this._oTablePersonalisationButton.setVisible(this.getShowTablePersonalisation());}this._oToolbar.addContent(this._oTablePersonalisationButton);}};$.prototype._triggerGWExport=function(){var e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var i=function(){var a1=this._getRowBinding();var b1=a1.getDownloadUrl("xlsx");b1=this._removeExpandParameter(b1);if(b1&&b1.length>2048&&D.browser.msie){b.error(e.getText("DOWNLOAD_TOO_COMPLEX_TEXT"));return;}var c1={url:b1};this.fireBeforeExport({exportSettings:c1});window.open(c1.url);}.bind(this);var _=this._getRowCount(true);if(_>10000){b.confirm(e.getText("DOWNLOAD_CONFIRMATION_TEXT",_),{actions:[b.Action.YES,b.Action.NO],onClose:function(a1){if(a1===b.Action.YES){i();}}});}else{i();}};$.prototype._addExportToExcelToToolbar=function(){if(this._oUseExportToExcel){this._oToolbar.removeContent(this._oUseExportToExcel);}if(this.getUseExportToExcel()&&(this._bTableSupportsExcelExport||this.getExportType()==="UI5Client")){var e,i,_,a1=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");if(!this._oUseExportToExcel){e=a1.getText("TABLE_EXPORT_TEXT");i=this.getId()+"-btnExcelExport";_="sap-icon://excel-attachment";if(this.getExportType()==="GW"){this._oUseExportToExcel=new g(i,{icon:_,text:e,tooltip:e,press:[this._triggerGWExport,this]});}else{this._oUseExportToExcel=new G(i,{icon:_,tooltip:e,type:M.ButtonType.Ghost,buttonMode:M.MenuButtonMode.Split,useDefaultActionOnly:true,defaultAction:[function(){this._triggerUI5ClientExport();},this],menu:[new H({items:[new I({text:a1.getText("QUICK_EXPORT"),press:[function(){this._triggerUI5ClientExport();},this]}),new I({text:a1.getText("EXPORT_WITH_SETTINGS"),press:function(){var b1=this._loadExportLibrary();b1.then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(c1){var d1=this._cachedExcelSettings||{fileName:this.getHeader()};var e1=c1.openExportSettingsDialog(d1,this);e1.then(function(f1){f1.getUserInput().then(function(g1){if(g1){this._cachedExcelSettings=g1;if(g1.includeFilterSettings){c1.parseFilterConfiguration(this._getRowBinding(),this._getColumnLabel.bind(this)).then(function(h1){this._triggerUI5ClientExport(g1,h1);}.bind(this));}else{this._triggerUI5ClientExport(g1);}}}.bind(this));}.bind(this));}.bind(this));}.bind(this));}.bind(this)})]})]});}this._setExcelExportEnableState();}this._oToolbar.addContent(this._oUseExportToExcel);}};$.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=sap.ui.getCore().loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};$.prototype._getColumnLabel=function(e){var i;if(typeof e==='string'){e=this._getColumnByKey(e);}if(!e){return null;}if(e.getLabel){i=e.getLabel();}if(e.getHeader){i=e.getHeader();}return(i&&i.getText)?i.getText():null;};$.prototype._getColumnWidthNumber=function(e){if(e.indexOf("em")>0){return Math.round(parseFloat(e));}if(e.indexOf("px")>0){return Math.round(parseInt(e)/16);}return"";};$.prototype._triggerUI5ClientExport=function(e,_){var a1=this._loadExportLibrary();a1.then(function(){var b1=this._oTable.getColumns(),i,c1=b1.length,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1,n1,o1,p1,q1,r1=[];var s1=e&&e.splitCells;if(this._isMobileTable&&b1.length){b1=b1.sort(function(z1,A1){return z1.getOrder()-A1.getOrder();});}for(i=0;i<c1;i++){g1=null;h1=null;i1=null;d1=b1[i];if(d1.getVisible()){if(d1.getLeadingProperty){g1=d1.getLeadingProperty();}e1=d1.data("p13nData");if(!g1&&e1){g1=e1["leadingProperty"];}if(Array.isArray(g1)){g1=g1[0];}if(g1){f1=this._getColumnLabel(d1);n1=d1.getWidth().toLowerCase()||e1.width||"";n1=this._getColumnWidthNumber(n1);o1=e1.type==="numeric"?"number":e1.type;q1=null;p1=null;if(e1.isCurrency||o1==="number"){o1=e1.isCurrency?"currency":"number";if(s1){i1=e1.unit;}}else if(e1.isDigitSequence){o1="number";}else if(o1!="date"&&y.isDateOrTime(e1.edmType)){o1=y.getTypeName(e1.edmType);if(o1==="DateTimeOffset"){o1="DateTime";}}else if(o1==="stringdate"){o1="date";p1="YYYYMMDD";}else if(o1==="boolean"){q1=y.getType(e1.edmType);}else if(e1.description){if(s1&&e1.displayBehaviour!=="idOnly"){o1="string";i1=e1.description;}else{h1=v.getFormattedExpressionFromDisplayBehaviour(e1.displayBehaviour,"{0}","{1}");}}r1.push({columnId:d1.getId(),property:h1?[g1,e1.description]:g1,type:o1,inputFormat:p1,label:f1?f1:g1,width:n1,textAlign:d1.getHAlign(),template:h1,trueValue:(o1==="boolean"&&q1)?q1.formatValue(true,"string"):undefined,falseValue:(o1==="boolean"&&q1)?q1.formatValue(false,"string"):undefined,unitProperty:(o1==="currency"||(o1==="number"&&!s1))?e1.unit:undefined,displayUnit:o1==="currency"&&!s1,precision:e1.precision,scale:e1.scale});if(i1){j1=this._getColumnByKey(i1);k1=f1;f1=null;if(j1){f1=this._getColumnLabel(j1);n1=j1.getWidth().toLowerCase()||"";n1=this._getColumnWidthNumber(n1);m1=j1.getHAlign();}else{l1=this._mFieldMetadataByKey[i1];if(l1){f1=l1.label;n1=l1.width;}}r1.push({columnId:d1.getId()+"-additionalProperty",property:i1,type:"string",label:f1||(k1?k1+" (2)":i1),width:n1,textAlign:m1});}}}}if(!r1||!r1.length){b.error(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}var t1=this._getRowBinding();var u1=this.getModel();var v1=e?e.fileName:this.getHeader();var w1=!this._isTreeTable?this._getRowCount(true):undefined;var x1=t1.getDownloadUrl&&t1.getDownloadUrl("json");var y1=u1.sServiceUrl;sap.ui.require(["sap/ui/export/Spreadsheet","sap/ui/export/ExportUtils"],function(z1,A1){x1=A1.interceptUrl(x1);y1=A1.interceptUrl(y1);var B1={workbook:{columns:r1,hierarchyLevel:(this._isTreeTable&&t1.getTreeAnnotation)?t1.getTreeAnnotation("hierarchy-level-for"):undefined},dataSource:{type:"odata",dataUrl:x1,serviceUrl:y1,headers:u1.getHeaders(),count:w1,useBatch:u1.bUseBatch},fileName:v1};var C1={splitCells:false,includeFilterSettings:false};if(e){C1.splitCells=e.splitCells;C1.includeFilterSettings=e.includeFilterSettings;}if(_){B1.workbook.context={metaSheetName:_.name,metainfo:[_]};}this.fireBeforeExport({exportSettings:B1,userExportSettings:C1});var D1=new z1(B1);var E1=function(){this.destroy();}.bind(D1);D1.build().then(E1,E1);}.bind(this));}.bind(this));};$.prototype._removeExpandParameter=function(e){var i=e.replace(new RegExp("([\\?&]\\$expand=[^&]+)(&?)"),function(_,a1,b1){return b1?a1.substring(0,1):"";});return i;};$.prototype._getRowCount=function(e){var i=this._getRowBinding();if(!i){return 0;}var _=0;if(e&&i.getTotalSize){_=i.getTotalSize();}else{_=i.getLength();}if(_<0||_==="0"){_=0;}return _;};$.prototype._setExcelExportEnableState=function(){if(this._oUseExportToExcel){var i=this._getRowCount();this._oUseExportToExcel.setEnabled(i>0);}};$.prototype._createPersonalizationController=function(){if(this._oPersController||!this.getUseTablePersonalisation()){return;}var e=this._oP13nDialogSettings;e=this._setIgnoreFromPersonalisationToSettings(e);this._oPersController=new u(this.getId()+"-persoController",{table:this._oTable,columnKeys:this._aColumnKeys,setting:e,resetToInitialTableState:!this.getUseVariantManagement(),beforePotentialTableChange:[this._beforePersonalisationModelDataChange,this],afterPotentialTableChange:[this._afterPersonalisationModelDataChange,this],afterP13nModelDataChange:[this._personalisationModelDataChange,this],requestColumns:[this._personalisationRequestColumns,this]});};$.prototype._setIgnoreFromPersonalisationToSettings=function(e){var i=P.createArrayFromString(this.getIgnoreFromPersonalisation());if(i.length){if(!e){e={};}var _=function(a1){if(!e[a1]){e[a1]={};}e[a1].ignoreColumnKeys=i;};_("filter");_("sort");_("group");_("columns");}return e;};$.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};$.prototype.setEntitySet=function(e){this.setProperty("entitySet",e,true);this._initialiseMetadata();return this;};$.prototype._initialiseMetadata=function(e){var i=this,_=i;if(e){_=e.getSource();}if(!_.bIsInitialised){x.handleModelInit(_,_._onMetadataInitialised);}};$.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(!this.bIsInitialised){this._createTableProvider();if(this._oTableProvider){this._aTableViewMetadata=this._oTableProvider.getTableViewMetadata();if(this._aTableViewMetadata){if(!this._isMobileTable&&this.getDemandPopin()){this.setDemandPopin(false);B.error("use SmartTable property 'demandPopin' only  with responsive table, property has been set to false");}this.detachModelContextChange(this._initialiseMetadata,this);this.bIsInitialised=true;this._bTableSupportsExcelExport=this._oTableProvider.getSupportsExcelExport();this._bMultiUnitBehaviorEnabled=this._oTableProvider.getMultiUnitBehaviorEnabled();this._listenToSmartFilter();this._createVariantManagementControl();this._createToolbarContent();this._aAlwaysSelect=this._oTableProvider.getRequestAtLeastFields();this._createContent();this._createPersonalizationController();this._oEditModel=new J({editable:this.getEditable()});this.setModel(this._oEditModel,"sm4rtM0d3l");this.attachEvent("_change",this._onPropertyChange,this);this.fireInitialise();if(!this._oVariantManagement||(this._oVariantManagement&&this._bVariantInitialised)){this._checkAndTriggerBinding();}}}}};$.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){if(this._oSmartFilter.isInitialised()){this._oSmartFilter.search();}else{this._oSmartFilter.attachEventOnce("initialise",function(){this._oSmartFilter.search();},this);}}else{this._reBindTable();}}}};$.prototype._aStaticProperties=["entitySet","ignoredFields","initiallyVisibleFields","ignoreFromPersonalisation","tableType","useTablePersonalisation","enableAutoBinding","persistencyKey","smartFilterId"];$.prototype._aToolbarRelatedProperties=["useExportToExcel","exportType","showFullScreenButton","editTogglable","placeToolbarInTable"];$.prototype._onPropertyChange=function(e){var i=e.getParameter("name");if(this._aStaticProperties.indexOf(i)>-1){B.error("Property "+i+" cannot be changed after the SmartTable with id "+this.getId()+" is initialised");}if(this._oToolbar&&this._aToolbarRelatedProperties.indexOf(i)>-1){if(i==="exportType"&&this._oUseExportToExcel){this._oUseExportToExcel.destroy();this._oUseExportToExcel=null;}this._createToolbarContent();}};$.prototype._createTableProvider=function(){var e,i,_;i=this.getEntitySet();_=this.getIgnoredFields();e=this.getModel();if(e&&i){if(this._aExistingColumns.length){if(_){_+=","+this._aExistingColumns.toString();}else{_=this._aExistingColumns.toString();}}this._oTableProvider=new j({entitySet:i,ignoredFields:_,initiallyVisibleFields:this.getInitiallyVisibleFields(),isEditableTable:this.getEditable(),smartTableId:this.getId(),isAnalyticalTable:!!this._isAnalyticalTable,isMobileTable:!!this._isMobileTable,dateFormatSettings:this.data("dateFormatSettings"),currencyFormatSettings:this.data("currencyFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),useSmartField:this.data("useSmartField"),useSmartToggle:this.data("useSmartToggle"),skipAnnotationParse:this.data("skipAnnotationParse"),lineItemQualifier:this.data("lineItemQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),enableInResultForLineItem:this.data("enableInResultForLineItem"),_semanticKeyAdditionalControl:this.getAggregation("semanticKeyAdditionalControl"),model:e,semanticObjectController:this.getSemanticObjectController()});}};$.prototype._listenToSmartFilter=function(){var e,i,_=false;e=this.getSmartFilterId();this._oSmartFilter=this._findControl(e,"sap.ui.comp.filterbar.FilterBar");if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindTable,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this);_=true;}i=this.getInitialNoDataText();if(i){_=i==="$FILTERBAR";if(!_&&i!=="$NO_FILTERBAR"){this._setNoDataText(i);return;}}if(_){this._setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA"));}else{this._setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"));}};$.prototype._filterChangeEvent=function(){if(this._isTableBound()&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true);}};$.prototype._showOverlay=function(e){if(e){var i={show:true};this.fireShowOverlay({overlay:i});e=i.show;}this._oTable.setShowOverlay(e);};$.prototype._findControl=function(i,e){var _,a1;if(i){_=sap.ui.getCore().byId(i);if(!_||!_.isA(e)){a1=this._getView();if(a1){_=a1.byId(i);}}if(_&&!_.isA(e)){_=undefined;}}return _;};$.prototype._getView=function(){if(!this._oView){var e=this.getParent();while(e){if(e.isA("sap.ui.core.mvc.View")){this._oView=e;break;}e=e.getParent();}}return this._oView;};$.prototype.rebindTable=function(e){this._reBindTable(null,e);};$.prototype._reBindTable=function(e,_){var a1,b1,c1,i,d1,e1,f1=[],g1,h1,i1,j1,k1,l1,m1,n1={},o1={preventTableBind:false};c1=this._getTablePersonalisationData()||{};g1=c1.filters;h1=c1.excludeFilters;m1=c1.sorters;if(this._oSmartFilter){e1=this._oSmartFilter.getFilters();n1=this._oSmartFilter.getParameters()||{};}if(e1&&e1.length){if(h1){f1=[new n([e1[0],h1],true)];}else{f1=e1;}}else if(h1){f1=[h1];}if(g1){g1=f1.concat(g1);}else{g1=f1;}i1=this._getRequestAtLeastFields();k1=this._getRelevantColumnPaths();j1=k1["select"];if(!j1||!j1.length){j1=i1;}else{d1=i1.length;for(i=0;i<d1;i++){if(j1.indexOf(i1[i])<0){j1.push(i1[i]);}}}if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.select){this._mSelectExpandForGroup.select.forEach(function(r1){if(j1.indexOf(r1)<0){j1.push(r1);}});}if(j1.length){n1["select"]=j1.toString();l1=k1["expand"]||[];if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.expand){this._mSelectExpandForGroup.expand.forEach(function(r1){if(l1.indexOf(r1)<0){l1.push(r1);}});}if(l1.length){n1["expand"]=l1.join(",");}}n1["useBatchRequests"]=true;if(!m1){m1=[];}o1.filters=g1;o1.sorter=m1;o1.parameters=n1;o1.length=undefined;o1.startIndex=undefined;o1.events={};this.fireBeforeRebindTable({bindingParams:o1});if(!o1.preventTableBind){m1=o1.sorter;g1=o1.filters;n1=o1.parameters;j1=o1.parameters["select"];if(!j1||!j1.length){b.error(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}b1=this.getTableBindingPath()||("/"+this.getEntitySet());if(this._oTable.resumeUpdateAnalyticalInfo){this._oTable.resumeUpdateAnalyticalInfo(true,false);}this._bDataLoadPending=true;this._bIgnoreChange=false;if(this._bForceTableUpdate){_=true;this._bForceTableUpdate=false;}if(!_){a1=this._oTable.getBinding(this._sAggregation);if(a1&&a1.mParameters){_=!(E(n1,a1.mParameters,true)&&E(n1.custom,a1.mParameters.custom)&&!o1.length&&!o1.startIndex&&b1===a1.getPath());}}if(!this._bNoDataUpdated){this._bNoDataUpdated=true;this._setNoDataText();}if(!a1||!this._bIsTableBound||_){$._addBindingListener(o1,"change",this._onBindingChange.bind(this));$._addBindingListener(o1,"dataRequested",this._onDataRequested.bind(this));$._addBindingListener(o1,"dataReceived",this._onDataReceived.bind(this));if(this._isMobileTable){var p1=this._oTable?this._oTable.getColumns():[];var q1=this._oTemplate?this._oTemplate.getCells():[];if(p1.length===q1.length){p1.forEach(function(r1,s1){q1[s1].setBindingContext(r1.getVisible()?undefined:null);});}}this._oTable.bindRows({path:b1,filters:g1,sorter:m1,parameters:n1,length:o1.length,startIndex:o1.startIndex,template:this._oTemplate,events:o1.events});this._bIsTableBound=true;}else{a1.sort(m1);a1.filter(g1,"Application");}this._showOverlay(false);}};$.prototype._onDataRequested=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=true;this.fireDataRequested(e.getParameters());};$.prototype._onDataReceived=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=false;this._onDataLoadComplete(e,true);this.fireDataReceived(e);};$.prototype._onBindingChange=function(e){if(this._bIgnoreChange){return;}var i,_=false;i=(e&&e.getParameter)?e.getParameter("reason"):undefined;if(!i||i==="filter"||i==="context"||(!this._bDataLoadPending&&i==="change")){_=true;}if(i==="change"||_){this._onDataLoadComplete(e,_);}};$._addBindingListener=function(e,i,_){if(!e.events){e.events={};}if(!e.events[i]){e.events[i]=_;}else{var a1=e.events[i];e.events[i]=function(){_.apply(this,arguments);a1.apply(this,arguments);};}};$.prototype._onDataLoadComplete=function(e,i){if(this._bDataLoadPending||i){this._bDataLoadPending=false;this.updateTableHeaderState();}};$.prototype._isTableBound=function(){if(this._bIsTableBound){return true;}if(this._oTable){return this._oTable.isBound(this._sAggregation);}return false;};$.prototype.setNoData=function(e){this._oNoData=e;return this;};$.prototype.getNoData=function(){return this._oNoData;};$.prototype._setNoDataText=function(e){var i=this._oTable.setNoData;if(!i){i=this._oTable.setNoDataText;}if(!i){return;}var _=e;if(!_){_=this.getNoData();}if(!_){_=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_RESULTS");}i.call(this._oTable,_,true);};$.prototype.updateTableHeaderState=function(){this._refreshHeaderText();this._setExcelExportEnableState();};$.prototype._createContent=function(){var i,e=0,_,a1,b1,c1=[];if(this._aExistingColumns&&this._aExistingColumns.length){this._aColumnKeys=[].concat(this._aExistingColumns.reverse());}a1=this._parseIndexedColumns();e=this._aTableViewMetadata.length;for(i=0;i<e;i++){_=this._aTableViewMetadata[i];if(_.isInitiallyVisible){this._aColumnKeys.push(_.name);}else{c1.push(_.name);}if(!(_.isInitiallyVisible||_.inResult)){this._mLazyColumnMap[_.name]=_;}else{b1=this._createColumnForField(_);this._oTable.addColumn(b1);}this._mFieldMetadataByKey[_.name]=_;}this._insertIndexedColumns(a1);this._aColumnKeys=this._aColumnKeys.concat(c1);this._updateColumnsPopinFeature();this._storeInitialColumnSettings();};$.prototype._createColumnForField=function(e){var i,_;_=this.getId()+"-"+e.name.replace(/[^A-Za-z0-9_.:-]+/g,"_");i=this._createColumn(e,_);e.isColumnCreated=true;i.data("p13nData",{columnKey:e.name,leadingProperty:e.name,additionalProperty:e.additionalProperty,navigationProperty:e.navigationProperty,sortProperty:e.sortable?e.name:undefined,filterProperty:e.filterable?e.name:undefined,isGroupable:e.sortable&&e.filterable&&e.aggregationRole==="dimension",fullName:e.hasValueListAnnotation?e.fullName:null,type:e.filterType,typeInstance:e.modelType,maxLength:e.maxLength,precision:e.precision,scale:e.scale,align:e.align,edmType:e.type,displayBehaviour:e.displayBehaviour,description:e.description,isDigitSequence:e.isDigitSequence,isCurrency:e.isCurrencyField,unit:e.unit,width:e.width,aggregationRole:e.aggregationRole});if(e.filterable&&i.setFilterProperty){i.setFilterProperty(e.name);}if(e.sortable&&i.setSortProperty){i.setSortProperty(e.name);}this._registerContentTemplateEvents(e.template);return i;};$.prototype._parseIndexedColumns=function(){var i,e,_,a1,b1,c1,d1,e1,f1;var g1=this._oTable.getColumns();var h1=null;if(this._oTemplate&&this._oTemplate.getCells){h1=this._oTemplate.getCells();}if(!g1){return null;}a1=[];e=g1.length;for(i=0;i<e;i++){_=g1[i];b1=_.data("p13nData");c1=null;d1=null;if(b1){c1=b1.columnIndex;d1=b1.columnKey;}e1=-1;if(c1!==null&&c1!==undefined){e1=parseInt(c1);}if(!isNaN(e1)&&e1>-1){if(h1){f1=h1[i];this._oTemplate.removeCell(f1);}else{f1=null;}this._aColumnKeys.splice(i-a1.length,1);a1.push({index:e1,columnKey:d1,column:_,template:f1});this._oTable.removeColumn(_);}}a1.sort(function(i1,j1){return i1.index-j1.index;});return a1;};$.prototype._insertIndexedColumns=function(e){var i,_,a1;if(!e){return;}_=e.length;for(i=0;i<_;i++){a1=e[i];this._aColumnKeys.splice(a1.index,0,a1.columnKey);this._oTable.insertColumn(a1.column,a1.index);if(a1.template){this._oTemplate.insertCell(a1.template,a1.index);}}};$.prototype._updateColumnsPopinFeature=function(){if(!this._isMobileTable||!this.getDemandPopin()){return;}var e=this._oTable.getColumns();if(!e){return;}e=e.filter(function(b1){return b1.getVisible();});e.sort(function(b1,c1){return b1.getOrder()-c1.getOrder();});var _,a1=e.length;for(var i=0;i<a1;i++){_=e[i];if(i<2){_.setDemandPopin(false);_.setMinScreenWidth("1px");}else{_.setDemandPopin(true);if(_.getPopinDisplay()!="WithoutHeader"){_.setPopinDisplay("Inline");}_.setMinScreenWidth((i+1)*10+"rem");}}};$.prototype._storeInitialColumnSettings=function(){this._aInitialSorters=[];P.createSort2Json(this._oTable,this._aInitialSorters,P.createArrayFromString(this.getIgnoreFromPersonalisation()));};$.prototype._deactivateColumnsPopinFeature=function(){if(!this._isMobileTable){return;}var e=this._oTable.getColumns();if(!e){return;}var _,a1=e.length;for(var i=0;i<a1;i++){_=e[i];_.setDemandPopin(false);_.setMinScreenWidth("1px");}};$.prototype._registerContentTemplateEvents=function(e){if(e.isA("sap.ui.comp.SmartToggle")){e=e.getEdit();}if(e&&e.attachChange){e.attachChange(function(i){this.fireFieldChange({changeEvent:i});},this);}};$.prototype._updateInitialColumns=function(){var i=this._oTable.getColumns(),_=i?i.length:0,a1,b1,c1;while(_--){c1=null;a1=i[_];if(a1){b1=a1.data("p13nData");if(typeof b1==="string"){try{b1=JSON.parse(b1);}catch(e){}if(b1){a1.data("p13nData",b1);}}if(b1){c1=b1["columnKey"];}if(c1){this._aExistingColumns.push(c1);}}}};$.prototype._getRelevantColumnPaths=function(){var e={},_=[],a1=[],b1=this._oTable.getColumns(),i,c1=b1?b1.length:0,d1,e1,f1,g1,h1;var i1=function(f1,j1){var k1,l1;if(f1){l1=f1.split(",");k1=l1.length;while(k1--){f1=l1[k1];if(f1&&j1.indexOf(f1)<0){j1.push(f1);}}}};for(i=0;i<c1;i++){d1=b1[i];f1=null;if(d1.getVisible()||(d1.getInResult&&d1.getInResult())){if(d1.getLeadingProperty){f1=d1.getLeadingProperty();}e1=d1.data("p13nData");if(e1){if(!f1){f1=e1["leadingProperty"];}g1=e1["additionalProperty"];h1=e1["navigationProperty"];}if(f1&&_.indexOf(f1)<0){_.push(f1);}i1(g1,_);i1(h1,a1);}}e["select"]=_;e["expand"]=a1;return e;};$.prototype._createTable=function(){var e=this.getItems(),i=e?e.length:0,_,a1;this._sAggregation="rows";while(i--){_=e[i];if(_ instanceof s||_ instanceof R){break;}_=null;}if(_){this._oTable=_;if(_ instanceof p){this._isAnalyticalTable=true;}else if(_ instanceof R){this._isMobileTable=true;this._oTemplate=(_.getItems()&&_.getItems().length>0)?_.getItems()[0]:new a();_.removeAllItems();}else if(_ instanceof t){this._isTreeTable=true;}this._updateInitialColumns();}else{a1=this.getId()+"-ui5table";if(this.getTableType()==="AnalyticalTable"){this._isAnalyticalTable=true;this._oTable=new p(a1,{enableCustomFilter:true});}else if(this.getTableType()==="ResponsiveTable"){this._isMobileTable=true;this._oTable=new R(a1,{growing:true});this._oTemplate=new a();}else if(this.getTableType()==="TreeTable"){this._isTreeTable=true;this._oTable=new t(a1,{selectionMode:"MultiToggle"});}else{this._oTable=new s(a1,{selectionMode:"MultiToggle"});}if(this._oTable.setVisibleRowCountMode){this._oTable.setVisibleRowCountMode("Auto");}this.insertItem(this._oTable,2);}if(!this._oTable.getLayoutData()){if(this._oTable instanceof R||(this._oTable.getVisibleRowCountMode&&this._oTable.getVisibleRowCountMode()!=="Auto")){this._oTable.setLayoutData(new F({growFactor:1,baseSize:"auto"}));}else{this._oTable.setLayoutData(new F({growFactor:1,baseSize:"0%"}));}}if(this._oTable.addAriaLabelledBy){this._oTable.addAriaLabelledBy(this.getId()+"-header");}this._oTable.addStyleClass("sapUiCompSmartTableInnerTable");this._oTable.setEnableBusyIndicator(true);this._oTable.setBusyIndicatorDelay(100);if(this._oTable.setEnableCustomFilter){this._oTable.setEnableCustomFilter(this.getEnableCustomFilter());}if(this._oTable.setShowColumnVisibilityMenu){this._oTable.setShowColumnVisibilityMenu(false);}if(this._oTable.getEnableCustomFilter&&this._oTable.getEnableCustomFilter()&&this._bIsFilterPanelEnabled){if(this._oTable.setEnableCellFilter){this._oTable.setEnableCellFilter(false);}if(this._oTable.attachCustomFilter){this._oTable.attachCustomFilter(this._onCustomFilter,this);}}if(this._isAnalyticalTable){this._createColumn=this._createAnalyticalColumn;}else if(this._isMobileTable){if(this.getUseTablePersonalisation()){this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onColumnPress,this);this._oTable.attachSort=function(){this.attachEvent("sort",arguments[0],arguments[1],arguments[2]);};this._oTable.detachSort=function(){this.detachEvent("sort",arguments[0],arguments[1]);};}this._sAggregation="items";this._createColumn=this._createMobileColumn;this._oTable.bindRows=this._oTable.bindItems;}if(!this._isMobileTable){this._oTable.attachEvent("_rowsUpdated",function(){this._setExcelExportEnableState();},this);}if(this._oTable._setLargeDataScrolling){this._oTable._setLargeDataScrolling(true);}this._oTable.attachPaste(this._onInnerTablePaste,this);};$.prototype._createResponsivePopover=function(){this._oFilterButton=new W({text:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_FILTER"),icon:"sap-icon://filter",press:[function(e){this._onCustomFilter(e);},this]});this._oSortButton=new X({sort:[function(e){this._onCustomSort(e);},this]});this._oColumnHeaderPopover=new Q({items:[this._oSortButton,this._oFilterButton]});};$.prototype._onColumnPress=function(e){this._oColumnClicked=e.getParameter("column");var i=this._oColumnClicked.data("p13nData");if(!i){return;}var _=i.filterProperty;var a1=i.sortProperty;if(!this._oColumnHeaderPopover){this._createResponsivePopover();}this._oFilterButton.setVisible(!!_&&this._bIsFilterPanelEnabled);this._oSortButton.setVisible(!!a1);if((_&&this._bIsFilterPanelEnabled)||a1){this._oColumnHeaderPopover.removeAllAriaLabelledBy();this._oColumnHeaderPopover.addAriaLabelledBy(this._oColumnClicked.getHeader());this._oColumnHeaderPopover.openBy(this._oColumnClicked);}};$.prototype._onCustomSort=function(){var e=this._oColumnClicked.data("p13nData");if(e&&!e.sorted){e.sorted={"ascending":false};this._oColumnClicked.data("p13nData",e);}var i=e.sorted;var _=i&&i.ascending;this._oTable.fireEvent("sort",{column:this._oColumnClicked,sortOrder:_?Z.Descending:Z.Ascending,columnAdded:false});i.ascending=!_;};$.prototype._onCustomFilter=function(e){this._showTableFilterDialog(e.getParameter("column")||this._oColumnClicked);};$.prototype.getTable=function(){return this._oTable;};$.prototype._showTableFilterDialog=function(e){if(this._oPersController&&e){this._oPersController.openDialog({filter:{visible:true,payload:{column:e}}});}};$.prototype._createColumn=function(e,i){var _;_=new r(i,{autoResizable:true,hAlign:e.align,width:e.width,visible:e.isInitiallyVisible,label:new L(i+"-header",{textAlign:e.align,text:e.label}),sorted:e.sorted,sortOrder:e.sortOrder,tooltip:e.quickInfo,showSortMenuEntry:e.sortable,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,name:e.fieldName,template:e.template});return _;};$.prototype._createAnalyticalColumn=function(e,i){var _;if(e.aggregationRole!=="measure"&&e.isMeasureField&&e.unit&&e.template.addStyleClass){e.template.addStyleClass("sapUiAnalyticalTableSumCellHidden sapUiAnalyticalTableGroupCellHidden");}else if(e.isCurrencyField&&e.template.addStyleClass){e.template.addStyleClass("sapUiCompCurrencyBold");}_=new A(i,{autoResizable:true,hAlign:e.align,width:e.width,visible:e.isInitiallyVisible,inResult:e.inResult,label:new L(i+"-header",{textAlign:e.align,text:e.label}),tooltip:e.quickInfo,sorted:e.sorted,sortOrder:e.sortOrder,grouped:e.grouped,showIfGrouped:e.grouped,showSortMenuEntry:e.sortable,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,summed:e.summed,leadingProperty:e.name,template:e.template,groupHeaderFormatter:v.getInlineGroupFormatterFunction(e)});return _;};$.prototype._createMobileColumn=function(e,i){var _;_=new C(i,{hAlign:e.align,visible:e.isInitiallyVisible,header:new T(i+"-header",{textAlign:e.align,text:e.label,tooltip:e.quickInfo,wrappingType:M.WrappingType.Hyphenated}),tooltip:e.quickInfo,width:e.isImageURL?"3em":undefined});if(this._oTemplate){this._oTemplate.addCell(e.template);}return _;};$.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{};}return this._oCurrentVariant;};$.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null;}this._bApplyingVariant=true;if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true);}if(this._oPersController){if(this._oCurrentVariant===null||q.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization("ResetFull");}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()});};$.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding();};$.prototype.getUiState=function(){var e=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new U({presentationVariant:{SortOrder:e?e.SortOrder:[],GroupBy:e?e.GroupBy:[],Total:e?e.Total:[],RequestAtLeast:this._getRequestAtLeastFields(),Visualizations:e?e.Visualizations:[]},selectionVariant:{SelectOptions:e?e.SelectOptions:[]},variantName:this.getCurrentVariantId()});};$.prototype.setUiState=function(e){this._setUiState(e,false);};$.prototype.setUiStateAsVariant=function(e){this._setUiState(e,true);};$.prototype._setUiState=function(e,i){var _=e.getPresentationVariant()&&e.getPresentationVariant().RequestAtLeast?[].concat(e.getPresentationVariant().RequestAtLeast):[];if(!E(_,this._getRequestAtLeastFields())){this._aAlwaysSelect=_;}if(this._oPersController){if(i){this._oPersController.setPersonalizationDataAsDataSuiteFormat(K({},e.getPresentationVariant(),e.getSelectionVariant()),true);}else{var a1=(this._oVariantManagement&&e.getVariantName())?this._oVariantManagement.getVariantContent(this,e.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(K({},e.getPresentationVariant(),e.getSelectionVariant()),a1,true);}}};$.prototype._getRequestAtLeastFields=function(){var e=this.getRequestAtLeastFields();var i=e?e.split(","):[];return i.concat(this._aAlwaysSelect);};$.prototype._personalisationRequestColumns=function(e){var _=e.getParameter("columnKeys"),a1,i,b1,c1,d1,e1={};b1=_.length;for(i=0;i<b1;i++){a1=_[i];c1=this._mLazyColumnMap[a1];if(c1){d1=this._createColumnForField(c1);if(this._isMobileTable){this._oTable.addColumn(d1);}e1[c1.name]=d1;}}this._oPersController.addColumns(e1);};$.prototype._beforePersonalisationModelDataChange=function(e){if(this._oTable.suspendUpdateAnalyticalInfo){this._oTable.suspendUpdateAnalyticalInfo();}};$.prototype._afterPersonalisationModelDataChange=function(e){this._updateColumnsPopinFeature();};$.prototype._personalisationModelDataChange=function(e){this._oCurrentVariant=e.getParameter("persistentData");var i=e.getParameter("runtimeDeltaDataChangeType");var _=this._getChangeStatus(i);if(_==="Unchanged"){return;}if(!(this._bApplyingVariant||this._bDeactivatingColumns)){if(!this.getUseVariantManagement()){this._persistPersonalisation();}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}}if(_==="ModelChanged"&&this._isTableBound()){if(i&&i.columns==="ModelChanged"){this._bForceTableUpdate=true;}if(this._oSmartFilter){this._oSmartFilter.search();}else{this._reBindTable(null);}}if(this._isMobileTable){this._adaptCustomSort();}};$.prototype._adaptCustomSort=function(){if(this._oCurrentVariant){var e,i,_,a1=[],b1;if(this._oCurrentVariant.sort&&this._oCurrentVariant.sort.sortItems){a1=this._oCurrentVariant.sort.sortItems;}this._oTable.getColumns().forEach(function(c1){e=c1.data("p13nData");i=e&&e.columnKey;if(i){_=a1.filter(function(d1){return i===d1.columnKey;});b1=_[0];if(b1){if(!e.sorted){e.sorted={"ascending":false};}if(b1.operation!==Z.Descending){e.sorted={"ascending":true};}c1.setSortIndicator(b1.operation);}else if(e&&e.sorted){e.sorted=null;c1.setSortIndicator(c.None);}}else if(c1.getSortIndicator()!==Z.None){c1.setSortIndicator(Z.None);}},this);}};$.prototype._getChangeStatus=function(e){if(!e){return"ModelChanged";}if(e.sort==="ModelChanged"||e.filter==="ModelChanged"||e.columns==="ModelChanged"||e.group==="ModelChanged"){return"ModelChanged";}if(e.sort==="TableChanged"||e.filter==="TableChanged"||e.columns==="TableChanged"||e.group==="TableChanged"){return"TableChanged";}return"Unchanged";};$.prototype._getTablePersonalisationData=function(){this._mSelectExpandForGroup=null;if(!this._oCurrentVariant){return null;}var e=[],i=[],_=[],a1,b1,c1,d1,e1,f1,g1,h1,i1,j1={},k1={},l1="",m1;if(this._isMobileTable&&this._oCurrentVariant.group&&this._oCurrentVariant.group.groupItems){b1=this._oCurrentVariant.group.groupItems[0];if(this._aDeactivatedColumns.indexOf(b1.columnKey)<0){e1=this._getColumnByKey(b1.columnKey);if(e1){l1=e1.getHeader().getText();}i1=this._getPathFromColumnKeyAndProperty(b1.columnKey,"sortProperty");}if(i1){g1=i1;h1=null;var n1=this._mFieldMetadataByKey[b1.columnKey],o1;if(n1){h1=n1.unit||n1.description;o1=v.getInlineGroupFormatterFunction(n1);}c1=new m(g1,b1.operation==="GroupDescending",function(q1){var r1=q1.getProperty(g1),s1;if(o1){if(h1){s1=q1.getProperty(h1);}r1=o1(r1,s1);}return{key:r1,text:l1?l1+": "+r1:r1};});this._mSelectExpandForGroup={select:[g1]};if(n1){if(n1.additionalProperty){this._mSelectExpandForGroup.select.push(n1.additionalProperty);}if(n1.navigationProperty){this._mSelectExpandForGroup.expand=[n1.navigationProperty];}}e.push(c1);}}if(this._oCurrentVariant.sort){d1=this._oCurrentVariant.sort.sortItems;}else{d1=this._aInitialSorters;}if(d1){d1.forEach(function(q1,r1){var s1=q1.operation==="Descending";i1=null;h1=null;if(this._aDeactivatedColumns.indexOf(q1.columnKey)<0){i1=this._getPathFromColumnKeyAndProperty(q1.columnKey,"sortProperty");}if(i1){if(c1&&c1.sPath===i1){c1.bDescending=s1;}else{var n1=this._mFieldMetadataByKey[q1.columnKey];if(!n1){e1=this._getColumnByKey(q1.columnKey);f1=e1.data("p13nData");}if(this._bMultiUnitBehaviorEnabled&&((n1&&n1.isCurrencyField)||(f1&&f1.isCurrency))){h1=n1?n1.unit:f1.unit;if(h1&&!j1[h1]){j1[h1]={index:r1,descending:s1};}}k1[i1]={};if(k1[h1]){delete j1[h1];}else if(j1[i1]){delete j1[i1];}e.push(new m(i1,s1));}}},this);var p1=Object.keys(j1);if(p1.length){p1.reverse().forEach(function(q1){e.splice(j1[q1].index,0,new m(q1,j1[q1].descending));});}}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(q1){var r1=q1.value1,s1=q1.value2;i1=null;m1=false;e1=null;if(this._aDeactivatedColumns.indexOf(q1.columnKey)<0){e1=this._getColumnByKey(q1.columnKey);}if(e1){if(e1.getFilterProperty){i1=e1.getFilterProperty();}f1=e1.data("p13nData");if(f1){m1=f1.type==="time";if(!i1){i1=f1["filterProperty"];}}}if(i1){if(m1){if(r1 instanceof Date){r1=v.getEdmTimeFromDate(r1);}if(s1 instanceof Date){s1=v.getEdmTimeFromDate(s1);}}else{var t1=f1&&f1.typeInstance&&f1.typeInstance.getName()==="sap.ui.model.odata.type.DateTimeOffset";if(r1 instanceof Date&&!t1&&this._oTableProvider&&this._oTableProvider.getIsUTCDateHandlingEnabled()){r1=k.getDateInUTCOffset(r1);s1=s1?k.getDateInUTCOffset(s1):s1;}}if(q1.exclude){_.push(new n(i1,"NE",q1.operation==="Empty"?"":r1));}else if(q1.operation==="Empty"){i.push(new n(i1,"EQ",""));}else{i.push(new n(i1,q1.operation,r1,s1));}}},this);if(_.length){a1=new n(_,true);}}return{filters:i,excludeFilters:a1,sorters:e};};$.prototype._getColumnByKey=function(e){var _,a1,b1,i,c1;if(this._oTable){_=this._oTable.getColumns();b1=_.length;for(i=0;i<b1;i++){a1=_[i];c1=a1.data("p13nData");if(c1&&c1.columnKey===e){return a1;}}}return null;};$.prototype._getPathFromColumnKeyAndProperty=function(e,i){var _=null,a1,b1;a1=this._getColumnByKey(e);if(a1){if(i=="sortProperty"&&a1.getSortProperty){_=a1.getSortProperty();}else if(i=="filterProperty"&&a1.getFilterProperty){_=a1.getFilterProperty();}else if(i=="leadingProperty"&&a1.getLeadingProperty){_=a1.getLeadingProperty();}if(!_){b1=a1.data("p13nData");if(b1){_=b1[i];}}}return _;};$.prototype._persistPersonalisation=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var e=this.getCurrentVariantId();if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:"Personalisation",implicit:true,global:false,overwrite:!!e,key:e,def:true});delete this._bSaving;}}};$.prototype.getCurrentVariantId=function(){return this._oVariantManagement?this._oVariantManagement.getCurrentVariantId():"";};$.prototype.setCurrentVariantId=function(e){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(e);}else{B.error("sap.ui.comp.smarttable.SmartTable.prototype.setCurrentVariantId: VariantManagement does not exist, or is a page variant");}return this;};$.prototype.isInitialised=function(){return!!this.bIsInitialised;};$.prototype._aAvailablePanels=["Columns","Sort","Filter","Group"];$.prototype.openPersonalisationDialog=function(e){if(!e||this._aAvailablePanels.indexOf(e)<0){B.warning("sap.ui.comp.smarttable.SmartTable.prototype.openPersonalisationDialog: "+e+" is not a valid panel!");return;}if(this._oPersController){var i={};i[e.toLowerCase()]={visible:true};this._oPersController.openDialog(i);}};$.prototype.deactivateColumns=function(e){this._aDeactivatedColumns=e||[];this._bDeactivatingColumns=true;if(this._oPersController){this._oPersController.addToSettingIgnoreColumnKeys(e);}this._bDeactivatingColumns=false;};$.prototype._onInnerTablePaste=function(e){if(!this.hasListeners("beforePaste")&&!this.hasListeners("paste")){return;}var i=e.getParameter("data");var _=i.slice(0);var a1=this._getColumnInfoForPaste();if(this.fireBeforePaste({columnInfos:a1})){sap.ui.require(["sap/ui/core/util/PasteHelper"],function(b1){b1.parse(_,a1).then(function(c1){this.firePaste({result:c1});}.bind(this));}.bind(this));}};$.prototype._getColumnInfoForPaste=function(){var e=[],_=this._oTable.getColumns(),i,a1=_.length,b1,c1,d1,e1,f1,g1;if(this._isMobileTable&&_.length){_=_.sort(function(h1,i1){return h1.getOrder()-i1.getOrder();});}for(i=0;i<a1;i++){b1=_[i];d1=null;g1=null;if(b1.getVisible()){if(b1.getLeadingProperty){d1=b1.getLeadingProperty();}c1=b1.data("p13nData");if(!d1&&c1){d1=c1["leadingProperty"];}e1=c1.type==="numeric"?"number":c1.type;f1=c1["typeInstance"];if(c1.isCurrency||e1==="number"){g1=c1.unit;}else if(c1.description&&c1.displayBehaviour!=="idOnly"){g1=c1.description;}}e.push({columnId:b1.getId(),property:d1,ignore:!d1,type:f1});f1=y.getType("Edm.String");if(g1){e.push({columnId:b1.getId(),additionalProperty:true,property:g1,type:f1});}}return e;};$.prototype.exit=function(){var i,e;this.detachEvent("_change",this._onPropertyChange,this);if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindTable,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this);this._oSmartFilter=null;}if(this._oTableProvider&&this._oTableProvider.destroy){this._oTableProvider.destroy();}this._oTableProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy();}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy();}}this._oNumberFormatInstance=null;w.cleanUpFullScreen(this);if(this._oEditModel){this._oEditModel.destroy();}if(this._oNoData&&this._oNoData.destroy){this._oNoData.destroy();}this.oNoData=null;if(this._aTableViewMetadata){i=this._aTableViewMetadata.length;while(i--){e=this._aTableViewMetadata[i];if(e&&!e.isColumnCreated&&e.template){e.template.destroy();}}}this._aTableViewMetadata=null;this._mFieldMetadataByKey=null;this._mSelectExpandForGroup=null;this._oEditModel=null;this._oVariantManagement=null;this._oCurrentVariant=null;this._aExistingColumns=null;this._mLazyColumnMap=null;this._aColumnKeys=null;this._aDeactivatedColumns=null;this._aAlwaysSelect=null;this._oCustomToolbar=null;if(this._oToolbar&&!this._bToolbarInsertedIntoItems){this._oToolbar.destroy();}this._oToolbar=null;if(this._oUseExportToExcel&&!this.getUseExportToExcel()){this._oUseExportToExcel.destroy();}this._oUseExportToExcel=null;this._oTablePersonalisationButton=null;this._oP13nDialogSettings=null;if(this._oTemplate){this._oTemplate.destroy();}this._oTemplate=null;this._InterceptService=null;if(this._oColumnHeaderPopover){this._oColumnHeaderPopover.destroy();}this._oColumnHeaderPopover=null;this._oFilterButton=null;this._oSortButton=null;this._oView=null;this._oTable=null;};return $;},true);
