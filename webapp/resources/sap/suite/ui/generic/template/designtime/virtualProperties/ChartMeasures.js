sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/suite/ui/generic/template/designtime/utils/DesigntimeUtils"],function(A,D){"use strict";var C={},p=false,M="com.sap.vocabularies.UI.v1.ChartMeasureRoleType",a="com.sap.vocabularies.UI.v1.DataPoint",b="com.sap.vocabularies.UI.v1.ChartType/Area",c="com.sap.vocabularies.UI.v1.ChartType/Donut",d="com.sap.vocabularies.UI.v1.ChartType/Bullet";C._setPostponedRetemplating=function(v){p=v;};C._getPostponedRetemplating=function(){return p;};C.getMeasureDefinition=function(e){var m={Measure:{displayName:"Measure",type:"Edm.PropertyPath",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",nullable:false},Role:{displayName:"Role",type:"EnumType",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",possibleValues:{Axis1:{displayName:"Axis 1"},Axis2:{displayName:"Axis 2"},Axis3:{displayName:"Axis 3"}}},DataPointAnnotationPath:{displayName:"Data Point Reference",type:"Edm.AnnotationPath",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",refersTo:{annotation:"DataPoint",namespace:"com.sap.vocabularies.UI.v1"}}};var o={properties:["ImprovementDirection","DeviationRangeLowValue","DeviationRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue"]};var f=D.getChartFromParent(e),g=f&&f.entityType[f.chartID];if(!f||!g||!g.ChartType){return m;}switch(g.ChartType.EnumMember){case b:m.Role.nullable=false;m.DataPoint={displayName:"Data Point Properties",type:"ComplexType",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",whiteList:{properties:["Value","TargetValue","CriticalityCalculation"],mandatory:["Value","TargetValue"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"]},CriticalityCalculation:o}};break;case d:m.Role.nullable=true;m.DataPoint={displayName:"Data Point Properties",type:"ComplexType",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",whiteList:{properties:["Value","TargetValue","ForecastValue","MinimumValue","MaximumValue","Criticality","CriticalityCalculation"],mandatory:["Value"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"],ForecastValue:["Path","String","Int","Decimal"],Criticality:["Path"]},CriticalityCalculation:o}};break;case c:m.Role.nullable=true;m.DataPoint={displayName:"Data Point Properties",type:"ComplexType",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",whiteList:{properties:["Value","TargetValue","Criticality","CriticalityCalculation"],mandatory:["Value"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"],Criticality:["Path"]},CriticalityCalculation:o}};break;default:break;}return m;};C.getMeasures=function(e){var m={},f=[],s,q,g,o,h,k={},l,n=D.getChartFromParent(e),r=n&&n.entityType[n.chartID];if(r&&r.Measures){var t=jQuery.extend(true,{},t,r);for(var i=0;i<t.Measures.length;i++){s=t.Measures[i].PropertyPath;g=false;if(t.MeasureAttributes){for(var j=0;j<t.MeasureAttributes.length;j++){o=t.MeasureAttributes[j];k={};if(o.Measure&&o.Measure.PropertyPath===s){g=true;if(o.DataPoint&&o.DataPoint.AnnotationPath){q=o.DataPoint.AnnotationPath.split("#").reverse()[0];h=q?a+"#"+q:a;l=n.entityType[h];if(l){jQuery.extend(true,k,l);}}m={Measure:{PropertyPath:o.Measure&&o.Measure.PropertyPath},DataPointAnnotationPath:{AnnotationPath:o.DataPoint&&o.DataPoint.AnnotationPath},DataPoint:k};if(o.Role&&o.Role.EnumMember){switch(o.Role.EnumMember){case"com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1":m.Role={EnumMember:"Axis1"};break;case"com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis2":m.Role={EnumMember:"Axis2"};break;case"com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis3":m.Role={EnumMember:"Axis3"};break;default:break;}}f.push(m);break;}}}if(!g){m={Measure:t.Measures[i]};f.push(m);}}}return f;};C.setMeasures=function(o,n,e){var i,j,k,m,E,N,s,f=[],g,h={},l=D.getChartFromColumn(o),O=l&&l.entityType&&l.entityType[l.chartID];if(!O||jQuery.isEmptyObject(O)||!l||!n){return f;}if(e.delayRefresh){p=true;}var q=jQuery.extend(true,{},O),t=l.entityType.namespace+"."+l.entityType.name;if(q.Measures){for(i=q.Measures.length-1;i>=0;i--){E=false;m=q.Measures[i].PropertyPath;for(j=0;j<n.length;j++){if(n[j].Measure&&n[j].Measure.PropertyPath===m){E=true;break;}}if(!E){q.Measures.splice(i,1);for(j=q.MeasureAttributes.length-1;j>=0;j--){g=q.MeasureAttributes[j].Measure;if(g&&g.PropertyPath===m){q.MeasureAttributes.splice(j,1);if(!m&&O.Measures.length>n.length){e.noRefreshOnChange=true;e.refreshPropertiesPane=true;}break;}}}}}for(i=0;i<n.length;i++){N=n[i];if(jQuery.isEmptyObject(N)){N={Measure:{PropertyPath:""}};}E=false;if(q.MeasureAttributes){for(j=0;j<q.MeasureAttributes.length;j++){g=q.MeasureAttributes[j].Measure;if(N.Measure&&g&&g.PropertyPath===N.Measure.PropertyPath){E=true;if(N.DataPointAnnotationPath&&(!q.MeasureAttributes[j].DataPoint||q.MeasureAttributes[j].DataPoint.AnnotationPath!==N.DataPointAnnotationPath.AnnotationPath)){e.refreshPropertiesPane=true;p=true;}break;}}}if(N.DataPointAnnotationPath&&N.DataPointAnnotationPath.AnnotationPath){s=N.DataPointAnnotationPath.AnnotationPath;}else if(N.Measure&&N.Measure.PropertyPath){s="@"+a+"#"+N.Measure.PropertyPath;N.DataPointAnnotationPath={AnnotationPath:s};e.refreshPropertiesPane=true;}else{s="";}h={Measure:{PropertyPath:N.Measure.PropertyPath},DataPoint:{AnnotationPath:s},RecordType:"com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"};if(N.Role){switch(N.Role.EnumMember){case"Axis2":h.Role={EnumMember:M+"/Axis2"};break;case"Axis3":h.Role={EnumMember:M+"/Axis3"};break;default:h.Role={EnumMember:M+"/Axis1"};break;}}else{var r="Axis1";if(O.MeasureAttributes){var P=["Axis1","Axis2","Axis3"];r="Axis3";for(k=0;k<O.MeasureAttributes.length;k++){var R=O.MeasureAttributes[k].Role.EnumMember.split("/").reverse()[0];var u=P.indexOf(R);if(u!==-1){P.splice(u,1);}}if(P.length>0){r=P[0];}}N.Role={EnumMember:r};h.Role={EnumMember:M+"/"+r};}if(!E){if(!q.Measures){q.Measures=[];}q.Measures.push(N.Measure);if(!q.MeasureAttributes){q.MeasureAttributes=[];}q.MeasureAttributes.push(h);}else{q.MeasureAttributes[j]=h;}var v=D.modifyDataPointForChart(t,l.entityType,N,f);if(v){var w=["@",a,v];q.MeasureAttributes.DataPoint={AnnotationPath:w.join('')};}if(N.Measure.PropertyPath===""){e.noRefreshOnChange=true;if(O.Measures.length>q.Measures.length&&!p){k=0;while(!p&&k<O.Measures.length){if(O.Measures[k].PropertyPath){p=true;}k++;}}}else if(N.Measure.PropertyPath!==""&&N.DataPoint&&N.DataPoint.Value&&!e.noRefreshOnChange){p=false;}}if(p&&e.noRefreshOnChange){var H=false;k=0;while(!H&&k<q.Measures.length){if(!q.Measures[k].PropertyPath){H=true;}k++;}if(!H){e.noRefreshOnChange=false;e.refreshPropertiesPane=true;p=false;}}var x=A.createCustomAnnotationTermChange(t,q,O,l.chartID);f.push(x);return f;};return C;});
