sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/core/format/DateFormat","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/generic/app/navigation/service/SelectionVariant","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/detailTemplates/detailUtils","sap/suite/ui/generic/template/ObjectPage/controller/SideContentHandler","sap/suite/ui/generic/template/ObjectPage/extensionAPI/ExtensionAPI","sap/suite/ui/generic/template/js/AnnotationHelper","sap/m/Table","sap/ui/layout/DynamicSideContent","sap/suite/ui/generic/template/lib/ShareUtils","sap/ui/dom/jquery/Selectors","sap/base/Log","sap/suite/ui/generic/template/ObjectPage/controller/MultipleViewsHandler","sap/ui/model/json/JSONModel","sap/suite/ui/generic/template/lib/MessageUtils","sap/ui/events/KeyCodes"],function(C,D,M,F,S,a,t,d,b,E,A,R,c,f,g,L,h,J,l,K){"use strict";var m=25;function s(O){O.setSelectedSection(null);}function I(e){return e.data("inlineCreate")==="true";}function n(B,e){if(B.getBindings){var j=B.getBindings();for(var i=0;i<j.length;i++){n(j[i],e);}}else{var T=B.getType();B.setType(T,e);}}var r=/[A-Za-z].*[A-Za-z]/;var o={getMethods:function(v,T,p){var q={"oMultipleViewsHandler":{}};var B=d.getControllerBase(v,T,p);v.oController=p;var u;var O;var w=new b(p,T,B.stateChanged);var y;function z(e){var i=e.getParameter("bindingParams");i.parameters=i.parameters||{};i.parameters.usePreliminaryContext=true;i.parameters.batchGroupId="facets";return i;}function G(){L.info("Activate object");var e=B.state.saveScenarioHandler;var i=T.oServices.oCRUDManager.activateDraftEntity(e);i.then(function(k){l.showSuccessMessageIfRequired(T.oCommonUtils.getText("OBJECT_SAVED"),T.oServices);var x=p.getOwnerComponent();T.oServices.oViewDependencyHelper.setAllPagesDirty([x.getId()]);T.oServices.oViewDependencyHelper.unbindChildren(x);T.oServices.oApplication.invalidatePaginatorInfo();var S1=x.getNavToListOnSave();T.oServices.oApplication.navigateAfterActivation(!S1&&k.context);},jQuery.noop);var j={activationPromise:i};T.oComponentUtils.fire(p,"AfterActivate",j);}function H(){B.state.saveScenarioHandler.handleSaveScenario(1,G);a1();}function N(){var e=p.getView();var i=e.getModel().getPendingChanges();T.oCommonEventHandlers.submitChangesForSmartMultiInput();var j=T.oComponentUtils.isNonDraftCreate();var k=T.oServices.oCRUDManager.saveEntity();k.then(function(S1){var T1=T.oComponentUtils.getTemplatePrivateModel();T1.setProperty("/objectPage/displayMode",1);v.setEditable(false);T.oServices.oViewDependencyHelper.setRootPageToDirty();T.oServices.oViewDependencyHelper.unbindChildren(p.getOwnerComponent());if(j){if(S1&&S1.getPath()!=="/undefined"){T.oServices.oNavigationController.navigateToContext(S1,undefined,true);}else{T.oServices.oNavigationController.navigateBack();}l.showSuccessMessageIfRequired(T.oCommonUtils.getText("OBJECT_CREATED"),T.oServices);}else{l.showSuccessMessageIfRequired(T.oCommonUtils.getText("OBJECT_SAVED"),T.oServices);if(!T.oComponentUtils.isDraftEnabled()&&!u){T.oServices.oNavigationController.navigateBack();}}if(i){var U1;var V1;var W1=[];var X1;for(var Y1 in i){if(i.hasOwnProperty(Y1)){U1=e.getModel().getContext("/"+Y1);V1=i&&i[U1.getPath().replace("/","")]||{};W1=Object.keys(V1)||[];X1=W1.indexOf("__metadata");if(X1>-1){W1.splice(X1,1);}T.oServices.oApplicationController.executeSideEffects(U1,W1);}}}});var x={saveEntityPromise:k};T.oComponentUtils.fire(p,"AfterSave",x);}function P(){B.state.saveScenarioHandler.handleSaveScenario(3,N);}function Q(e){if(I(e.getSource())){var i=e.getParameter("bindingParams");if(i.filters&&i.filters.length){var j=new F(i.filters);i.filters=new F({filters:[new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:true}),j],and:true}),new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:false}),new F({filters:[j,new F({path:"HasActiveEntity",operator:"EQ",value1:false})],and:false})],and:true})],and:false});}var k=i.sorter[0]&&i.sorter[0].getGroupFunction();var x=k&&function(S1){var T1=S1.getObject();if(T1.IsActiveEntity||T1.HasActiveEntity){var U1=jQuery.extend({},k(S1));U1.key=U1.key.charAt(0)==="ยง"?"ยง"+U1.key:U1.key;return U1;}return{key:"ยง",text:T.oCommonUtils.getText("NEW_ENTRY_GROUP")};};if(e.getSource().data("disableInlineCreateSort")==="false"){i.sorter.unshift(new S("HasActiveEntity",false,x));}}}function U(){return O.getHeaderTitle();}function V(e){var i=T.oComponentUtils.getTemplatePrivateModel();var j={shareEmailPressed:function(){var k=i.getProperty("/objectPage/headerInfo/objectTitle");var x=i.getProperty("/objectPage/headerInfo/objectSubtitle");if(x){k=k+" - "+x;}var S1=document.URL.replace(/\(/g,'%28').replace(/\)/g,'%29');sap.m.URLHelper.triggerEmail(null,k,S1);},shareJamPressed:function(){f.openJamShareDialog(i.getProperty("/objectPage/headerInfo/objectTitle")+" "+i.getProperty("/objectPage/headerInfo/objectSubtitle"));},getModelData:function(){return{title:i.getProperty("/objectPage/headerInfo/objectTitle"),subtitle:i.getProperty("/objectPage/headerInfo/objectSubtitle"),customUrl:f.getCustomUrl()};}};f.openSharePopup(T.oCommonUtils,e.getSource(),j);}function W(){var e=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.RelatedAppsSheet",{buttonPressed:function(i){var j=i.getSource();var k=j.getBindingContext("buttons");var x=k.getProperty("link");var S1=k.getProperty("param");var T1=x.intent;var U1=T1.split("#")[1].split("-")[0];var V1=T1.split("-")[1].split("?")[0].split("~")[0];var W1={target:{semanticObject:U1,action:V1},params:S1};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(W1);}},"buttons");return e;}var X;function Y(){X=function(e){var i=e.getSource().getParent();var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var k=p.getOwnerComponent();var x=k.getModel("_templPrivGlobal");var S1={objectPage:{currentEntitySet:k.getProperty("entitySet")}};x.setProperty("/generic/multipleViews",S1);var T1=T.oServices.oCRUDManager.deleteEntity();var U1=k.getBindingContext().getPath();var V1=Object.create(null);V1[U1]=T1;T.oServices.oApplication.prepareDeletion(V1);var e={deleteEntityPromise:T1};j.setBusy(T1);T.oComponentUtils.fire(p,"AfterDelete",e);i.close();};return T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(e){var i=e.getSource().getParent();i.close();},onDelete:function(e){X(e);}},"delete");}function Z(){var e=T.oServices.oApplication.getBusyHelper();if(e.isBusy()){return;}var i=T.oCommonUtils;var j=T.oComponentUtils.getTemplatePrivateModel();var k=(j.getProperty("/objectPage/headerInfo/objectTitle")||"").trim();var x=j.getProperty("/objectPage/headerInfo/objectSubtitle");var S1;var T1={};T1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE");if(k){if(x){S1=[" ",k,x];T1.text=i.getText("DELETE_WITH_OBJECTINFO",S1);}else{S1=[k];T1.text=i.getText("DELETE_WITH_OBJECTTITLE",S1);}}else{T1.text=i.getText("ST_GENERIC_DELETE_SELECTED");}var U1=Promise.resolve(p.beforeDeleteExtension());U1.then(function(V1){jQuery.extend(T1,V1);var W1=Y();var X1=W1.getModel("delete");X1.setData(T1);W1.open();},jQuery.noop);}function $(e){var i=e.getParameter("columnInfos");var j=i&&i.length-1;while(j>=0){if(i[j].ignore){i.splice(j,1);}j-=1;}var k=i.reduce(function(S1,T1){if(!T1.type&&!T1.customParseFunction){S1.push(T1);}return S1;},[]);if(k.length>0){var x=T.oCommonUtils.getText("DATA_PASTE_UNSUPPORTED_FORMAT_MESSAGE");M.show(x,{icon:M.Icon.ERROR,title:T.oCommonUtils.getText("ST_ERROR"),actions:[sap.m.MessageBox.Action.CLOSE]});}}function _(e){var j;var i1=e.getSource();var k=i1.getId();var x=k.split("::Table")[0]+"::addEntry";var S1=p.byId(x);if(!S1){return;}var T1=e.getParameter("result");if(T1){if(T1.errors){var U1=T1.errors.map(function(b2){return b2.message;});var V1=T.oCommonUtils.getText("DATA_PASTE_ERROR_MESSAGE",[U1.length]);var W1=T.oCommonUtils.getText("DATA_PASTE_ERROR_CORRECTION_MESSAGE");var X1=T.oCommonUtils.getText("DATA_PASTE_ERROR_CORRECTION_NOTE");U1.unshift("");U1.unshift(X1);U1.unshift(W1);M.show(V1,{icon:M.Icon.ERROR,title:T.oCommonUtils.getText("ST_ERROR"),actions:[sap.m.MessageBox.Action.CLOSE],details:U1.join("<br />")});}else if(T1.parsedData){j=T1.parsedData;if(j&&j.length){var Y1=j.length;var Z1;var $1,_1=[];var a2=sap.m.DraftIndicatorState.Saved;for(var i=0;i<Y1;i++){Z1=i<Y1-1;$1=T.oCommonEventHandlers.addEntry(S1,true,undefined,j[i],Z1);_1.push($1);}Promise.all(_1).then(function(){var b2=p.getOwnerComponent();var c2=b2.getAppComponent();var d2=c2.getModel("_templPrivGlobal");d2.setProperty("/generic/draftIndicatorState",a2);});}}}}function a1(){var e=T.oComponentUtils.getTemplatePrivateModel();var i=e.getProperty("/objectPage/aPasteAttachedTables");var j=i.length;var k;var x;while(j>=0){k=i[j];x=p.byId(k+"::Table");if(x&&x.isA("sap.ui.comp.smarttable.SmartTable")&&x.hasListeners("paste")){x.detachBeforePaste($);x.detachPaste(_);i.splice(j,1);}j-=1;}}function b1(e){T.oServices.oApplication.performAfterSideEffectExecution(Z);}function c1(e,i){var j,k;if(e){k=e.context||e;if(T.oServices.oDraftController.getDraftContext().hasDraft(k)){T.oServices.oViewDependencyHelper.setRootPageToDirty();j=k.context||k;}}if(j){T.oServices.oApplication.invalidatePaginatorInfo();T.oServices.oApplication.switchToDraft(j);}else{var x=T.oComponentUtils.getTemplatePrivateModel();x.setProperty("/objectPage/displayMode",2);}v.setEditable(true);}var d1;function e1(e){T.oServices.oCRUDManager.editEntity(e).then(function(i){if(i.draftAdministrativeData){d1(i.draftAdministrativeData.CreatedByUserDescription||i.draftAdministrativeData.CreatedByUser);}else{c1(i.context,false);}});}d1=function(e){var i=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.UnsavedChangesDialog",{onEdit:function(){i.close();e1(true);},onCancel:function(){i.close();}},"Dialog");var j=i.getModel("Dialog");var k=T.oCommonUtils.getText("DRAFT_LOCK_EXPIRED",[e]);j.setProperty("/unsavedChangesQuestion",k);i.open();};function f1(){var j="{\"SelectionVariantID\":\"\"}";var k=p.getOwnerComponent();var S1=k.getEntitySet();var T1=k.getModel();var U1=T1.getMetaModel();var V1=U1.getODataEntitySet(S1);var W1=U1.getODataEntityType(V1.entityType);var X1=W1.property;var Y1=[];for(var x in X1){var Z1=X1[x]["com.sap.vocabularies.Common.v1.FieldControl"]&&X1[x]["com.sap.vocabularies.Common.v1.FieldControl"].Path;if(Z1&&Y1.indexOf(Z1)<0){Y1.push(Z1);}}var $1=p.getView().getBindingContext();var _1=$1.getObject();var a2=new a();for(var i in X1){var b2=X1[i].type;var c2=X1[i].name;var d2=_1[X1[i].name];if(Y1.indexOf(c2)>-1){continue;}if(c2&&(d2||b2==="Edm.Boolean")){if(b2==="Edm.Time"&&d2.ms!==undefined){d2=d2.ms;}if(typeof d2!=="string"){try{d2=d2.toString();}catch(e){d2=d2+"";}}a2.addParameter(c2,d2);}}j=a2.toJSONString();return j;}function g1(e,i1){var i=true;var j=i1.getModel();i1=i1 instanceof R?i1.getParent():i1;var k=T.oCommonUtils.getDeleteRestrictions(i1);var x=k&&k.Deletable&&k.Deletable.Path;if(x){i=j.getProperty(x,e);}return i;}var h1;var i1;function j1(e,j){h1=e;i1=j instanceof R?j.getParent():j;var k=[];X=function(x){var S1=T.oServices.oApplication.getBusyHelper();var T1=x.getSource().getParent();var U1=T.oCommonUtils.getSelectedContexts(i1);k=[];var V1;var W1;var X1=p.getView().getModel().getObject(U1[0].getPath());for(var i=0;i<U1.length;i++){if(g1(U1[i],i1)){k.push(U1[i].getPath());}}var Y1=T.oServices.oCRUDManager.deleteEntities(k);S1.setBusy(Y1);T.oServices.oApplicationController.executeSideEffects(i1.getBindingContext(),[],[i1.getTableBindingPath()]);var Z1=h1.getParent().getParent().getId();Y1.then(function(_1){T.oCommonUtils.refreshSmartTable(i1);if(X1.IsActiveEntity===false){W1=0;}else{W1=_1.length;}V1=k.length-W1;var a2="";if(V1>0){if(V1>1){a2=T.oCommonUtils.getContextText("DELETE_SUCCESS_PLURAL_WITH_COUNT",i1.getId(),null,[V1]);}else{if(W1>0){a2=T.oCommonUtils.getContextText("DELETE_SUCCESS_WITH_COUNT",i1.getId(),null,[V1]);}else{a2=T.oCommonUtils.getContextText("ITEM_DELETED",i1.getId());}}}if(W1>0){if(W1>1){a2+=a2&&a2+"\n";a2+=T.oCommonUtils.getContextText("DELETE_ERROR_PLURAL_WITH_COUNT",i1.getId(),null,[W1]);}else{if(V1>0){a2+="\n";a2+=T.oCommonUtils.getContextText("DELETE_ERROR_WITH_COUNT",i1.getId(),null,[W1]);}else{a2+=T.oCommonUtils.getContextText("DELETE_ERROR",i1.getId());}}}if(a2){if(W1>0){M.error(a2);}else{l.showSuccessMessageIfRequired(a2,T.oServices);}}});var $1={deleteEntitiesPromise:Y1,sUiElementId:Z1,aContexts:U1};T.oComponentUtils.fire(p,"AfterLineItemDelete",$1);T1.close();};return T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(i){var x=i.getSource().getParent();x.close();},onDelete:function(i){X(i);}},"delete");}function k1(e){var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var h1=e.getSource();var i1=T.oCommonUtils.getOwnerControl(h1);if(!T.oCommonUtils.isSmartTable(i1)){i1=i1.getParent();}var k=T.oCommonUtils.getSelectedContexts(i1);if(k.length===0){M.error(T.oCommonUtils.getText("ST_GENERIC_NO_ITEM_SELECTED"),{styleClass:T.oCommonUtils.getContentDensityClass()});return;}var x=[];var S1=[];for(var i=0;i<k.length;i++){if(g1(k[i],i1)){x.push(k[i].getPath());}else{S1.push(k[i]);}}var T1={};if(k.length>1){T1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE_WITH_COUNT",[k.length]);T1.text=T.oCommonUtils.getContextText("DELETE_SELECTED_ITEMS",i1.getId());}else{T1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE");T1.text=T.oCommonUtils.getContextText("DELETE_SELECTED_ITEM",i1.getId());}if(S1.length>0){T1.undeletableText=T.oCommonUtils.getContextText("DELETE_UNDELETABLE_ITEMS",i1.getId(),null,[S1.length,k.length]);}var U1={sUiElementId:h1.getParent().getParent().getId(),aContexts:k};var V1=Promise.resolve(p.beforeLineItemDeleteExtension(U1));V1.then(function(W1){jQuery.extend(T1,W1);var X1=j1(h1,i1);if(!S1.length){T1.undeletableText=undefined;}var Y1=X1.getModel("delete");Y1.setData(T1);X1.open();},jQuery.noop);}function l1(){var i=p.byId("imageDialog")||T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.ImageDialog",{onImageDialogClose:function(){i.close();}},"headerImage");return i;}function m1(){var e=T.oComponentUtils.getTemplatePrivateModel();e.setProperty("/objectPage/isHeaderExpanded",true);var i=p.byId("template::ObjectPage::TitleImage");if(!i){return;}var j=p.getView().byId("template::ObjectPage::ObjectPageHeader");j.attachStateChange(function(k){var x=k.getParameter("isExpanded");e.setProperty("/objectPage/isHeaderExpanded",x);});}function n1(){var e;var j=T.oComponentUtils.getTemplatePrivateModel();var k=function(i){return function(x){var S1=x.getSource();var T1=S1.getExternalValue();j.setProperty("/objectPage/headerInfo/"+i,T1);if(i==="objectTitle"){T.oComponentUtils.setText(T1);if(!T1){var U1=T.oComponentUtils.getHeaderDataAvailablePromise();U1.then(function(V1){T1=S1.getExternalValue();if(T1){return;}var W1=p.getView();var X1=V1.getObject();var Y1=W1.getModel("ui");var Z1=Y1.getProperty("/createMode");if(Z1&&X1&&(X1.IsActiveEntity===undefined||X1.IsActiveEntity===false||X1.HasActiveEntity===false)){e=e||T.oCommonUtils.getText("NEW_OBJECT");j.setProperty("/objectPage/headerInfo/objectTitle",e);T.oComponentUtils.setText(e);}});}}};};O.getCustomData().forEach(function(x){var S1=x.getKey();if(S1==="objectTitle"||S1==="objectSubtitle"){var T1=x.getBinding("value");var U1=!T1&&x.getBindingInfo("value");if(!T1&&!U1){j.setProperty("/objectPage/headerInfo/"+S1,x.getValue());return;}var V1=k(S1);if(T1){T1.attachChange(V1);n(T1,"string");}else{U1.events={change:V1};for(var i=0;i<U1.parts.length;i++){U1.parts[i].targetType="string";}}}});}function o1(e){e.preventDefault();var i=T.oCommonUtils.getControlInformation(e,null,true);if(i){T.oCommonUtils.processDataLossConfirmationIfNonDraft(i.navigate,jQuery.noop,B.state);}}function p1(e,i){L.info("Set binding context to "+e,"Subsection: "+i.getId(),"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");i.setBindingContext(e);}function q1(e,i,j,k){if(i){var x=e?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();x.then(function(){p1(undefined,j);var S1=j.getId();L.info("Start refreshing of Subsection: "+S1,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");k.refresh(null,true);L.info("End refreshing of Subsection: "+S1,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");});}else{p1(null,j);}}var r1={lazyLoading:q1.bind(null,false),lazyLoadingAfterHeader:q1.bind(null,true),reuseComponent:function(i,e){var j=e.getBlocks()[0];var k=i?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();k.then(T.oComponentUtils.onVisibilityChangeOfReuseComponent.bind(null,i,j));}};function s1(e,i,j){if(j instanceof c){j=j.getMainContent()[0];}else if(!j.getContent){return;}j.getContent().forEach(function(k){if(T.oCommonUtils.isSmartTable(k)){if(i||e[k.getEntitySet()]){if(k.isInitialised()){T.oCommonUtils.refreshSmartTable(k);}else{k.attachInitialise(function(){T.oCommonUtils.refreshSmartTable(k);});}if(!i){T.oServices.oApplicationController.executeSideEffects(p.getOwnerComponent().getBindingContext(),[],[k.getTableBindingPath()]);}}}});}function t1(e){return T.oCommonUtils.getControlInformation(e);}function u1(e){T.oCommonUtils.getControlInformation(e,function(i,j){var k=e.getBlocks();w.initSideContentInfoObject(k[0]);var x=k.concat(e.getMoreBlocks());i.refresh=function(U1,V1){var W1=s1.bind(null,U1,V1);x.forEach(W1);};var S1=T.oCommonUtils.getElementCustomData(e).strategyForVisibilityChange;var T1=r1[S1];i.strategyForVisibilityChange=T1||jQuery.noop;if(T1){j.push("subSectionListeningToVisibilityChange");}});}function v1(i,e,j){e=e||t1(j);if(e.isVisible===i){return;}e.isVisible=i;e.strategyForVisibilityChange(i,j,e);}function w1(i){T.oCommonUtils.executeForAllInformationObjects("subSectionListeningToVisibilityChange",v1.bind(null,i));}function x1(e){var j=[];for(var i=0;i<e.length;i++){if(e[i].getVisible()){j.push(e[i]);}}return j;}function y1(){var e=[];var i=O.getSections();e=x1(i);if(e.length===1){return z1(e[0]);}return false;}function z1(e){if(e){var i=[];var j=e.getSubSections();i=x1(j);return i.length===1;}}function A1(i1){var e=i1.getParent();var i=e.getParent();if(e&&e.isA("sap.ui.layout.Grid")&&i&&i.isA("sap.uxap.ObjectPageSubSection")){e.addStyleClass("sapSmartTemplatesObjectPageSubSectionGridExpand");i.addStyleClass("sapUxAPObjectPageSubSectionFitContainer");i1.setFitContainer(true);}}function B1(e,i){var j="sapUiSizeCompact",k="sapUiSizeCondensed",x;if(!e){return;}x=jQuery(document.body);if(x.hasClass(j)){i.addStyleClass(k);}}function C1(i1,e,i){if(e.isA("sap.m.Table")){e.setGrowingThreshold(m);e.setGrowingScrollToLoad(true);}else if(e.isA("sap.ui.table.Table")){A1(i1);B1(i,e);}}function D1(i1,e,i){var j;var k=p.getOwnerComponent().mProperties;if(k&&k.sections){var x=k.sections[i];if(x&&x.hasOwnProperty("condensedTableLayout")){j=x.condensedTableLayout;}else{j=k.condensedTableLayout;}}else{j=k.condensedTableLayout;}if(O.getUseIconTabBar()){var S1=e.getParent();while(S1&&S1.sParentAggregationName!=="sections"){S1=S1.getParent();}if(z1(S1)){C1(i1,e,j);}}else if(y1()){C1(i1,e,j);}}function E1(e){var i=e&&e.getParameter("section");y=i?i.getId():O.getSelectedSection();}function F1(e){E1(e);B.stateChanged();}function G1(e,i,j,k,x){var S1=A.createP13NColumnKey(x);var T1=A.getBindingForHiddenPath(x);if(T1==="{= !${} }"){e.push(S1);return false;}if(typeof(T1)==="string"){var U1=T1.match(r)&&T1.match(r)[0];if(U1&&U1.indexOf("/")>0&&k.navigationProperty){var V1=p.getOwnerComponent().getEntitySet();var W1=U1.split("/",1)[0];if(j.getODataAssociationSetEnd(k,W1).entitySet===V1){i[S1]=U1.split("/").slice(1).join("/");return true;}}}else if(!T1){e.push(S1);}return false;}function H1(i1,e,j,k,x,S1){var T1=[];var U1=Object.create(null);var V1=false;for(var i=0;i<S1.length;i++){var W1=S1[i];V1=G1(T1,U1,k,x,W1)||V1;}if(V1){e.dynamicHideInfos={staticHiddenColumns:T1,columnKeyToHiddenPath:U1};j.push("smartTableWithDynamicColumnHide");}if(T1.length){i1.deactivateColumns(T1);}}function I1(e,j,i1){j.push("smartTable");i1=T.oCommonUtils.isMTable(i1)?i1.getParent():i1;var k=i1.getModel().getMetaModel();var x=k.getODataEntitySet(i1.getEntitySet());var S1=k.getODataEntityType(x.entityType);var T1=S1["com.sap.vocabularies.UI.v1.LineItem"];var U1=i1.getCustomData();for(var i=0;i<U1.length;i++){if(U1[i].getKey()==="lineItemQualifier"){T1=S1["com.sap.vocabularies.UI.v1.LineItem#"+U1[i].getValue()];break;}}H1(i1,e,j,k,S1,T1||[]);}function J1(i1){return T.oCommonUtils.getControlInformation(i1,I1);}function K1(e,i){var j,k;j=i.split(e)[1];k=j&&j.substring(0,j.lastIndexOf("::Table"));return k;}function L1(e,i,j){i.push("searchField");var k=T.oCommonUtils.isMTable(j.getParent().getParent())?j.getParent().getParent().getParent():j.getParent().getParent();e.table=k;var x=J1(k);x.searchField=j;}function M1(e){return T.oCommonUtils.getControlInformation(e,L1);}function N1(e){M1(e);}function O1(e){var i=M1(e);i.searchString=e.getSource().getValue();i.table.rebindTable();}function P1(e,i){i.setValue("");if(e.searchString){e.searchString="";e.table.rebindTable();}}function Q1(){T.oCommonUtils.executeForAllInformationObjects("searchField",P1);}v.refreshFacets=function(e){var i=function(j){var k=t1(j);k.refresh(e,false);};O.getSections().forEach(function(j){j.getSubSections().forEach(i);});};v.onComponentActivate=B.onComponentActivate;v.getCurrentState=function(){var e=Object.create(null);if(y){e.section={data:y,lifecycle:{permanent:true,pagination:true}};}e.sideContent=w.getCurrentState();var i=Object.create(null);p.provideCustomStateExtension(i);for(var j in i){e["$custom$"+j]=i[j];}var k=true;var x=function(S1,T1){if(!(S1 instanceof C)){throw new Error("State must always be set with respect to a ControllerExtension");}if(!k){throw new Error("State must always be provided synchronously");}var U1=S1.getMetadata().getNamespace();if(T1){for(var V1 in T1){e["$extension$"+U1+"$"+V1]=T1[V1];}}};p.templateBaseExtension.provideExtensionStateData(x);k=false;return e;};v.applyState=function(q,i){var e=Object.create(null);var j=Object.create(null);for(var k in q){if(k.indexOf("$custom$")===0){e[k.substring(8)]=q[k];}else if(k.indexOf("$extension$")===0){var x=k.substring(11,k.indexOf("$",11));var S1=j[x];if(!S1){S1=Object.create(null);j[x]=S1;}var T1=k.substring(k.indexOf("$",11)+1,k.length);S1[T1]=q[k];}}p.applyCustomStateExtension(e,i);var U1=true;var V1=function(W1){if(!(W1 instanceof C)){throw new Error("State must always be retrieved with respect to a ControllerExtension");}if(!U1){throw new Error("State must always be restored synchronously");}var x=W1.getMetadata().getNamespace();return j[x];};p.templateBaseExtension.restoreExtensionStateData(V1,i);U1=false;w.applyState(q.sideContent,i);if(i){if(y!==(q.section||"")){B.stateChanged();}return;}Q1();if(q.section){O.setSelectedSection(q.section);E1();}else{Promise.all([T.oComponentUtils.getHeaderDataAvailablePromise(),T.oComponentUtils.getNavigationFinishedPromise()]).then(s.bind(null,O));y="";}};v.beforeRebind=function(){w1(false);};v.afterRebind=function(){L.info("Call of _triggerVisibleSubSectionsEvents","","Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");O._triggerVisibleSubSectionsEvents();};v.applyHeaderContextToSmartTablesDynamicColumnHide=function(e){var i=function(j,i1){var k=j.dynamicHideInfos.staticHiddenColumns.slice();for(var x in j.dynamicHideInfos.columnKeyToHiddenPath){var S1=j.dynamicHideInfos.columnKeyToHiddenPath[x];if(e.getProperty(S1)){k.push(x);}}i1.deactivateColumns(k);};T.oCommonUtils.executeForAllInformationObjects("smartTableWithDynamicColumnHide",i);};var e1=t.testable(e1,"editEntity");var g1=t.testable(g1,"isEntryDeletable");var G=t.testable(G,"onActivateImpl");var N=t.testable(N,"onSaveImpl");var R1={onInit:function(){O=p.byId("objectPage");var e=p.getOwnerComponent();var i=O.getSections();for(var k=0;k<i.length;k++){var j=i[k];var x=j.getSubSections();x.forEach(u1);}var S1=U();var T1=e.getAppComponent().getConfig();var U1=!!(T1.settings&&(T1.settings.objectPageDynamicHeaderTitleWithVM||T1.settings.objectPageHeaderType==='Dynamic'));v.aBreadCrumbs=S1&&(U1?S1.getBreadcrumbs().getLinks():S1.getBreadCrumbsLinks());if(U1){m1();}B.onInit(null,w1.bind(null,true));n1();T.oCommonUtils.executeGlobalSideEffect();O.attachEvent("subSectionEnteredViewPort",function(Y1){var Z1=Y1.getParameter("subSection");L.info("Viewport entered ","Subsection: "+Z1.getId(),"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");v1(true,null,Z1);});var V1=p.getOwnerComponent()&&p.getOwnerComponent().getSections();for(var W1 in V1){if(V1.hasOwnProperty(W1)){V1[W1]["key"]=W1;q.oMultipleViewsHandler[W1]=new h(q,p,T,V1[W1]);q.oMultipleViewsHandler[W1]["oSmartTable"]=p.byId(W1+"::Table");}}var X1=T.oComponentUtils.getTemplatePrivateModel();X1.setProperty("/objectPage/aPasteAttachedTables",[]);},handlers:{onEditAndActiveToggle:function(e,i){T.oServices.oApplication.performAfterSideEffectExecution(function(){var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var k=e.getBindingContext();var x=T.oServices.oApplication.getDraftSiblingPromise(k);j.setBusy(x.then(function(S1){if(i){L.info("Navigating to draft entity");c1(S1,true);}else{L.info("Navigating to active entity");T.oServices.oNavigationController.navigateToContext(S1,null,true,1,true);}g(':focus').blur();}));});},addEntry:function(e){var h1=e.getSource();var i1=T.oCommonUtils.getOwnerControl(h1);i1=T.oCommonUtils.isMTable(i1)?i1.getParent():i1;var i=I(i1);if(!h1.data("CrossNavigation")&&i){T.oCommonEventHandlers.addEntry(h1,true);return;}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){T.oCommonEventHandlers.addEntry(h1,false);},jQuery.noop,B.state);},submitChangesForSmartMultiInput:function(){if(T.oComponentUtils.isDraftEnabled()){T.oCommonEventHandlers.submitChangesForSmartMultiInput();}},deleteEntries:k1,onSelectionChange:function(e){T.oCommonUtils.setEnabledToolbarButtons(e.getSource());},onCancel:function(e){var i=e.getSource();var j=B.state.onCancel(i);j.then(function(){a1();});},onContactDetails:function(e){T.oCommonEventHandlers.onContactDetails(e);},onPressDraftInfo:function(e){var i=p.getView().getBindingContext();var j=sap.ui.getCore().byId(e.getSource().getId()+(e.getId()==="markChangesPress"?"-changes":"-lock"));T.oCommonUtils.showDraftPopover(i,j);},onPressDraftInfoObjectPageDynamicHeaderTitle:function(e){var i=p.getView().getBindingContext();var j=p.byId("template::ObjectPage::ObjectMarkerObjectPageDynamicHeaderTitle");T.oCommonUtils.showDraftPopover(i,j);},onShareObjectPageActionButtonPress:V,onRelatedApps:function(e){var x,S1,T1,U1,V1,W1,X1;var Y1,Z1,$1,_1,a2;x=e.getSource();$1=sap.ushell&&sap.ushell.Container;S1=$1&&$1.getService("URLParsing");T1=S1.parseShellHash(document.location.hash);_1=T1.semanticObject;a2=T1.action;U1=p.getView&&p.getView().getBindingContext();var b2=p.getOwnerComponent().getModel().getMetaModel();var c2=U1.getObject();var d2=c2.__metadata.type;var e2=b2.getODataEntityType(d2);var f2=e2["com.sap.vocabularies.Common.v1.SemanticKey"];var g2={};if(f2&&f2.length>0){for(var j=0;j<f2.length;j++){var h2=f2[j].PropertyPath;if(!g2[h2]){g2[h2]=[];g2[h2].push(c2[h2]);}}}else{for(var k in e2.key.propertyRef){var i2=e2.key.propertyRef[k].name;if(!g2[i2]){g2[i2]=[];g2[i2].push(c2[i2]);}}}V1=p.getOwnerComponent().getAppComponent();W1=$1&&$1.getService("CrossApplicationNavigation");X1=W1.getLinks({semanticObject:_1,params:g2,ui5Component:V1});Y1=W();Z1=Y1.getModel("buttons");Z1.setProperty("/buttons",[]);Y1.openBy(x);X1.done(function(j2){var k2=[];j2.sort(function(o2,p2){if(o2.text<p2.text){return-1;}if(o2.text>p2.text){return 1;}return 0;});for(var i=0;i<j2.length;i++){var l2=j2[i];var m2=l2.intent;var n2=m2.split("-")[1].split("?")[0];if(n2!==a2){k2.push({enabled:true,text:l2.text,link:l2,param:g2});}}if(k2.length===0){k2.push({enabled:false,text:T.oCommonUtils.getText("NO_RELATED_APPS")});}Z1.setProperty("/buttons",k2);});},onSemanticObjectLinkPopoverLinkPressed:function(e){T.oCommonEventHandlers.onSemanticObjectLinkPopoverLinkPressed(e,B.state);},onEdit:function(e){var h1=e.getSource();if(h1.data("CrossNavigation")){T.oCommonEventHandlers.onEditNavigateIntent(h1);return;}u=true;e1();},onSave:P,onActivate:H,onSmartFieldUrlPressed:function(e){T.oCommonEventHandlers.onSmartFieldUrlPressed(e,B.state);},onBreadCrumbUrlPressed:o1,onDelete:b1,onCallActionFromToolBar:function(e){T.oCommonEventHandlers.onCallActionFromToolBar(e,B.state);},onCallAction:function(e,i,j){T.oServices.oApplication.performAfterSideEffectExecution(function(){var k=p.getView().getBindingContext();if(k){T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var x=p.getOwnerComponent();var S1=x.getEntitySet();var T1={functionImportPath:e,contexts:[k],sourceControl:"",label:i,operationGrouping:j,navigationProperty:x.getNavigationProperty()};T.oServices.oCRUDManager.callAction(T1).then(function(U1){var V1=U1&&U1[0];if(V1&&V1.response&&V1.response.context&&(!V1.actionContext||V1.actionContext&&V1.response.context.getPath()!==V1.actionContext.getPath())){T.oServices.oViewDependencyHelper.setParentToDirty(x,S1,1);}});},jQuery.noop,B.state,"Proceed");}},true);},onDataFieldForIntentBasedNavigation:function(e){e=jQuery.extend({},e);T.oServices.oApplication.performAfterSideEffectExecution(function(){T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){T.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,B.state);});},true);},onDataFieldWithIntentBasedNavigation:function(e){T.oCommonEventHandlers.onDataFieldWithIntentBasedNavigation(e,B.state);},onDataFieldWithNavigationPath:function(e){T.oCommonEventHandlers.onDataFieldWithNavigationPath(e);},onChartInit:function(e){e.getSource().getChartAsync().then(function(i){var j=p._templateEventHandlers.onSelectionChange;i.attachSelectData(j).attachDeselectData(j);var k=i.getParent();T.oCommonUtils.checkToolbarIntentsSupported(k);});},onDataRequested:function(i){L.info("Data requested","SmartTable: "+i,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");var e=(p&&p.getView()&&p.getView().getId())+"--";var j=K1(e,i);q.oMultipleViewsHandler[j]&&q.oMultipleViewsHandler[j].onDataRequested();},onDataReceived:function(e){T.oCommonEventHandlers.onDataReceived(e);},onBeforeRebindDetailTable:function(e){var i,j,k;var i1=e.getSource();var x=z(e);var S1=J1(i1);var T1=S1.searchField;if(T1){var U1=T.oCommonUtils.getControlInformation(T1);if(U1.searchString){x.parameters.custom={search:U1.searchString};}}T.oCommonEventHandlers.onBeforeRebindTable(e,{ensureExtensionFields:p.templateBaseExtension.ensureFieldsForSelect,addExtensionFilters:p.templateBaseExtension.addFilters});p.onBeforeRebindTableExtension(e);k=p&&typeof p.getView==="function"&&p.getView()&&typeof p.getView().getId==="function"&&p.getView().getId();if(k){k=k+"--";j=i1&&i1.getId();i=K1(k,j);q.oMultipleViewsHandler[i]&&q.oMultipleViewsHandler[i].onRebindContentControl(e);}Q(e);if(T.oCommonUtils.isAnalyticalTable(i1.getTable())){x.parameters.entitySet=i1.getEntitySet();}},onListNavigate:function(e){T.oCommonEventHandlers.onListNavigate(e,B.state,p.onListNavigationExtension.bind(p));},onBeforeSemanticObjectLinkPopoverOpens:function(e){var i=e.getParameters();T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var j=f1();T.oCommonUtils.semanticObjectLinkNavigation(i,j,p);},jQuery.noop,B.state,jQuery.noop);},onSemanticObjectLinkNavigationPressed:function(e){var i=e.getParameters();var h1=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationPressed(h1,i);},onSemanticObjectLinkNavigationTargetObtained:function(e){var i=e.getParameters();var h1=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(h1,i,B.state);},onSemanticObjectLinkNavigationTargetObtainedSmartLink:function(e){var i,h1;i=e.getParameters();h1=e.getSource();h1=h1.getParent().getParent().getParent().getParent();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(h1,i,B.state);},onHeaderImagePress:function(e){if(e.getSource().getSrc()===""){return;}var i=l1();var j=e.getSource().getId();i.addAriaLabelledBy(j);var k=i.getModel("headerImage");k.setProperty("/src",e.getSource().getSrc());if(sap.ui.Device.system.phone){i.setProperty("stretch",true);}i.open();},sectionNavigate:F1,onInlineDataFieldForAction:function(e){T.oCommonEventHandlers.onInlineDataFieldForAction(e,B.state);},onInlineDataFieldForIntentBasedNavigation:function(e){T.oCommonEventHandlers.onInlineDataFieldForIntentBasedNavigation(e.getSource(),B.state);},onDeterminingDataFieldForAction:function(e){T.oCommonEventHandlers.onDeterminingDataFieldForAction(e);},onBeforeRebindChart:function(e){z(e);var i=e.getSource();i.getChartAsync().then(function(k){i.oModels=k.oPropagatedProperties.oModels;});var j={ensureExtensionFields:jQuery.noop,addExtensionFilters:p.templateBaseExtension.addFilters};T.oCommonUtils.onBeforeRebindTableOrChart(e,j);},onToggleDynamicSideContent:w.onToggleDynamicSideContent,sideContentBreakpointChanged:w.sideContentBreakpointChanged,onTableInit:function(e){var i;var i1=e.getSource();var j=i1.getTable();J1(i1);T.oCommonUtils.checkToolbarIntentsSupported(i1);var k=(p&&typeof p.getView==="function"&&p.getView()&&p.getView().getId())+"--";var x=i1&&i1.getId();i=K1(k,x);q.oMultipleViewsHandler[i]&&q.oMultipleViewsHandler[i].init(e);D1(i1,j,i);if(I(i1)&&!i1.data("CrossNavigation")){j.addEventDelegate({onkeyup:function(e){if(e.ctrlKey&&e.keyCode===K.ENTER&&i1.getEditable()){T.oCommonEventHandlers.addEntry(i1,true);e.preventDefault();e.setMarked();}}});}var S1=x.split("::Table")[0]+"::addEntry";var T1=p.byId(S1);var U1=T.oComponentUtils.getTemplatePrivateModel();if(T1&&T1.isA("sap.m.Button")){j.addEventDelegate({onAfterRendering:function(e){var V1;if(i1.getEditable()&&!i1.hasListeners("paste")){i1.attachBeforePaste($);i1.attachPaste(_);V1=U1.getProperty("/objectPage/aPasteAttachedTables");if(V1){V1.push(i);}}}});}},onSearchObjectPage:O1,onSearchLiveChange:N1,onSmartTablePaste:_,onUITableExpand:A1,onSingleVisibleSection:y1,onSingleVisibleSubSection:z1},formatters:{sideContentActionButtonText:w.formatSideContentActionButtonText,setNoDataTextForSmartTable:function(e){if(T.oCommonUtils&&e){var i=T.oCommonUtils.getContextText("NOITEMS_SMARTTABLE",e);if(i!=="NOITEMS_SMARTTABLE"){return i;}return"";}},setVMVisibilityForVendor:function(){var e=jQuery.sap.getUriParameters();if(e.mParams["sap-ui-layer"]){var j=e.mParams["sap-ui-layer"];for(var i=0;i<j.length;i++){if(j[i].toUpperCase()==="VENDOR"){return true;}}}return false;},formatItemTextForMultipleView:function(i){var e=i&&i.facetId;return q.oMultipleViewsHandler[e]?q.oMultipleViewsHandler[e].formatItemTextForMultipleView(i):"";}},extensionAPI:new E(T,p,B)};R1.handlers=jQuery.extend(B.handlers,R1.handlers);return R1;}};return o;});
