sap.ui.define(["sap/ui/base/Object","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/lib/testableHelper"],function(B,M,a,F,b,c,t){"use strict";F=t.observableConstructor(F,true);var p=new F({path:"persistent",operator:b.EQ,value1:false});var s=new F({path:"technical",operator:b.EQ,value1:false});var v=new F({path:"validation",operator:b.EQ,value1:true});var I=new F({filters:[v,new F({path:"validation",operator:b.EQ,value1:false})],and:true});function g(T,h,d){var C=h.controller;var A=false;var m=C.byId("showMessages");function e(i){return!!(i&&T.oCommonUtils.getPositionableControlId(i));}var o;var f=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.fragments.MessagePopover",{beforeOpen:function(){if(h.prepareAllMessagesForNavigation){var L=o.getCurrentContexts();for(var i=0;i<L.length;i++){var O=L[i].getObject();if(!e(O.controlIds)){h.prepareAllMessagesForNavigation();return;}}}},isPositionable:e,titlePressed:function(i){c.navigateFromMessageTitleEvent(T.oCommonUtils,i);}});f.setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"msg");o=f.getBinding("items");var E;(function(){var i=C.getOwnerComponent();E=new F({path:"target",operator:b.EQ,value1:"/"+i.getEntitySet()});var L=i.getModel("_templPriv");L.setProperty("/generic/messageCount",0);var O=T.oCommonUtils.getText("MESSAGE_BUTTON_TOOLTIP_P",0);L.setProperty("/generic/messageButtonTooltip",O);o.attachChange(function(){var P=o.getLength();L.setProperty("/generic/messageCount",P);O=T.oCommonUtils.getText(P===1?"MESSAGE_BUTTON_TOOLTIP_S":"MESSAGE_BUTTON_TOOLTIP_P",P);L.setProperty("/generic/messageButtonTooltip",O);});})();var l=new F({filters:[v,new F({path:"controlIds",test:function(i){return!!T.oCommonUtils.getPositionableControlId(i);},caseSensitive:true})],and:true});var j=[];var k;var n=0;var N;var q;var r;function u(L){if(jQuery.isArray(L)){var O=false;for(var i=0;i<L.length;i++){O=u(L[i])||O;}return O;}if(L instanceof Promise){L.then(N);return false;}r.push(L);return true;}function w(i){q=i;o.filter(q);}function x(){if(A){var i=new F({filters:r,and:false});var P=[i,p];if(T.oServices.oApplication.needsToSuppressTechnicalStateMessages()){P.push(s);}var L=new F({filters:P,and:true});w(new F({filters:[L,l],and:false}));}}function R(i,L){if(i===n&&u(L)){x();}}function y(P){var i=P();return u(i);}function z(){j.forEach(y);}function D(i){k=i;n++;N=R.bind(null,n);r=d?[new F({path:"fullTarget",operator:b.StartsWith,value1:k}),E]:[];z();x();}function G(P){j.push(P);if(k!==undefined&&y(P)){x();}}var S;function H(){S=S||function(){if(o.getLength()>0){f.openBy(m);}};setTimeout(S,0);}function J(i){A=i;if(i){if(r){x();}}else{r=null;w(I);}}function K(O){return O?l:q;}return{adaptToContext:D,toggleMessagePopover:f.toggle.bind(f,m),showMessagePopover:H,registerMessageFilterProvider:G,setEnabled:J,getMessageFilters:K};}return B.extend("sap.suite.ui.generic.template.lib.MessageButtonHelper",{constructor:function(T,h,i){jQuery.extend(this,(t.testableStatic(g,"MessageButtonHelper"))(T,h,i));}});});
