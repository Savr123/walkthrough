/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/core/ComponentContainer","sap/ui/core/routing/HashChanger","sap/ui/core/routing/History","sap/ui/core/library","sap/suite/ui/generic/template/lib/ProcessObserver","sap/suite/ui/generic/template/lib/routingHelper","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/testableHelper","sap/ui/fl/ControlPersonalizationAPI","sap/base/Log"],function(B,C,H,a,c,P,r,T,t,b,L){"use strict";var d=c.routing.HistoryDirection;var h=a.getInstance();var o=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");function f(R){var e=R.substring(R.length-5,R.length);if(e==="query"){return R.substring(0,R.length-5);}return R;}function n(s){if(s.indexOf("/")===0){return s;}return"/"+s;}function A(e){var D="";var R="";var j=Object.keys(e).sort();j.forEach(function(s){var v=e[s];if(jQuery.isArray(v)){var V=v.sort();for(var i=0;i<V.length;i++){var q=V[i];R=R+D+s+"="+q;D="&";}}else{R=R+D+s+"="+v;}});return R;}function g(s,e){s=s||"";var D=(s.charAt(s.length-1)==="/")?"?":"/?";return s+(e?D+e:"");}function k(s,e){var i=A(e);return g(s,i);}function l(i,R,j){var q=i.mRoutingTree[R.name];var s=R.template;var E=R.entitySet;var v=q.level;var O=-1;if(i.oFlexibleColumnLayoutHandler){O=v<3?v:0;}var u=O<0?i.oNavigationObserver:i.aNavigationObservers[O];var w=new P();var x=O<0?i.oHeaderLoadingObserver:i.aHeaderLoadingObservers[O];x.addObserver(w);var y={};var S={appComponent:i.oAppComponent,isLeaf:!R.pages||!R.pages.length,entitySet:E,navigationProperty:R.navigationProperty,componentData:{registryEntry:{oAppComponent:i.oAppComponent,componentCreateResolve:j,route:R.name,routeConfig:R,viewLevel:q.level,routingSpec:R.routingSpec,oNavigationObserver:u,oHeaderLoadingObserver:w,preprocessorsData:y}}};if(R.component.settings){jQuery.extend(S,R.component.settings);}var z;i.oAppComponent.runAsOwner(function(){try{var D=sap.ui.core.Component.create({name:s,settings:S,handleValidation:true,manifest:true});var F;z=new C({propagateModel:true,width:"100%",height:"100%",settings:S});F=D.then(function(G){z.setComponent(G);var q=i.mRoutingTree[R.name];q.componentId=G.getId();return z;});z.loaded=function(){return F;};}catch(e){throw new Error("Component "+s+" could not be loaded");}});return z;}function m(e,q){t.testable(l,"fnCreateComponentInstance");var s=!o||o.isInitialNavigation();var M={};var u={iHashChangeCount:0,backTarget:0,aCurrentKeys:[],componentsDisplayed:Object.create(null)};var v=[];var w=Promise.resolve();function G(){var i=q.oRouter,j=i.getTargets()._mTargets,S1=[];Object.keys(j).forEach(function(T1){var U1=j[T1],V1=U1._oOptions,W1=i.getRoute(V1.viewName),X1=W1&&W1._oConfig;if(X1&&(!X1.navigation||!X1.navigation.display)){S1.push({oConfig:X1});}});return S1;}t.testable(G,"fnGetAllPages");function x(i){var j=i||G();if(!Array.isArray(j)){j=[j];}j.forEach(function(S1){S1.oComponentContainer=l(e,S1.oConfig,function(){});});return j;}t.testable(x,"fnCreatePages");function y(){var i=q.oRouter.getViews();i.getView({viewName:"root"});return e.mRouteToTemplateComponentPromise.root;}function z(){return q.oAppComponent.getManifestEntry("sap.app").title;}function D(i,j,S1){var T1=i&&e.componentRegistry[i];var U1=T1&&T1.methods.getUrlParameterInfo;return U1?T1.viewRegistered.then(function(){var V1=j&&n(j);return U1(V1,u.componentsDisplayed[T1.route]===1).then(function(W1){jQuery.extend(S1,W1);});}):Promise.resolve();}function E(i,j,S1){var T1=e.mRoutingTree[i];return D(T1.componentId,S1,j);}function S(i,j){var S1;if(!i&&j instanceof T){var T1=j&&e.componentRegistry[j.getId()];var U1=T1&&T1.methods.getTitle;S1=U1&&U1();}else if(!i&&j&&j.title){S1=j.title;}S1=S1||z();e.oShellServicePromise.then(function(V1){V1.setTitle(S1);});}function F(i){var j=[e.oPagesDataLoadedObserver.getProcessFinished(true)];var S1=null;var T1=u.iHashChangeCount;delete O.componentsDisplayed;var U1=-1;for(var V1 in e.componentRegistry){var W1=e.componentRegistry[V1];var X1=W1.oControllerUtils&&W1.oControllerUtils.oServices.oTemplateCapabilities.oMessageButtonHelper;var Y1=u.componentsDisplayed[W1.route]===1;var Z1=W1.utils.getTemplatePrivateModel();Z1.setProperty("/generic/isActive",Y1);if(Y1){j.push(W1.oViewRenderedPromise);if(W1.viewLevel>U1){U1=W1.viewLevel;S1=W1.oComponent;}}else{W1.utils.suspendBinding();}if(X1){X1.setEnabled(Y1);}}var $1=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.isAppTitlePrefered();S($1,i||S1);Promise.all(j).then(function(){if(T1===u.iHashChangeCount&&jQuery.isEmptyObject(M)){e.oAppComponent.firePageDataLoaded();}});}var I=F.bind(null,null);function J(i,j){var S1=[];for(var T1=i;T1.level>=j;T1=e.mRoutingTree[T1.parentRoute]){S1.push(T1);}return S1.reverse();}function K(j,S1,T1){if(j.level===0){return null;}var U1=T1?j.pattern:j.contextPath;if(!U1){return null;}if(U1.indexOf("/")!==0){U1="/"+U1;}for(var i=1;i<=j.level;i++){U1=U1.replace("{keys"+i+"}",S1[i]);}return U1;}var R;var O;var Q;t.testable(function(i){O=i;v.push(u);u={backTarget:0,componentsDisplayed:Object.create(null)};},"setCurrentIdentity");function U(){return O;}function V(j,S1){if(jQuery.isArray(j)&&j.length<2){j=j[0];}if(jQuery.isArray(S1)&&S1.length<2){S1=S1[0];}if(jQuery.isArray(j)){if(jQuery.isArray(S1)){if(j.length===S1.length){j=j.sort();S1=S1.sort();return j.every(function(T1,i){return T1===S1[i];});}return false;}return false;}return S1===j;}function W(i){if(!O||O.treeNode!==i.treeNode){return false;}for(var j=i.treeNode;j.level>0;j=e.mRoutingTree[j.parentRoute]){if(!j.noKey&&i.keys[j.level]!==O.keys[j.level]){return false;}}if(jQuery.isEmptyObject(i.appStates)!==jQuery.isEmptyObject(O.appStates)){return false;}if(jQuery.isEmptyObject(i.appStates)){return true;}var S1=jQuery.extend(Object.create(null),i.appStates,O.appStates);for(var T1 in S1){if(!V(i.appStates[T1],O.appStates[T1])){return false;}}return true;}function X(i,j,S1){var T1=Object.create(null);for(var U1=i;U1.level>0;U1=e.mRoutingTree[U1.parentRoute]){if(!U1.noKey){T1["keys"+U1.level]=j[U1.level];}}var V1=!jQuery.isEmptyObject(S1);var W1=i.sRouteName+(V1?"query":"");if(V1){T1["query"]=S1;}return{route:W1,parameters:T1};}function Y(i){var j=X(R.identity.treeNode,R.identity.keys,R.identity.appStates);q.oRouter.navTo(j.route,j.parameters,i);}function Z(i){var j;if(i){if(R||(O&&O.preset)){R={identity:i.identity,followUpNeeded:true};return;}if(i.identity&&W(i.identity)){return;}j=i.mode;R=i;}else{j=1;}R.followUpNeeded=j<0;e.oBusyHelper.setBusyReason("HashChange",true);if(j<0){window.history.go(j);}else{Y(j===1);}}function $(i,j){i.text=((i.headerTitle!==j)&&j)||"";if(Q&&Q.linkInfos.length>i.level){Q.adjustNavigationHierarchy();}}function _(i,j){var S1=Object.create(null);var T1=K(i,O.keys);if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrlParameters(S1,i);}var U1={treeNode:i};var V1=D(i.componentId,T1,S1).then(function(){var W1=X(i,O.keys,S1);U1.fullLink=q.oRouter.getURL(W1.route,W1.parameters);});j.push(V1);U1.navigate=function(W1){e.oBusyHelper.setBusy(V1.then(function(){var X1={treeNode:i,keys:O.keys.slice(0,i.level+1),appStates:S1};h1(X1);}));};U1.adaptBreadCrumbLink=function(W1){V1.then(function(){var _1=q.oHashChanger.hrefForAppSpecificHash?q.oHashChanger.hrefForAppSpecificHash(U1.fullLink):"#/"+U1.fullLink;W1.setHref(_1);});var X1=function(){$(i,W1.getText());};if(!U1.bLinkAttached){U1.bLinkAttached=true;var Y1=W1.getBindingInfo("text")||{};Y1.events={change:X1};}var Z1=W1.getElementBinding();var $1=Z1&&Z1.getPath();if($1===T1){X1();}else{W1.bindElement({path:T1});}};return U1;}function a1(i,j){var S1={title:j.treeNode.headerTitle||"",icon:j.treeNode.titleIconUrl||"",subtitle:j.treeNode.text,intent:i+j.fullLink};return S1;}function b1(){var j=[];var S1=[];var T1=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.hasNavigationMenuSelfLink(O);for(var U1=T1?O.treeNode:e.mRoutingTree[O.treeNode.parentRoute];U1;U1=e.mRoutingTree[U1.parentRoute]){var V1=_(U1,S1);j[U1.level]=V1;}var W1=Promise.all(S1);var X1=location.hash;var Y1=X1.indexOf("?");var Z1=(Y1!==-1&&Y1<X1.indexOf("&"))?"?":"&";var $1=X1.split(Z1)[0]+"&/";var _1=function(){e.oShellServicePromise.then(function(a2){a2.setHierarchy([]);W1.then(function(){var b2=[];for(var i=j.length-1;i>=0;i--){b2.push(a1($1,j[i]));}a2.setHierarchy(b2);});});};Q={linkInfos:j,adjustNavigationHierarchy:_1};_1();}function c1(){return Q.linkInfos;}function d1(i){var j=O;if(R&&R.identity&&!R.followUpNeeded){O=R.identity;}else{O=Object.create(null);var S1=i.getParameter("config");var T1=f(S1.name);O.treeNode=e.mRoutingTree[T1];var U1=i.getParameter("arguments");O.appStates=U1["?query"]||Object.create(null);O.keys=[""];for(var V1=O.treeNode;V1.level>0;V1=e.mRoutingTree[V1.parentRoute]){O.keys[V1.level]=V1.noKey?"":U1["keys"+V1.level];}}O.previousIdentity=j;O.componentsDisplayed=Object.create(null);O.componentsDisplayed[O.treeNode.sRouteName]=1;b1();}function e1(i,j){var S1={identity:{treeNode:O.treeNode,keys:O.keys,appStates:jQuery.extend(Object.create(null),O.appStates)},mode:1};if(jQuery.isArray(j)&&j.length<2){j=j[0];}if(j){S1.identity.appStates[i]=j;}else{delete S1.identity.appStates[i];}Z(S1);}function f1(i){var S1=r.determineNavigationPath(i);var T1={identity:{keys:["",S1.key],appStates:Object.create(null)},mode:1};var U1=Z.bind(null,T1);if(O.treeNode.level===1){T1.identity.treeNode=O.treeNode;jQuery.extend(T1.identity.appStates,O.appStates);return Promise.resolve(U1);}var V1=J(O.treeNode,2);var W1=V1.map(function(j){var Y1=K(j,O.keys);var Z1=e.oApplicationProxy.getSiblingPromise(Y1);return Z1.then(function(i){return i;},jQuery.noop);});var X1=Promise.all(W1);return X1.then(function(Y1){var Z1=e.mEntityTree[S1.entitySet];for(var j=0;Y1[j];j++){Z1=V1[j];S1=r.determineNavigationPath(Y1[j],Z1.navigationProperty);T1.identity.keys.push(S1.key);}T1.identity.treeNode=Z1;if(Z1===O.treeNode){jQuery.extend(T1.identity.appStates,O.appStates);return U1;}var $1=e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForColumnClose(Z1,T1.identity.appStates);return $1.then(function(){return U1;});});}function g1(i,j){if((i&&i.treeNode)!==j.treeNode){return Promise.resolve(false);}if(e.oFlexibleColumnLayoutHandler&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(i,j)){return Promise.resolve(false);}var S1=true;var T1=i.treeNode.sRouteName;for(var U1=i.treeNode;U1.level>0;U1=e.mRoutingTree[U1.parentRoute]){var V1=U1.noKey||i.keys[U1.level]===j.keys[U1.level];if(!V1&&U1.noOData){return Promise.resolve(false);}S1=S1&&V1;if(U1.noOData){T1=U1.parentRoute;}}if(S1){return Promise.resolve(true);}var W1=e.mRoutingTree[T1];var X1=i.keys.slice(0,W1.level+1);var Y1=j.keys.slice(0,W1.level+1);var Z1=K(W1,X1);var $1=K(W1,Y1);return e.oApplicationProxy.areTwoKnownPathesIdentical(Z1,$1,W1.level===1);}function h1(i,j){var S1=v[u.backTarget];var T1=-1;if(i.treeNode.level===0||(e.oFlexibleColumnLayoutHandler&&i.treeNode.fCLLevel===0)){for(;S1.backTarget>0&&S1.identity.treeNode.level>i.treeNode.level;T1--){S1=v[S1.backTarget];}}var U1=g1(S1.identity,i);var V1=U1.then(function(W1){var X1=W1?T1:(0+!!j);var Y1={identity:i,mode:X1};Z(Y1);});e.oBusyHelper.setBusy(V1);}function i1(j,S1){var T1={keys:[""]};if(j){var U1=r.determineNavigationPath(j,S1);T1.treeNode=e.mEntityTree[U1.entitySet];for(var i=1;i<T1.treeNode.level;i++){T1.keys.push(O.keys[i]);}T1.keys.push(U1.key);}else{T1.treeNode=e.mRoutingTree["root"];}return T1;}function j1(i,j){return(i.fCLLevel===0||i.fCLLevel===3)?D(i.componentId,null,j):e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForColumnClose(i,j);}function k1(i){var j=i1(i);j.appStates=Object.create(null);var S1;if(j.treeNode===O.treeNode){jQuery.extend(j.appStates,O.appStates);S1={identity:j,mode:1};Z(S1);return;}var T1=j1(j.treeNode,j.appStates);e.oBusyHelper.setBusy(T1.then(h1.bind(null,j,true)));}function l1(i){var j;var S1=0;for(j=u;j.backTarget>0&&(!j.identity||j.identity.treeNode.level>i);S1++){j=v[j.backTarget];}if(!s&&(S1===0||j.identity.treeNode.level>i)){window.history.go(-S1-1);return;}var T1=-S1||1;var U1=J1(i);var V1={treeNode:U1,keys:O.keys.slice(0,U1.level+1),appStates:Object.create(null)};var W1=j1(V1.treeNode,V1.appStates).then(function(){if(T1<0&&(V1.treeNode.fCLLevel===1||V1.treeNode.fCLLevel===2)&&j.identity.treeNode===V1.treeNode){for(;j.backTarget>0&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(j.identity,V1);T1--){j=v[j.backTarget];if(j.identity.treeNode!==V1.treeNode){break;}}}var X1={identity:V1,mode:T1};Z(X1);});e.oBusyHelper.setBusy(W1);}function m1(i){L.info("Navigate back");if(u.backTarget&&n(h.getPreviousHash()||"")!==n(u.hash)){e.oBusyHelper.setBusyReason("HashChange",true);}u.LeaveByBack=!u.forwardingInfo;if(u.LeaveByBack){u.backSteps=i;}window.history.go(-i);}function n1(j,S1,T1,U1){var V1=e.oAppComponent.getConfig();var W1=V1&&V1.settings&&V1.settings.objectPageDynamicHeaderTitleWithVM;if(!W1){if(V1&&V1.settings&&V1.settings.objectPageHeaderType==="Dynamic"){W1=(V1&&V1.settings&&V1.settings.objectPageVariantManagement==="VendorLayer")?true:false;}}var X1;var Y1=jQuery.sap.getUriParameters();if(Y1.mParams["sap-ui-layer"]){var Z1=Y1.mParams["sap-ui-layer"];for(var i=0;i<Z1.length;i++){if(Z1[i].toUpperCase()==="VENDOR"){X1=true;break;}}}j=n(j||"");L.info("Navigate to hash: "+j);if(j===u.hash){L.info("Navigation suppressed since hash is the current hash");return;}u.targetHash=j;if(u.backTarget&&n(h.getPreviousHash()||"")===j){m1(1);return;}if(u.oEvent){var $1=u.oEvent.getParameter("config").viewLevel;}if(W1&&X1){if(!U1){if(!e.oFlexibleColumnLayoutHandler){b.clearVariantParameterInURL();}else{if($1>=T1){if(T1===1){b.clearVariantParameterInURL();}else if(T1===2){var _1;for(var a2 in e.componentRegistry){if(e.componentRegistry[a2].viewLevel===2){_1=e.componentRegistry[a2];break;}}var b2=_1.oController.byId("template::ObjectPage::ObjectPageVariant");b.clearVariantParameterInURL(b2);}}}}}e.oBusyHelper.setBusyReason("HashChange",true);u.LeaveByReplace=S1;if(S1){q.oHashChanger.replaceHash(j);}else{q.oHashChanger.setHash(j);}}function o1(i,j,S1,T1,U1,V1){var W1=j.then(function(X1){i=g(i,X1);if(U1){u.backwardingInfo={count:U1.count,index:U1.index,targetHash:n(i)};m1(U1.count);}else{n1(i,T1,S1,V1);}return i;});e.oBusyHelper.setBusy(W1);return W1;}function p1(i,j){var S1,T1,U1,V1,W1,X1;S1=0;T1=u.iHashChangeCount;U1=null;for(V1=u;V1.oEvent;S1++){W1=V1.oEvent.getParameter("config");X1=W1?W1.viewLevel:-1;if(X1===0||(i&&n(V1.hash).indexOf(j)!==0)){U1={count:S1,index:T1,routeName:W1?W1.name:undefined};break;}if(V1.backTarget===0){if(i){U1={count:S1+1,index:T1,routeName:undefined};}break;}T1=V1.backTarget;V1=v[T1];}return U1;}function q1(i,j,S1){if(S1===0){return p1();}var T1=v[u.backTarget];return T1&&T1.hash&&n(T1.hash.split("?")[0])===n(j)&&{count:1,index:u.backTarget};}function r1(i){if(O.treeNode.level===0){return;}var j={treeNode:e.mRoutingTree["root"],keys:[""],appStates:Object.create(null)};var S1=e.oFlexibleColumnLayoutHandler?e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForColumnClose(j.treeNode,j.appStates):E("root",j.appStates);S1.then(h1.bind(null,j,i));e.oBusyHelper.setBusy(S1);}function s1(i){var j=e.mEntityTree[i.entitySet].sRouteName;var S1=e.mRouteToTemplateComponentPromise[j];return[S1];}function t1(j,S1){var T1=u.componentsDisplayed;var U1=function(W1){var X1=e.componentRegistry[W1.getId()];(X1.methods.presetDisplayMode||jQuery.noop)(S1,T1[X1.route]===1);};for(var i=0;i<j.length;i++){var V1=j[i];V1.then(U1);}}function u1(i){var j=i&&e.mEntityTree[i.entitySet];var S1=j?j.level:1;return S1;}function v1(j,S1){var T1=e.oApplicationProxy.getHierarchySectionsFromCurrentHash();var U1=j;for(var i=S1-2;i>=0;i--){U1=T1[i]+"/"+U1;}return"/"+U1;}function w1(i,j,S1,T1,U1){var V1={};var W1=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.getFCLAppStatesPromise(i,V1);var X1=E(i,V1,j);var Y1=(W1?Promise.all([W1,X1]):X1).then(A.bind(null,V1));var Z1=q1(T1,j,S1);var $1=o1(j,Y1,S1,T1,Z1,U1);e.oBusyHelper.setBusy($1);return $1;}function x1(i,j,S1,T1){var U1=v1(i,j);w1(S1,U1,j,T1);}function y1(j,S1,T1,U1,V1,W1){var X1;var Y1,Z1,$1;var _1=[];if(typeof j==="string"){X1=j;var a2=n(X1);if(a2==="/"){Y1=0;}else{$1=a2.split("/");Y1=$1.length-1;}switch(Y1){case 0:Z1="root";break;case 1:Z1=$1[1].split("(")[0];break;default:Z1="";var b2="";for(var i=0;i<Y1;i++){var c2=$1[i+1];var d2=c2.indexOf("(");if(d2>0){c2=c2.substring(0,d2);}Z1=Z1+b2+c2;b2="/";}Z1=Z1.replace("---","/");}}else{var e2=r.determineNavigationPath(j,S1);Y1=u1(e2);X1=e2.path;_1=s1(e2);Z1=e.mEntityTree[e2.entitySet].sRouteName;}if(S1){X1=v1(X1,Y1);}t1(_1,U1||0);if(V1){X1=k(X1,V1);n1(X1,T1,Y1,W1);return Promise.resolve(X1);}else{return w1(Z1,X1,Y1,T1,W1);}}function z1(i,j,S1,T1,U1){return y1(i,j,S1,T1,undefined,U1);}function A1(i,j){u.componentsDisplayed[i]=j;var S1=e.mRoutingTree[i];var T1=S1.componentId;if(T1){var U1=e.componentRegistry[T1];var V1=U1.utils.getTemplatePrivateModel();V1.setProperty("/generic/isActive",j===1);}}function B1(i){var j,S1,T1,U1,V1,W1=null,X1,Y1;if(i){j=i.entitySet;S1=i.text;W1=i.icon;Y1=i.description;}if(j){X1=e.oAppComponent.getModel().getMetaModel();if(X1){T1=X1.getODataEntitySet(j);U1=X1.getODataEntityType(T1.entityType);V1=U1["com.sap.vocabularies.UI.v1.HeaderInfo"];}if(V1&&V1.TypeImageUrl&&V1.TypeImageUrl.String){W1=V1.TypeImageUrl.String;}}e.oShellServicePromise.then(function(_1){if(_1.setBackNavigation){_1.setBackNavigation(undefined);}});e.oTemplatePrivateGlobalModel.setProperty("/generic/messagePage",{text:S1,icon:W1,description:Y1});if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.displayMessagePage(i,u.componentsDisplayed);}else{var Z1=q.oRouter.getTargets();Z1.display("messagePage");for(var $1 in u.componentsDisplayed){A1($1,5);}}F(i);}function C1(){if(!jQuery.isEmptyObject(M)){var j=null;for(var i=0;!j;i++){j=M[i];}M={};B1(j);}}function D1(i){if(q.oTemplateContract.oFlexibleColumnLayoutHandler){i.viewLevel=i.viewLevel||0;M[i.viewLevel]=i;var j=Promise.all([w,q.oTemplateContract.oPagesDataLoadedObserver.getProcessFinished(true)]);j.then(C1);j.then(e.oBusyHelper.setBusyReason.bind(null,"HashChange",false));return;}B1(i);e.oBusyHelper.setBusyReason("HashChange",false);}function E1(){var i=[];var j=O.componentsDisplayed||u.componentsDisplayed;for(var S1 in e.componentRegistry){var T1=e.componentRegistry[S1];if(j[T1.route]===1){i.push(S1);}}return i;}function F1(){var i=[];for(var j in e.componentRegistry){i.push(j);}return i;}function G1(i){return O.keys.slice(0,i+1);}function H1(j){var S1="";var T1=u.hash;var U1=T1.split("/");var V1="";for(var i=0;i<=j;i++){S1=S1+V1+U1[i];V1="/";}return S1;}function I1(){return u;}function J1(i){var j=O.treeNode;for(;j.level>i;){j=e.mRoutingTree[j.parentRoute];}return j;}function K1(i,j,S1){var T1=S1.getId();var U1=e.componentRegistry[T1];var V1=U1.route;var W1=j.componentsDisplayed[V1];var X1=W1===1;u.componentsDisplayed[V1]=1;var Y1=S1.onActivate(i,X1)||Promise.resolve();return Promise.all([Y1,U1.viewRegistered]).then(function(){U1.aKeys=G1(U1.viewLevel);});}function L1(i,j,S1){return K1(i,j,S1).then(I);}function M1(i,j,S1){var T1={};if(j||S1){var U1=i.level;for(var V1=0;V1<U1;V1++){T1[V1]=e.oPaginatorInfo[V1];}}e.oPaginatorInfo=T1;}function N1(i){return e.oApplicationProxy.getAlternativeContextPromise(i);}function O1(i){d1(i);O.preset=true;if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.handleBeforeRouteMatched(O);}}function P1(j){if(R&&R.followUpNeeded&&R.identity&&!W(R.identity)){Z();return;}e.oBusyHelper.setBusyReason("HashChange",false);var S1=O.treeNode.level;var T1=n(q.oHashChanger.getHash()||"");L.info("Route matched with hash "+T1);var U1;if(u.backwardingInfo){U1=u;U1.identity=O.previousIdentity;delete O.previousIdentity;v.push(U1);var V1=U1.iHashChangeCount+1;u={iHashChangeCount:V1,forwardingInfo:{bIsProgrammatic:true,bIsBack:true,iHashChangeCount:V1,targetHash:U1.backwardingInfo.targetHash,componentsDisplayed:U1.componentsDisplayed},backTarget:v[U1.backwardingInfo.index].backTarget,componentsDisplayed:Object.create(null)};}if(u.forwardingInfo&&u.forwardingInfo.targetHash&&u.forwardingInfo.targetHash!==T1){u.hash=T1;var W1=u.forwardingInfo.targetHash;delete u.forwardingInfo.targetHash;n1(W1,true);return;}var X1=false;for(var i=0;i<e.aStateChangers.length;i++){var Y1=e.aStateChangers[i];if(Y1.isStateChange(O.appStates)){X1=true;}}if(X1){R=null;u.hash=T1;return;}e.oTemplatePrivateGlobalModel.setProperty("/generic/routeLevel",S1);var Z1=u.forwardingInfo;delete u.forwardingInfo;if(!Z1){Z1={componentsDisplayed:u.componentsDisplayed};var $1=u.iHashChangeCount;Z1.iHashChangeCount=$1+1;var _1=h.getDirection();if(R){Z1.bIsProgrammatic=!!R.identity;Z1.bIsBack=R.mode<0;if(Z1.bIsBack){u.backSteps=0-R.mode;}Z1.bIsForward=!Z1.bIsBack&&(_1===d.Forwards);u.LeaveByReplace=R.mode===1;}else{Z1.bIsProgrammatic=(T1===u.targetHash);Z1.bIsBack=!!(u.LeaveByBack||(!Z1.bIsProgrammatic&&(_1===d.Backwards)));Z1.bIsForward=!Z1.bIsBack&&(_1===d.Forwards);u.LeaveByReplace=Z1.bIsProgrammatic&&u.LeaveByReplace;}u.LeaveByBack=Z1.bIsBack;U1=u;U1.identity=O.previousIdentity;delete O.previousIdentity;v.push(U1);u={iHashChangeCount:Z1.iHashChangeCount,componentsDisplayed:Object.create(null)};if(U1.LeaveByReplace){u.backTarget=U1.backTarget;}else if(Z1.bIsBack){var a2=U1.backTarget;for(var b2=U1.backSteps||1;b2>0;b2--){a2=v[a2].backTarget;}u.backTarget=a2;}else{u.backTarget=$1;}}R=null;u.oEvent=j;u.hash=T1;var c2=function(e2){var f2=j.getParameter("arguments");if(e2){var g2=f2["?query"];u.forwardingInfo=Z1;y1(e2.context,null,true,e2.iDisplayMode,g2||{});return;}M1(O.treeNode,Z1.bIsProgrammatic,Z1.bIsBack);if(e.oFlexibleColumnLayoutHandler){w=e.oFlexibleColumnLayoutHandler.handleRouteMatched(Z1);}else{if(S1===0||Z1.bIsBack||!Z1.bIsProgrammatic){e.oApplicationProxy.setEditableNDC(false);}var h2=e.mRouteToTemplateComponentPromise[O.treeNode.sRouteName];w=h2.then(function(i2){return L1(K(O.treeNode,O.keys),Z1,i2);});}e.oBusyHelper.setBusy(w);};if(Z1.bIsBack){var d2=K(J1(1),O.keys);e.oBusyHelper.setBusy(N1(d2).then(c2));}else{c2();}}function Q1(i){if(O&&O.preset){delete O.preset;}else{d1(i);}i=jQuery.extend({},i);var j=e.oStatePreserversAvailablePromise.then(P1.bind(null,i),e.oBusyHelper.setBusyReason.bind(null,"HashChange",false));e.oBusyHelper.setBusy(j);}function R1(){O={appStates:Object.create(null),keys:[]};D1({title:e.getText("ST_ERROR"),text:e.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:""});}if(e.sRoutingType==="f"){q.oRouter.attachBeforeRouteMatched(O1);}q.oRouter.attachRouteMatched(Q1);q.oRouter.attachBypassed(R1);q.concatPathAndAppStates=k;q.navigate=n1;q.activateOneComponent=K1;q.afterActivation=I;q.addUrlParameterInfoForRoute=E;q.getApplicableStateForComponentAddedPromise=D;q.setVisibilityOfRoute=A1;q.getActiveComponents=E1;q.getAllComponents=F1;q.getRootComponentPromise=y;q.getActivationInfo=I1;q.getCurrentKeys=G1;q.getCurrentHash=H1;q.getAppTitle=z;q.navigateToSuffix=x1;q.navigateByExchangingQueryParam=e1;q.getSwitchToSiblingPromise=f1;q.getCurrentIdentity=U;q.navigateToIdentity=h1;q.navigateAfterActivation=k1;q.navigateUpAfterDeletion=l1;q.getLinksToUpperLayers=c1;q.setTextForTreeNode=$;q.determinePathForKeys=K;q.createComponentInstance=l;return{navigateToRoot:r1,navigateToContext:z1,navigateToMessagePage:D1,navigateBack:m1.bind(null,1)};}function p(e,i){var j={oAppComponent:i.oAppComponent,oRouter:i.oAppComponent.getRouter(),oTemplateContract:i,oHashChanger:H.getInstance(),mRouteToComponentResolve:{}};i.oNavigationControllerProxy=j;var F=new Promise(function(R){j.fnInitializationResolve=R;});i.oBusyHelper.setBusy(F);jQuery.extend(e,m(i,j));jQuery.extend(j,e);j.oRouter._oViews._getViewWithGlobalId=function(v){v.viewName=v.name||v.viewName;for(var q in i.componentRegistry){if(i.componentRegistry[q].route===v.viewName){return i.componentRegistry[q].oComponent.getComponentContainer();}}var R=j.oRouter.getRoute(v.viewName);var s;if(R&&R._oConfig){s=l(i,R._oConfig,j.mRouteToComponentResolve[v.viewName]);}else{s=sap.ui.view({viewName:v.viewName,type:v.type,height:"100%"});}if(v.viewName==="root"){i.rootContainer=s;}return s.loaded();};r.startupRouter(j);}var N=B.extend("sap.suite.ui.generic.template.lib.NavigationController",{metadata:{library:"sap.suite.ui.generic.template"},constructor:function(e){B.apply(this,arguments);t.testableStatic(p,"NavigationController")(this,e);}});N._sChanges="Changes";return N;});
