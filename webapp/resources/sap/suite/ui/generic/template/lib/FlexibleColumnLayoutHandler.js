sap.ui.define(["sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library"],function(B,F,f){"use strict";var L=f.LayoutType;var r=Promise.resolve();var d=2;var c=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function t(i){return c[i]?i:d;}function g(i){return c[t(i)]+"ColumnPages";}function a(C){for(var i=0;i<c.length;i++){C(m[i],g(i));}}function b(v){return m[t(v)];}function e(i){return c[t(i)];}function h(T){var i;if(T instanceof sap.ui.table.Table){i=T.getRows();}else if(T instanceof sap.m.Table){i=T.getItems();}return i;}function j(T){var i=h(T);var R=i?i[0]:false;return R;}function k(s){return(s&&(jQuery.isArray(s.FCLLayout)?s.FCLLayout.sort()[0]:s.FCLLayout))||"";}function l(o,n){var M=n.oTemplateContract.oAppComponent.getConfig();var p=M.settings.flexibleColumnLayout;var q=F.getInstanceFor(o,p);var u;var C;var s;var v=-1;var T=n.oTemplateContract;var w=sap.ui.Device.system.phone?1:(p.maxColumnsCount||3);var x=w>1&&p.initialColumnsCount===2;var D=(function(){var i=q.getDefaultLayouts();return[x?i.defaultTwoColumnLayoutType:i.defaultLayoutType,i.defaultTwoColumnLayoutType,i.defaultThreeColumnLayoutType];})();var y=p.displayNextObjectAfterDelete===true;function z(i){return i.fCLLevel===1||i.fCLLevel===2||(i.level===0&&x);}function A(i){if(i.fCLLevel===3||(i.fCLLevel===0&&i.level>0)){return 1;}var q1=p.initialColumnsCount||1;var r1=Math.max(i.fCLLevel+1,q1);return sap.ui.Device.system.tablet&&r1>2?2:r1;}function E(i,q1,r1,s1){var t1=A(s1);i.showBeginColumn=s1.fCLLevel===0||t1>1;i.showMidColumn=s1.fCLLevel===1||t1>1;i.showEndColumn=s1.fCLLevel>1;if(t1===1){i.target=q1;}else if(s1.level===0){i.target=[q1,i.pages[0].entitySet];}else{i.target=r1.concat([q1]);}return g(s1.fCLLevel);}function G(i,q1){if(i===L.OneColumn&&x){return false;}var r1=q1&&T.mRoutingTree[q1];var s1=r1&&r1.defaultLayoutType;if(s1){return i===s1;}return i===D[0]||i===D[1]||i===D[2];}function H(i,q1,r1){var s1=T.mRouteToTemplateComponentPromise[r1];if(s1){return s1.then(function(t1){return n.activateOneComponent(q1,i,t1);});}return r;}function I(){var i=n.getCurrentIdentity();if(!i){return null;}var q1={};var r1=true;for(var s1=i.treeNode;r1;s1=T.mRoutingTree[s1.parentRoute]){var t1=s1.fCLLevel;var u1=e(t1);q1[u1]={route:s1.sRouteName,path:n.determinePathForKeys(s1,i.keys)||"",isVisible:t1>2||u.columnsVisibility[u1+"Column"]};r1=t1===1||t1===2;}return q1;}function J(i,q1){var r1=I();if(!r1){return Promise.resolve();}var s1=[];q1=q1||r1;for(var t1 in q1){var u1=r1[t1];if(u1.isVisible){s1.push(H(i,u1.path,u1.route));}else{var v1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");var w1=T.mRoutingTree[u1.route];var x1=(v1===w1.level)?2:(3+U(C));n.setVisibilityOfRoute(u1.route,x1);}}return Promise.all(s1).then(n.afterActivation);}function K(i){var q1=n.getActivationInfo();J(q1,i);}function N(){return!(u.columnsVisibility.beginColumn?u.columnsVisibility.midColumn:u.columnsVisibility.midColumn&&u.columnsVisibility.endColumn);}function O(i){var q1=q.getCurrentUIState();var r1={};r1.end=u&&(u.columnsVisibility.endColumn!==q1.columnsVisibility.endColumn);r1.mid=u&&(u.columnsVisibility.midColumn!==q1.columnsVisibility.midColumn);r1.begin=u&&(u.columnsVisibility.beginColumn!==q1.columnsVisibility.beginColumn);u=q1;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:u.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:u.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.endColumn.closeColumn!==null});var s1=n.getCurrentIdentity();var t1=s1&&s1.treeNode;if(s1){var u1=N();var v1=t1.level-(t1.fCLLevel===2&&!u.columnsVisibility.endColumn);var w1=v1-(v1>1&&!u1)-(u.columnsVisibility.endColumn&&u.columnsVisibility.beginColumn&&v1>2);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",u1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",v1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",w1);}if(s1&&C!==u.layout){var x1=G(u.layout,t1.sRouteName)?null:u.layout;n.navigateByExchangingQueryParam("FCLLayout",x1);}else if((r1.begin||r1.mid||r1.end)&&!i){K(r1);}}function P(i){if(z(i.treeNode)){C=R(i);if(!C){switch(i.treeNode.fCLLevel){case 0:var q1=q.getNextUIState(0).columnsVisibility;if(q1.midColumn){C=D[1];}else{C=D[0];n.navigateByExchangingQueryParam("FCLLayout",C);}break;case 1:C=D[1];break;case 2:C=D[2];}}}else{C=i.treeNode.fCLLevel===0?D[0]:L.EndColumnFullScreen;}o.setLayout(C);if(i.treeNode.fCLLevel===1||i.treeNode.fCLLevel===2){var r1=q.getCurrentUIState();if(r1.columnsVisibility.midColumn){var s1=1-r1.columnsVisibility.beginColumn;for(var t1=i.treeNode;t1.fCLLevel>s1;){t1=T.mRoutingTree[t1.parentRoute];i.componentsDisplayed[t1.sRouteName]=1;}}}}function Q(i){v=-1;O(true);return J(i);}function R(i){return k(i.appStates)||i.treeNode.defaultLayoutType||D[t(i.treeNode.fCLLevel)];}function S(i,q1){return G(i,q1)?{}:{FCLLayout:i};}function U(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function V(i){return i===L.ThreeColumnsBeginExpandedEndHidden||i===L.ThreeColumnsMidExpandedEndHidden;}function W(i,q1,r1,s1){if(!i.componentId){return;}var t1=null;var u1=n.getApplicableStateForComponentAddedPromise(i.componentId,t1,s1);r1.push(u1);}function X(i,q1,r1){var s1=S(q1,i.sRouteName);var t1=[];if(!V(q1)){W(i,r1,t1,s1);}if(!U(q1)){for(var u1=i;u1.fCLLevel>0;){u1=T.mRoutingTree[u1.parentRoute];W(u1,r1,t1,s1);}}return Promise.all(t1).then(function(){return s1;});}function Y(i,q1){var r1=i.fCLLevel===1?u.actionButtonsInfo.endColumn.closeColumn:L.OneColumn;jQuery.extend(q1,S(r1,i.sRouteName));var s1=[];for(var t1=i;t1;t1=t1.fCLLevel&&T.mRoutingTree[t1.parentRoute]){s1.push(n.addUrlParameterInfoForRoute(t1.sRouteName,q1));}return Promise.all(s1);}function Z(i){if(i===0){return L.OneColumn;}else if(i===1){return L.MidColumnFullScreen;}else if(i===2){return L.EndColumnFullScreen;}else{return"";}}function $(q1,r1){var s1=T.mRoutingTree[q1];if(!z(s1)){return null;}var t1=s||s1.defaultLayoutType||q.getNextUIState(s1.fCLLevel).layout;jQuery.extend(r1,S(t1,q1));s=null;if(U(t1)){return null;}var u1=[];for(var i=s1.fCLLevel;i>0;i--){var v1=s1.parentRoute;u1.push(n.addUrlParameterInfoForRoute(v1,r1));s1=T.mRoutingTree[v1];}return Promise.all(u1);}function _(i,q1){if(i.treeNode.fCLLevel===0||i.treeNode.fCLLevel===3){return true;}var r1=R(i);var s1=R(q1);return U(r1)===U(s1);}function a1(i,q1,r1){T.oApplicationProxy.performAfterSideEffectExecution(function(){var s1=e(i.fCLLevel);var t1=u.actionButtonsInfo[s1+"Column"][q1];var u1=r1?T.mRoutingTree[i.parentRoute]:i;var v1=n.getCurrentIdentity();var w1=X(u1,t1,v1.keys);var x1=w1.then(function(y1){n.navigateToIdentity({treeNode:u1,keys:(u1===v1.treeNode)?v1.keys:v1.keys.slice(0,u1.level+1),appStates:y1});});T.oBusyHelper.setBusy(x1);},true);}function b1(i){return{onCloseColumnPressed:a1.bind(null,i,"closeColumn",true),onFullscreenColumnPressed:a1.bind(null,i,"fullScreen",false),onExitFullscreenColumnPressed:a1.bind(null,i,"exitFullScreen",false)};}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function c1(i){var q1=T.mEntityTree[i.entitySet];var r1=T.oNavigationControllerProxy.getCurrentIdentity();var s1=r1.treeNode;return q1.level>s1.level;}function d1(i){C=q.getNextUIState(i).layout;o.setLayout(C);}function e1(){return!N();}function f1(i,q1){var r1=0;for(var s1 in q1){var t1=T.mRoutingTree[s1];if(t1.level>=i.viewLevel&&q1[s1]===1){if(t1.level===i.viewLevel){r1=t1.fCLLevel;}q1[s1]=5+(t1.level>i.viewLevel);}}v=t(r1);d1(r1);var u1=n.oRouter.getTargets();var v1=b(r1);u1.display(v1);}function g1(i){if(i<v||v<0){return u.columnsVisibility[e(i)+"Column"];}return false;}function h1(i,q1){if(!z(q1)){return;}var r1=Z(q1.fCLLevel);if(G(r1,q1.sRouteName)){return;}i.FCLLayout=r1;}function i1(i){return i.treeNode.fCLLevel!==0&&i.treeNode.fCLLevel!==3&&!U(R(i));}function j1(){return w;}function k1(i,q1){if(!x){return;}var r1=false;var s1=q.getNextUIState(0).columnsVisibility;if(s1.midColumn){var t1=n.getCurrentIdentity();var u1=t1&&t1.treeNode;r1=u1&&u1.level===0&&k(t1.appStates)!==L.OneColumn;}if(r1){if(i){q1(i);}else{n.navigateByExchangingQueryParam("FCLLayout",L.OneColumn);}}}function l1(){return y;}function m1(){return x;}function n1(i,q1){var r1=j(i);k1(r1,q1);}function o1(i){if(i>2){s="";}else{s=Z(i);}}function p1(i){var q1={};if(i.fCLLevel===1||i.fCLLevel===2){q1.oActionButtonHandlers=b1(i);}if(i.level===0){q1.handleDataReceived=(m1&&m1())?n1:jQuery.noop;q1.isListAndFirstEntryLoadedOnStartup=m1;}return q1;}o.attachStateChange(O.bind(null,false));return{adaptRoutingInfo:E,createMessagePageTargets:a,displayMessagePage:f1,isLevelActive:g1,handleBeforeRouteMatched:P,handleRouteMatched:Q,areIdentitiesLayoutEquivalent:_,getAppStatesPromiseForColumnClose:Y,getFCLAppStatesPromise:$,isNewHistoryEntryRequired:c1,adaptBreadCrumbUrlParameters:h1,isAppTitlePrefered:e1,hasNavigationMenuSelfLink:i1,getFullscreenLayout:Z,getMaxColumnCountInFCL:j1,isNextObjectLoadedAfterDelete:l1,getFclProxy:p1,isListAndFirstEntryLoadedOnStartup:m1,setStoredTargetLayoutToFullscreen:o1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(o,n){jQuery.extend(this,l(o,n));}});});
