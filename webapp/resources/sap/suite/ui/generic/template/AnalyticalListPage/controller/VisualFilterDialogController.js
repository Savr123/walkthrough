sap.ui.define(["sap/m/Button","sap/m/Label","sap/m/Dialog","sap/m/Bar","sap/m/SearchField","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/Title","sap/m/VBox","sap/m/HBox","sap/m/CheckBox","sap/m/Link","sap/m/List","sap/m/CustomListItem","sap/m/TextArea","sap/m/Text","sap/m/StandardListItem","sap/m/Popover","sap/ui/layout/form/SimpleForm","sap/ui/layout/GridData","sap/ui/core/mvc/Controller","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms",'sap/ui/model/Filter',"sap/suite/ui/generic/template/AnalyticalListPage/controller/DropDownController","sap/suite/ui/generic/template/AnalyticalListPage/controller/DatePickerController","sap/m/OverflowToolbarButton","sap/ui/model/json/JSONModel","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/ui/core/CustomData","sap/ui/Device","sap/m/library","sap/ui/core/library","sap/ui/model/FilterOperator","sap/m/DatePicker","sap/base/Log","sap/ui/core/InvisibleText","sap/base/util/deepEqual"],function(B,L,D,a,S,T,b,c,V,H,C,d,f,g,h,j,k,P,l,G,m,F,n,o,p,q,r,s,O,J,t,u,v,w,x,y,z,A,E,I,K){"use strict";var M=x.ListSeparators;var N="_BASIC";var Q="100%";var R=0.33;var U=0.5;var W=m.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController",{init:function(e){E.setLevel(E.Level.WARNING,"VisualFilter");this.oState=e;this.oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.bIsTimeBasedLine;this.bSortOrder;},_createForm:function(){this._searchTriggered=false;this._restoreTriggered=false;var e=new J();var i=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel');this._initialFilters=this.oState.alr_visualFilterBar.getModel("_filter").getJSON();this.oConfig=JSON.parse(i.getJSON());e.setData(this.oConfig);this.filterCompList=[];this.filterChartList=[];this._buildFiltersFromConfig(true);var _=new J();_.setData(JSON.parse(this._initialFilters));this.oVerticalBox=new V();this.oVerticalBox.setModel(this.oState.oController.getView().getModel("_templPriv"),"_templPriv");this.oVerticalBox.setModel(this.oState.oController.getView().getModel());this.oVerticalBox.setModel(this.oState.oController.getView().getModel("i18n"),"i18n");this.oVerticalBox.setModel(_,"_dialogFilter");this.oVerticalBox.setModel(e,'_visualFilterDialogModel');this._addFilterSwitch();this._addGroupsAndFilters();return this.oVerticalBox;},_toggle:function(){var e=this.oState.oSmartFilterbar.getFilterDialogContent();if(e&&(e.length===2)){if(e[0].getVisible()){e[0].setVisible(false);e[1].setVisible(true);e[1].getItems()[0].getContent()[1].addCustomData(new v({key:'isToggle',value:true}));if(this.oState.alr_visualFilterBar.getLazyLoadVisualFilter()){this.oState.alr_visualFilterBar.updateVisualFilterBindings.apply(this,[true,true]);}}else{e[0].setVisible(true);e[1].setVisible(false);e[0].getToolbar().getContent()[1].addCustomData(new v({key:'isToggle',value:true}));}}},_addFilterSwitch:function(){var e=[new o({icon:"sap-icon://filter-fields",width:"inherit",key:"compact",tooltip:"{i18n>FILTER_COMPACT}"}),new o({icon:"sap-icon://filter-analytics",width:"inherit",key:"visual",tooltip:"{i18n>FILTER_VISUAL}"})];var i=new n({width:"inherit",selectedKey:"visual",items:e}).addEventDelegate({onAfterRendering:function(Y){if(Y.srcControl.getCustomData()[0]&&Y.srcControl.getCustomData()[0].getValue()){Y.srcControl.focus();Y.srcControl.removeAllCustomData();}}});i.attachSelect(function(Y){var Z=Y.getSource();Z.setSelectedKey("visual");this._toggle();}.bind(this));var X=new t({design:x.ToolbarDesign.Transparent,content:[new b(),i]}).addStyleClass("sapSmartTemplatesAnalyticalListPageFilterDialogToolbar");this.oVerticalBox.addItem(X);},_searchDialog:function(){this._searchTriggered=true;},_updateFilterBarFromDialog:function(){var e=this.oState.alr_visualFilterBar.getModel('_filter'),i=this.oVerticalBox.getModel('_dialogFilter'),X=K(e.getJSON(),i.getJSON());if(!X){e.setData(JSON.parse(i.getJSON()));}var Y=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),Z=this._getDialogConfigModel(),$=K(Y.getJSON(),Z.getJSON());if(!$){Y.setData(JSON.parse(Z.getJSON()));this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}if(this.oState.alr_visualFilterBar.getLazyLoadVisualFilter()){this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}},_closeDialog:function(){if(this._searchTriggered){this._updateFilterBarFromDialog();if(this._restoreTriggered){this._restoreTriggered=false;this.oState.filterBarController._afterSFBVariantLoad();}}this.oVerticalBox.destroyItems();},_restoreDialog:function(){var e=this.oState.alr_visualFilterBar._oCurrentVariant.config;if(e){this.oConfig.filterCompList.forEach(function(i){if(e[i.component.properties.parentProperty]){jQuery.extend(true,i,e[i.component.properties.parentProperty]);}});}else{this.oConfig=this.oState.alr_visualFilterBar._getStandardVariantConfig();}this._getDialogConfigModel().setData(this.oConfig);this._reloadForm();this._restoreTriggered=true;},_buildFiltersFromConfig:function(e){var i;this.filterCompList=[];this.filterChartList=[];for(i=0;i<this.oConfig.filterCompList.length;i++){var X=this.oConfig.filterCompList[i].component.properties.sortOrder;if(X.constructor===Object&&X.value){this.oConfig.filterCompList[i].component.properties.sortOrder=X.value;}this.filterCompList.push({obj:{shownInFilterBar:this.oConfig.filterCompList[i].shownInFilterBar,shownInFilterDialog:this.oConfig.filterCompList[i].shownInFilterDialog,cellHeight:this.oConfig.filterCompList[i].cellHeight,component:{type:this.oConfig.filterCompList[i].component.type,cellHeight:this.oConfig.filterCompList[i].component.cellHeight},group:{label:this.oConfig.filterCompList[i].group.label,name:this.oConfig.filterCompList[i].group.name}},searchVisible:e===true||this.oConfig.filterCompList[i].searchVisible===undefined||this.oConfig.filterCompList[i].searchVisible});}},_rebuildConfig:function(){var i;var e={filterCompList:[]};for(i=0;i<this.filterCompList.length;i++){e.filterCompList.push({shownInFilterBar:this.filterCompList[i].obj.shownInFilterBar&&this.filterCompList[i].obj.shownInFilterDialog,shownInFilterDialog:this.filterCompList[i].obj.shownInFilterDialog,cellHeight:this.filterCompList[i].obj.cellHeight,group:{label:this.filterCompList[i].obj.group.label,name:this.filterCompList[i].obj.group.name},component:{type:this.filterCompList[i].obj.component.type,cellHeight:this.filterCompList[i].obj.component.cellHeight,properties:{scaleFactor:this.filterChartList[i].getScaleFactor(),numberOfFractionalDigits:this.filterChartList[i].getNumberOfFractionalDigits(),sortOrder:this.filterChartList[i].getSortOrder(),filterRestriction:this.oConfig.filterCompList[i].component.properties.filterRestriction,entitySet:this.filterChartList[i].getEntitySet(),isDropDown:this.oConfig.filterCompList[i].component.properties.isDropDown,width:this.oConfig.filterCompList[i].component.properties.width,height:this.oConfig.filterCompList[i].component.properties.height,dimensionField:this.filterChartList[i].getDimensionField(),dimensionFieldDisplay:this.filterChartList[i].getDimensionFieldDisplay(),dimensionFieldIsDateTime:this.filterChartList[i].getDimensionFieldIsDateTime(),dimensionFilter:this.filterChartList[i].getDimensionFilter(),unitField:this.filterChartList[i].getUnitField(),isCurrency:this.filterChartList[i].getIsCurrency(),isMandatory:this.oConfig.filterCompList[i].component.properties.isMandatory,measureField:this.filterChartList[i].getMeasureField(),outParameter:this.oConfig.filterCompList[i].component.properties.outParameter,inParameters:this.oConfig.filterCompList[i].component.properties.inParameters,parentProperty:this.oConfig.filterCompList[i].component.properties.parentProperty,chartQualifier:this.oConfig.filterCompList[i].component.properties.chartQualifier}}});}return e;},_reloadForm:function(){this.oVerticalBox.destroyItems();this._buildFiltersFromConfig();this._addFilterSwitch();this._addGroupsAndFilters();},_addGroupsAndFilters:function(){var i;var e;var X;var Y=[];var Z=0;for(i=0;i<this.filterCompList.length;i++){if(!Array.isArray(this.filterCompList[i])){if(this.filterCompList[i].searchVisible===false){continue;}if(!(Y.indexOf(this.filterCompList[i].obj.group.name)>-1)){if(X){this.oVerticalBox.addItem(X);}e=this.filterCompList[i].obj.group.name;Y.push(e);X=new f({showSeparators:"None",showNoData:false});X.setWidth("100%");X.setLayoutData(new G({span:"L12 M12 S12"}));X.addStyleClass("sapUiSmallMarginTop");Z++;this._addGroupToolbar(X,this.filterCompList[i].obj.group.label,this.filterCompList[i].obj.group.name);}if(this.filterCompList[i].obj.shownInFilterDialog){this.filterCompList[i].toolbar=this._addChartCustomToolbar(this.oConfig.filterCompList[i],i);this.filterCompList[i].overlay=this._addChartOverlay(this.oConfig.filterCompList[i],i);var $=this,_=new V(),a1=this.oConfig.filterCompList[i].component.properties.parentProperty;_.setModel(this._getDialogConfigModel(),'_visualFilterDialogModel');_.bindAggregation('items',{path:"_visualFilterDialogModel>/filterCompList",factory:function(b1,g1){var h1=g1.getProperty('component/type'),i1=g1.getProperty('component/properties'),j1=g1.getPath().split("/")[2];this.filterChartList[j1]=this._addChart(h1,i1,j1);return this.filterChartList[j1];}.bind(this),filters:new q("component/properties/parentProperty",z.EQ,a1)});var b1="visualFilterDialogInvisibleText"+this.filterChartList[i].getParentProperty();var c1=new I({id:b1});var d1=this.filterChartList[i].getParentProperty().replace(/[^\w]/gi,'')+"checkBox";var e1=[new V({items:[$.filterCompList[i].toolbar,$.filterCompList[i].overlay,_,c1]}).setWidth("100%").addStyleClass("sapUiSmallMarginEnd")];if(w.system.desktop){e1[0].setWidth("80%");e1.splice(1,0,new V({items:[new L({text:"{i18n>SHOW_ON_FILTER_BAR}",labelFor:d1,wrapping:true}).addStyleClass("sapUiTinyMarginTop"),new C({id:d1,text:"",selected:$.oConfig.filterCompList[i].shownInFilterBar}).data("idx",i).attachSelect(null,$._onCheckBoxSelect,$)]}).setAlignItems("Center"));e1[1].setWidth("20%");}var f1=new H({items:e1}).addStyleClass("sapUiSmallMarginTop").setWidth("100%");F._updateVisualFilterAria(f1.getItems()[0]);X.addItem(new g({content:f1}));}}if(X){this.oVerticalBox.addItem(X);}}if(Z==1&&e===N){F.executeFunction(X,"mAggregations.headerToolbar.setVisible",[false]);}},_onCheckBoxSelect:function(e){var i=e.getSource().data("idx");this.selectCheckBox(i,e.getSource().getSelected());},_addGroupToolbar:function(e,i,X){var Y=new c({text:i}).addStyleClass("sapSmartTemplatesAnalyticalListPageVFDialogGroupTitle");var Z=new T({content:[Y,new b()]});if(X!=N){Z.addContent(this._createMoreFiltersLink(X,Y));}e.setHeaderToolbar(Z);},selectCheckBox:function(i,e){var X=this._getDialogConfigModel();var Y=jQuery.extend(true,{},X);Y.setProperty('/filterCompList/'+i+'/shownInFilterBar',e);X.setData(Y.getData());this.oConfig=X.getData();this.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);},_addChartOverlay:function(e,i){var X=new V({width:"100%",height:e.component.properties.height,items:[new L({text:{path:'_visualFilterDialogModel>/filterCompList/'+i+'/overlayMessage',formatter:function(Y){return this.getModel("i18n").getResourceBundle().getText(Y);}},wrapping:true,textAlign:y.TextAlign.Center})],visible:{path:'_visualFilterDialogModel>/filterCompList/'+i+'/showChartOverlay',formatter:function(Y){return Y;}}});X.addStyleClass("sapUiOverlay");X.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflow");return X;},_formatTitle:function(e,i){var X=this.oVerticalBox.getModel("i18n").getResourceBundle();var Y=e.titleMD;var Z=e.titleUnitCurr;if(i==="tooltipMD"){return Z==""?Y:X.getText("VIS_FILTER_TITLE_MD_WITH_UNIT_CURR",[Y,Z]);}else if(i==="titleUnitCurr"){return Z.length>0?"| "+Z:"";}},_addChartCustomToolbar:function(e,i){var X=this;var Y=this.oState.oController.getView().getModel("@i18n");var Z=e.component.properties.parentProperty,$=e.component.properties,_=F.getPropertyNameDisplay(this.oState.alr_visualFilterBar.getModel(),e.component.properties.entitySet,e.component.properties.dimensionField,Y),a1=Z.replace(/[^\w]/gi,''),b1=this.oState.alr_visualFilterBar._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(e.component.properties.entitySet),c1=e.component.properties.sortOrder[0].Descending.Boolean,d1=F.readProperty(e,"component.type")==="Line"&&F.readProperty(e,"component.properties.dimensionFieldIsDateTime"),e1=this.oState.alr_visualFilterBar._resolveChartType(e.component.type),f1=this._getChartTypeIconLink(e1),rb=this.oVerticalBox.getModel("i18n").getResourceBundle(),h1=X._getChartTitle(e,i),i1=new c({text:h1.titleMD,tooltip:this._formatTitle(h1,"tooltipMD"),titleStyle:y.TitleLevel.H6}),j1=new c({text:this._formatTitle(h1,"titleUnitCurr"),tooltip:"",titleStyle:y.TitleLevel.H6});if(this.oConfig.filterCompList[i].component.properties.isMandatory){i1.addStyleClass("sapMLabelRequired");}var k1=function(){var g1=this.oConfig.filterCompList[i].component.properties.entitySet,v1=this._getVisibleMeasureList(g1),w1=Object.keys(v1).length>1;if(!w1){E.warning("Change measure button has been disabled in the dialog as only one visible measure exists in the collection "+g1,"","VisualFilter");}return w1;};var l1=this.oState.oSmartFilterbar.getControlByKey(e.component.properties.parentProperty);this.oState.oSmartFilterbar.ensureLoadedValueHelp(e.component.properties.parentProperty);var m1=l1.getShowValueHelp&&l1.getShowValueHelp()&&!$.dimensionFieldIsDateTimeOffset,n1=l1 instanceof A,o1=l1.getMetadata().getName()==="sap.m.DateTimePicker",p1=(n1&&!o1)?"sap-icon://appointment-2":"",q1=($.isDropDown)?"sap-icon://slim-arrow-down":"",r1=m1?"sap-icon://value-help":p1||q1,s1,t1=[new B({type:"Transparent",icon:"sap-icon://line-chart-time-axis",visible:false,press:function(g1){X._showLineChartTimeAxisPopup(g1);}}).data("idx",i),new B({type:"Transparent",icon:(m1||$.isDropDown||n1)?r1:"",visible:{path:"_dialogFilter>/"+Z,formatter:function(g1){if(m1||$.isDropDown||(n1&&!o1)){return true;}else{if(!g1){return false;}if(typeof g1==="object"){if(g1 instanceof Date){return true;}return(g1.value||(g1.items&&g1.items.length)||(g1.ranges&&g1.ranges.length))?true:false;}return true;}}},text:{path:"_dialogFilter>/"+Z,formatter:function(g1){var v1=X.filterChartList[i];var w1=v1.getFilterRestriction();s1=0;if(g1){if(w1==='single'){s1=1;}else{if(typeof g1==="object"){if(g1.value){s1++;}if(g1.items){s1+=g1.items.length;}if(g1.ranges){s1+=g1.ranges.length;}}else{s1++;}}}return s1?"("+s1+")":"";}},enabled:{path:'_visualFilterDialogModel>/filterCompList/'+i+'/showChartOverlay',formatter:function(g1){return!g1;}},press:function(g1){if(m1){l1.fireValueHelpRequest.call(l1);}else if($.isDropDown){var v1=X.oState.alr_visualFilterBar._isDimensionFieldFilterable(this.getModel(),$.entitySet,$.dimensionField),w1=this.getModel("visualFilter")||this.getModel();r.createDropdown(g1.getSource(),X.filterChartList[g1.getSource().data("idx")],w1,_,$,v1);}else if(n1&&!o1){s._createDatePicker(g1.getSource(),X.filterChartList[g1.getSource().data("idx")]);}else{sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController.launchAllFiltersPopup(g1.getSource(),X.filterChartList[g1.getSource().data("idx")],g1.getSource().getModel('i18n'));}},tooltip:{path:"_dialogFilter>/"+Z,formatter:function(){return F.getTooltipForValueHelp(m1,_,rb,s1,n1);}},layoutData:new u({priority:x.OverflowToolbarPriority.NeverOverflow})}).data("idx",i),new O({type:"Transparent",icon:(c1?"sap-icon://sort-descending":"sap-icon://sort-ascending"),visible:!d1,tooltip:"{i18n>VISUAL_FILTER_SORT_ORDER}",text:"{i18n>VISUAL_FILTER_SORT_ORDER}",press:function(g1){X._showChartSortPopup(g1);},layoutData:new u({closeOverflowOnInteraction:false,priority:(!w.system.desktop)?x.OverflowToolbarPriority.AlwaysOverflow:x.OverflowToolbarPriority.High})}).data("idx",i),new O({type:"Transparent",icon:f1,tooltip:"{i18n>VISUAL_FILTER_CHART_TYPE}",text:"{i18n>VISUAL_FILTER_CHART_TYPE}",press:function(g1){X._showChartTypesPopup(g1);},layoutData:new u({closeOverflowOnInteraction:false,priority:(!w.system.desktop)?x.OverflowToolbarPriority.AlwaysOverflow:x.OverflowToolbarPriority.High})}).data("idx",i),new O({id:"template::VisualFilterDialog::MeasureChangeButton::"+b1+"::"+a1,type:"Transparent",icon:"sap-icon://measure",tooltip:"{i18n>VISUAL_FILTER_MEASURE}",text:"{i18n>VISUAL_FILTER_MEASURE}",enabled:k1.apply(X),press:function(g1){X._showChartMeasuresPopup(g1);},layoutData:new u({closeOverflowOnInteraction:false,priority:(!w.system.desktop)?x.OverflowToolbarPriority.AlwaysOverflow:x.OverflowToolbarPriority.High})}).data("idx",i)];if((w.system.tablet||w.system.phone)&&!w.system.desktop){t1.splice(2,0,new C({tooltip:"{i18n>SHOW_ON_FILTER_BAR}",text:"{i18n>SHOW_ON_FILTER_BAR}",selected:X.oConfig.filterCompList[i].shownInFilterBar,layoutData:new u({closeOverflowOnInteraction:false,priority:x.OverflowToolbarPriority.AlwaysOverflow})}).data("idx",i).attachSelect(null,X._onCheckBoxSelect,X));t1[2].addStyleClass("sapSmartTemplatesAnalyticalListPageVFDShowInFilterBarCozy");}var u1=new t({design:x.ToolbarDesign.Transparent,content:[i1,j1,new b(),t1]}).addStyleClass("sapSmartTemplatesAnalyticalListPageFilterDialogTitleToolbar");u1.getContent()[0].addStyleClass("sapUiTinyMarginTop");u1.getContent()[0].addStyleClass("sapSmartTemplatesAnalyticalListPageVFDialogChartTitle");u1.getContent()[1].addStyleClass("sapUiTinyMarginTop");u1.setWidth("100%");return u1;},_addChart:function(X,Y,Z){var $;var _=this;var a1=Y.selectFilters&&Y.selectFilters.SelectOptions;var b1={selectFilters:Y.selectFilters,scaleFactor:Y.scaleFactor,numberOfFractionalDigits:Y.numberOfFractionalDigits,sortOrder:Y.sortOrder,filterRestriction:Y.filterRestriction,isDropDown:Y.isDropDown,width:Q,height:Y.height,labelWidthPercent:R,entitySet:Y.entitySet,dimensionField:Y.dimensionField,dimensionFieldDisplay:Y.dimensionFieldDisplay,dimensionFieldIsDateTime:Y.dimensionFieldIsDateTime,dimensionFieldIsDateTimeOffset:Y.dimensionFieldIsDateTimeOffset,unitField:Y.unitField,isCurrency:Y.isCurrency,isMandatory:Y.isMandatory,measureField:Y.measureField,dimensionFilter:Y.dimensionFilter,outParameter:Y.outParameter,inParameters:Y.inParameters,parentProperty:Y.parentProperty,textArrangement:Y.textArrangement,chartQualifier:Y.chartQualifier,lazyLoadVisualFilter:this.oState.alr_visualFilterBar.getLazyLoadVisualFilter()};var c1="/filterCompList/"+Z;if(X==="Donut"){b1.labelWidthPercent=U;}X=this.oState.alr_visualFilterBar._resolveChartType(X);var $=this.oState.alr_visualFilterBar._createFilterItemOfType(X,b1);$.data("isDialogFilterItem","true");$.setModel(this.oVerticalBox.getModel('_dialogFilter'),'_dialogFilter');$.setModel(this._getDialogConfigModel(),'_visualFilterDialogModel');$.data("idx",Z);$.addCustomData(new v({key:'sPath',value:c1}));if(b1.dimensionFieldIsDateTime){$.addCustomData(new v({key:'stringdate',value:Y.stringdate}));}$.bindProperty('visible',{path:'_visualFilterDialogModel>/filterCompList/'+Z+'/showChartOverlay',formatter:function(e){return!e;}});$.bindProperty('dimensionFilter',{path:'_dialogFilter>/'+$.getParentProperty()});var d1=$.getInParameters(),e1=[];if(d1&&d1.length>0){d1.forEach(function(e){e1.push({path:"_dialogFilter>/"+e.localDataProperty});});}if(_.oState.alr_visualFilterBar.getEntitySet()===$.getEntitySet()){var f1=_.oState.alr_visualFilterBar._smartFilterContext.determineMandatoryFilterItems();if(f1&&f1.length>0){f1.forEach(function(e){if(!e.data("isCustomField")){e1.push({path:'_dialogFilter>/'+e.getName()});}});}}if(e1&&e1.length>0){$.bindProperty('dimensionFilterExternal',{parts:e1,formatter:function(){var d1=this.getInParameters(),i1=this.getParentProperty();var j1,k1;if(_.oState.alr_visualFilterBar.getEntitySet()===this.getEntitySet()){var f1=_.oState.alr_visualFilterBar._smartFilterContext.determineMandatoryFilterItems();f1.forEach(function(z1){var A1=z1.getName();var B1=d1&&d1.some(function(e){return e.localDataProperty===A1;});if(A1.indexOf("$Parameter")===-1&&!B1){d1.push({localDataProperty:A1,valueListProperty:A1});}});}if(!(_.oState.alr_visualFilterBar.getEntitySet()===this.getEntitySet()&&_.oState.alr_visualFilterBar._smartFilterContext.getAnalyticBindingPath()!=="")&&(_.oState.alr_visualFilterBar._smartFilterContext.getAnalyticBindingPath()===""||_.oState.alr_visualFilterBar._smartFilterContext.getAnalyticBindingPath().indexOf("P_DisplayCurrency")!=-1)){var l1=this.getMeasureField();var m1=_.oState.alr_visualFilterBar.getModel();var n1=m1.getMetaModel();var o1=n1.getODataEntityType(_.oState.alr_visualFilterBar._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.getEntitySet()));var p1=n1.getODataEntitySet(this.getEntitySet());var q1=n1.getODataProperty(o1,l1);var r1=_.oState.alr_visualFilterBar.getProperty("displayCurrency");var s1=q1&&q1[p.ISOCurrency];if(r1&&s1){var t1=s1.Path;for(var u1=(d1.length-1);u1>-1;u1--){var v1=d1[u1].valueListProperty;var w1=d1[u1].localDataProperty;if(v1===t1){var x1=_.oState.alr_visualFilterBar._smartFilterContext.getFilterData();if(!x1[w1]){k1=n1.getODataProperty(o1,t1);var y1=k1&&F.isPropertyNonFilterable(p1,k1.name);if(!y1){j1=new q({aFilters:[new q({path:t1,operator:"EQ",value1:r1,value2:undefined})],and:false});}}break;}}}}return _.oState.alr_visualFilterBar._getFiltersForFilterItem(d1,i1,j1,t1,a1);}});}else if(a1&&a1.length>0){var g1=new q({aFilters:[],bAnd:true});for(var i in a1){var h1=a1[i];g1=this.oState.alr_visualFilterBar.fnAddSelectOptionsToFilters(h1,g1);}$.setProperty('dimensionFilterExternal',g1);}$.attachBeforeRebindVisualFilter(function(e){var i1=e.getParameters();var j1=i1.sEntityType;var k1=i1.sDimension;var l1=i1.sMeasure;var m1=i1.oContext;var n1=_.oState.oController;n1.onBeforeRebindVisualFilterExtension(j1,k1,l1,m1);});$._updateBinding();$._bAllowBindingUpdateOnPropertyChange=true;$.attachFilterChange(function(e){_.oState.alr_visualFilterBar.fireFilterChange();});$.attachTitleChange(function(e){var Z=e.getSource().data("idx");if(_.filterCompList[Z].toolbar.getContent().length>0){if(b1.isMandatory){_.filterCompList[Z].toolbar.getContent()[0].addStyleClass("sapMLabelRequired");}var i1=_.filterCompList[Z].toolbar.getContent()[0];var j1=_.filterCompList[Z].toolbar.getContent()[1];var k1=_._getChartTitle(_.filterCompList[Z].obj,Z);i1.setText(k1.titleMD);var l1=_._formatTitle(k1,"tooltipMD");i1.setTooltip(l1);j1.setText(_._formatTitle(k1,"titleUnitCurr"));var m1=k1.titleUnitCurr.split(" ");if(k1.titleUnitCurr==""){j1.setVisible(false);}else{j1.setVisible(true);var n1=m1.length>1?"4.15rem":"2.4rem";j1.setWidth(n1);}}if(_.filterChartList[Z].data("needsToUpdateAria")==="true"){F._updateVisualFilterAria(_.filterChartList[Z].getParent().getParent());}});return $;},_createMoreFiltersLink:function(e,X){var Y=this;var Z=0;var i;var $=new d();for(i=0;i<this.filterCompList.length;i++){if(this.filterCompList[i].searchVisible&&this.filterCompList[i].obj.group.name===e&&!this.filterCompList[i].obj.shownInFilterDialog){Z++;}}if(Z>0){$.setText(this.oRb.getText("FILTER_BAR_SHOW_MORE_FILTERS",[Z]));}else{$.setText(this.oRb.getText("FILTER_BAR_SHOW_CHANGE_FILTERS"));}$.attachPress(function(_){Y._createAddRemoveFiltersDialog(e,$);});if(X){$.addAriaLabelledBy(X);}return $;},_showChartMeasuresPopup:function(e){var i=this;var X=e.getSource().data("idx");var Y=this.filterChartList[X].getProperty("entitySet");var Z=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(e.getSource().getModel('i18n'),"VISUAL_FILTER_MEASURES");var $=e.getSource().getModel("@i18n");if($){Z.setModel($,"@i18n");}var _=new f({mode:x.ListMode.SingleSelectLeft,includeItemInSelection:true});_.data("idx",X);Z.addContent(_);var a1=this._getVisibleMeasureList(Y);_.addStyleClass("sapUiSizeCompact");if(a1){for(var b1 in a1){var c1=new k({title:a1[b1].label?a1[b1].label:a1[b1].name,tooltip:(a1[b1].fieldInfo&&a1[b1].fieldInfo.quickInfo)||a1[b1].label||a1[b1].name}).data("measureName",a1[b1].name);_.addItem(c1);if(this.filterChartList[X].getMeasureField()===a1[b1].name){_.setSelectedItem(c1);}}}_.attachSelectionChange(function(e){var X=e.getSource().data("idx"),d1=e.getSource().getSelectedItem().data("measureName");i.filterChartList[X].setProperty("unitField",a1[d1].fieldInfo.unit);var e1=i.filterCompList[X].toolbar.getContent()[0];var f1=i.filterCompList[X].toolbar.getContent()[1];var g1=i._getChartTitle(i.filterCompList[X].obj,X);e1.setText(g1.titleMD);f1.setText(i._formatTitle(g1,"titleUnitCurr"));i.oConfig.filterCompList[X].component.properties.measureField=d1;if(!i.filterChartList[X]._chart.getPoints){var h1=jQuery.extend(true,[],i.filterChartList[X].getSortOrder());h1[0].Field.String=d1;i.filterChartList[X].setSortOrder(h1);i._updateVisualFilterConfigModel(X,'/component/properties/sortOrder',h1);}var i1={bUpdateBinding:true,value:d1};i.filterChartList[X].setMeasureField(i1);i._updateVisualFilterConfigModel(X,'/component/properties/measureField',i1);i._updateVisualFilterConfigModel(X,'/component/properties/measureField',d1);i._updateVisualFilterConfigModel(X,'/component/properties/unitField',a1[d1].fieldInfo.unit);if(Z){Z.close();}});Z.attachAfterClose(function(){Z.destroy();Z=null;});Z.openBy(e.getSource());},_showChartTypesPopup:function(e){var X=this,Y=e.getSource(),Z=Y.getModel('i18n'),$=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(Z,"VISUAL_FILTER_CHART_TYPES"),_=this.oState.alr_visualFilterBar._getSupportedFilterItemList(),a1=[];for(var i=0;i<_.length;i++){var b1=_[i];var c1=new k({title:"{i18n>"+b1.textKey+"}",icon:b1.iconLink,selected:Y.getIcon()===b1.iconLink}).data("type",b1.type);a1.push(c1);}var d1=new f({mode:x.ListMode.SingleSelectMaster,items:a1});d1.data("button",Y);d1.addStyleClass("sapUiSizeCompact");d1.setModel(Z,"i18n");$.addContent(d1);d1.attachSelectionChange(function(e){var e1=e.getSource().data("button").data("idx"),f1=e.getSource().getSelectedItem().data("type"),g1=X.filterChartList[e1],h1=g1.getDimensionField(),i1=g1.getMeasureField(),j1=g1.getDimensionFieldIsDateTime(),k1=F.readProperty(X.oConfig,"filterCompList."+e1+".component.properties.sortOrder.0.Field.String"),l1=X._getDialogConfigModel(),m1=l1.getProperty('/filterCompList/'),n1=jQuery.extend(true,{},m1[e1]),o1=F.readProperty(n1,"component.properties.sortOrder.0.Field.String");e.getSource().data("button").setIcon(X._getChartTypeIconLink(f1));if(k1&&o1){if(f1==="Line"){X.oConfig.filterCompList[e1].component.properties.sortOrder[0].Field.String=h1;n1.component.properties.sortOrder[0].Field.String=h1;if(j1){X.bSortOrder=X.oConfig.filterCompList[e1].component.properties.sortOrder[0].Descending.Boolean;X.oConfig.filterCompList[e1].component.properties.sortOrder[0].Descending.Boolean=true;n1.component.properties.sortOrder[0].Descending.Boolean=true;X.bIsTimeBasedLine=true;}}else{X.oConfig.filterCompList[e1].component.properties.sortOrder[0].Field.String=i1;n1.component.properties.sortOrder[0].Field.String=i1;if(X.bIsTimeBasedLine){X.oConfig.filterCompList[e1].component.properties.sortOrder[0].Descending.Boolean=X.bSortOrder;n1.component.properties.sortOrder[0].Descending.Boolean=X.bSortOrder;X.bIsTimeBasedLine=false;}}}n1.component.type=f1;l1.setProperty('/filterCompList/'+e1,n1);X.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);X.oState.alr_visualFilterBar.updateVisualFilterBindings.apply(X,[true,true]);if($){$.close();}});$.attachAfterClose(function(){$.destroy();$=null;});$.openBy(e.getSource());},_showLineChartTimeAxisPopup:function(e){var i=e.getSource().data("idx");var X=e.getSource();var Y=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(e.getSource().getModel('i18n'),"VISUAL_FILTER_LINE_CHART_TIME_LINE");var Z=new f({mode:x.ListMode.SingleSelectLeft,items:[new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_DAYS}"}).data("idx",i),new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_MONTH}"}).data("idx",i),new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_QUARTERS}"}).data("idx",i),new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_YEARS}"}).data("idx",i)]});Z.data("button",X);Z.addStyleClass("sapUiSizeCompact");Y.addContent(Z);Z.attachSelectionChange(function(e){Y.close();});Y.attachAfterClose(function(){Y.destroy();Y=null;});Y.openBy(e.getSource());},_showChartSortPopup:function(e){var i=this;var X=e.getSource().data("idx");var Y=e.getSource();var Z=e.getSource().getModel('i18n');var $=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(Z,"VISUAL_FILTER_SORTING");var _=new f({mode:x.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new k({title:Z.getResourceBundle().getText("VISUAL_FILTER_SORTING_ASCENDING")}).data("idx",X),new k({title:Z.getResourceBundle().getText("VISUAL_FILTER_SORTING_DESCENDING")}).data("idx",X)]});_.data("button",Y);_.addStyleClass("sapUiSizeCompact");if(this.filterChartList[X].getSortOrder()[0].Descending.Boolean){_.setSelectedItem(_.getItems()[1],true);}else{_.setSelectedItem(_.getItems()[0],true);}$.addContent(_);_.attachSelectionChange(function(e){var Y=e.getSource().data("button");var X=Y.data("idx");var a1=jQuery.extend(true,[],i.filterChartList[X].getSortOrder());a1[0].Descending.Boolean=e.getSource().getItems()[1].isSelected();if(a1[0].Descending.Boolean){Y.setIcon("sap-icon://sort-descending");}else{Y.setIcon("sap-icon://sort-ascending");}var b1={bUpdateBinding:true,value:a1};i.filterChartList[X].setSortOrder(b1);i._updateVisualFilterConfigModel(X,'/component/properties/sortOrder',b1);i._updateVisualFilterConfigModel(X,'/component/properties/sortOrder',a1);if($){$.close();}});$.attachAfterClose(function(){$.destroy();$=null;});$.openBy(e.getSource());},_createAddRemoveFiltersDialog:function(e,X){var i;var Y=this;var Z=new D();Z.setTitle(this.oRb.getText("SELECT_FILTER_FIELDS"));Z.addStyleClass("sapUiPopupWithPadding");Z.addStyleClass("sapUiCompAddRemoveFilterDialog");Z.addStyleClass("sapUiSizeCompact");Z.setVerticalScrolling(true);var $=new a();var _=new S({placeholder:this.oRb.getText("FILTER_BAR_SEARCH")});this._oSearchField=_;_.attachLiveChange(function(e1){Y._onAddRemoveFiltersSearch(e1);});$.addContentRight(_);Z.setSubHeader($);this.addRemoveList=new f({mode:x.ListMode.MultiSelect});this.addRemoveList.setShowSeparators(M.None);Z.addContent(this.addRemoveList);for(i=0;i<this.filterCompList.length;i++){if(this.filterCompList[i].obj.group.name===e&&this.filterCompList[i].searchVisible){var a1=this._getChartTitle(this.filterCompList[i].obj,i,true);var b1=new k({title:a1.titleMD}).data("idx",i);this.addRemoveList.addItem(b1);if(this.filterCompList[i].obj.shownInFilterDialog){this.addRemoveList.setSelectedItem(b1,true);}}}this.addRemoveList.attachSelectionChange(function(e1){if(e1){var f1=e1.getParameters();if(f1){var b1=f1.listItem;var g1=b1.data("idx");if(b1){var h1={bVisible:f1.selected,propertyName:Y.oConfig.filterCompList[g1].component.properties.parentProperty};Y.oState.alr_visualFilterBar.fireFilterChange(h1);}}}});var c1=new B({text:this.oRb.getText("FORM_PERS_DIALOG_OK")});c1.attachPress(function(){var i;var e1=Y.addRemoveList.getItems();var f1=Y._getDialogConfigModel(),g1=jQuery.extend(true,{},f1);for(i=0;i<e1.length;i++){var h1=e1[i].data("idx");var i1=e1[i].isSelected();g1.setProperty('/filterCompList/'+h1+'/shownInFilterBar',i1);g1.setProperty('/filterCompList/'+h1+'/shownInFilterDialog',i1);}f1.setData(g1.getData());Y.oConfig=JSON.parse(f1.getJSON());Y.oState.alr_visualFilterBar.updateVisualFilterBindings.apply(this,[true,true]);Y.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);Y._reloadForm();Z.close();});Z.addAggregation("buttons",c1);Z.setInitialFocus(this._oSearchField);Z.setContentHeight("23.25rem");var d1=new B({text:this.oRb.getText("FORM_PERS_DIALOG_CANCEL"),press:function(){Z.close();}});Z.addAggregation("buttons",d1);Z.attachAfterClose(function(){Z.destroy();Z=null;});Z.open();},_onAddRemoveFiltersSearch:function(e){var i;if(!e){return;}var X=e.getParameters();if(!X){return;}var Y=(X.newValue?X.newValue:"").toLowerCase();var Z=this.addRemoveList.getItems();for(i=0;i<Z.length;i++){var $=(Z[i].getTitle()).toLowerCase();Z[i].setVisible($.indexOf(Y)>=0);}},_getChartTypeIconLink:function(i){var e=this.oState.alr_visualFilterBar._getSupportedFilterItemMap();var X=e[i];return!X?"":X.iconLink;},_getChartTitle:function(e,i,X){var Y=this.oState.oController.getView().getModel("@i18n");var Z="";if(this.filterChartList[i]){if(X){e.component.properties=this.filterChartList[i].getP13NConfig();Z=this.oState.alr_visualFilterBar.getTitleByFilterItemConfig(e);}else{Z=this.filterChartList[i].getTitle(Y);}}else{e.component.properties=this.oConfig.filterCompList[i].component.properties;Z=this.oState.alr_visualFilterBar.getTitleByFilterItemConfig(e);}return Z;},_adjustToolbarIcons:function(i){if(this.filterCompList[i].obj.component.type==="Line"){this.filterCompList[i].toolbar.getContent()[1].getItems()[1].setVisible(true);this.filterCompList[i].toolbar.getContent()[1].getItems()[2].setVisible(false);}else{this.filterCompList[i].toolbar.getContent()[1].getItems()[1].setVisible(false);this.filterCompList[i].toolbar.getContent()[1].getItems()[2].setVisible(true);}},_updateVisualFilterConfigModel:function(i,e,X,Y){var Z=this._getDialogConfigModel();Z.setProperty('/filterCompList/'+i+e,X);if(Y){var $=jQuery.extend(true,{},Z.getProperty('/filterCompList/'+i));Z.setProperty('/filterCompList/'+i,$);this.oState.alr_visualFilterBar.updateVisualFilterBindings.apply(this,[true,true]);}this.oConfig=Z.getData();this.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);},_getVisibleMeasureList:function(e){var i={},X=this.oState.alr_visualFilterBar._getMeasureMap()[e];for(var Y in X){var Z=X[Y];if(!(Z.fieldInfo[p.Hidden]&&Z.fieldInfo[p.Hidden].Bool==="true")){i[Z.name]=Z;}}return i;},_triggerSearchInFilterDialog:function(e){var i;if(!e){return;}var X=e.getParameters();if(!X){return;}var Y=(X.newValue?X.newValue:"").toLowerCase();for(i=0;i<this.oConfig.filterCompList.length;i++){var Z=this.oConfig.filterCompList[i].component.properties;var $=this._getChartTitle(this.oConfig.filterCompList[i],i).titleMD.toLowerCase();var _=this._getLabelForDimensionsAndMeasures(Z,Z.parentProperty),a1=this._getLabelForDimensionsAndMeasures(Z,Z.measureField),b1=(_.indexOf(Y)>=0)||(a1.indexOf(Y)>=0)||($.indexOf(Y)>=0);this.oConfig.filterCompList[i].searchVisible=b1;}this._reloadForm();},_getDialogConfigModel:function(){return this.oVerticalBox.getModel('_visualFilterDialogModel');},_getLabelForDimensionsAndMeasures:function(e,i){var X=this.oState.alr_visualFilterBar._oMetadataAnalyser,Y=this.oVerticalBox.getModel().getMetaModel(),Z=X.getEntityTypeNameFromEntitySetName(e.entitySet),$=Y.getODataEntityType(Z),_=Y.getODataProperty($,i)[p.Label];_=_&&_.String?_.String:"";return _;}});sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog=function(i,e){if(this._oPopoverDialog){this._oPopoverDialog.destroy();}this._oPopoverDialog=new P();this._oPopoverDialog.setTitle(i.getResourceBundle().getText(e));this._oPopoverDialog.setPlacement(sap.m.PlacementType.PreferredBottomOrFlip);this._oPopoverDialog.addStyleClass("sapUiPopupWithPadding");return this._oPopoverDialog;};sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList=function(e,X){var Y=new f({mode:x.ListMode.Delete}),Z,$=e.getFilterRestriction();Y.data("chart",e);if($==='multiple'){Z=jQuery.extend(true,{},e.getDimensionFilter());var _=(Z&&Z.items)?Z.items:undefined,a1=(Z&&Z.ranges)?Z.ranges:undefined,b1=(Z&&Z.value)?Z.value:null;Z=jQuery.extend(true,{},e.getDimensionFilter());if(_){for(var i=0;i<_.length;i++){var c1=new k({title:_[i].text?_[i].text:_[i].key});if(c1){c1.addCustomData(new v({key:'items',value:i}));}Y.addItem(c1);}}if(a1){for(var i=0;i<a1.length;i++){var c1=new k({title:a1[i].tokenText?a1[i].tokenText:F.createTitleFromCode(a1[i])});c1.addCustomData(new v({key:'ranges',value:i}));Y.addItem(c1);}}if(b1){var c1=new k({title:b1});c1.addCustomData(new v({key:'value'}));Y.addItem(c1);}}else{Y.addItem(new k({title:e.getDimensionFilter()}));}Y.attachDelete(function(d1){var e1=d1.getParameter("listItem"),f1=Y.data('chart'),g1;if($==='single'){g1=null;}else{g1=jQuery.extend(true,{},f1.getDimensionFilter());var h1=e1.getCustomData()[0],i1=h1.getKey(),j1=g1[i1];if(i1!=='value'){var k1=h1.getValue();j1.splice(k1,1);}else{g1.value=null;}}Y.removeItem(e1);f1.setDimensionFilter(g1);f1.fireFilterChange();X.removeContent(Y);var l1=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList(f1,X);if(l1.getItems().length>0){X.addContent(l1);X.focus();}else{X.close();}});return Y;};sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController.launchAllFiltersPopup=function(e,i,X){var Y=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(X,"VISUAL_FILTER_ALL_SELECTED_FILTERS"),Z=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList(i,Y);Y.addContent(Z);Y.addStyleClass("sapUiSizeCompact");Y.addStyleClass("sapSmartTemplatesAnalyticalListPageSelectedLinkDialog");var $=new a();var _=new B({text:X.getResourceBundle().getText("CLEAR_FILTERS_ALL"),press:function(a1){var b1=Z.data('chart'),c1=b1.getFilterRestriction(),d1;if(c1==='multiple'){d1=jQuery.extend(true,{},b1.getDimensionFilter());d1.items=[];d1.ranges=[];d1.value=null;}else{d1=null;}Y.removeContent(Z);b1.setDimensionFilter(d1);b1.fireFilterChange();Y.close();}});$.addContentRight(_);Y.setFooter($);Y.attachAfterClose(function(){Y.destroy();Y=null;});Y.openBy(e);};return W;});
