// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/ObjectPath","sap/ui/model/odata/v2/ODataModel"],function(O,a){"use strict";var P=function(s,p,b){var c=(O.get("config.serviceUrl",b)||"").replace(/\/?$/,"/");this._oODataModel=new a({serviceUrl:c,headers:{"sap-language":sap.ushell.Container.getUser().getLanguage(),"sap-client":(s&&s.getClient())||sap.ushell.Container.getLogonSystem().getClient()},defaultCountMode:"None",skipMetadataAnnotationParsing:true,useBatch:false});this._oEtags={};};P.prototype.getPages=function(){var p=this._readPages().then(function(b){for(var i=0;i<b.results.length;i++){this._storeETag(b.results[i]);}return b;}.bind(this)).then(this._convertODataToPageList).catch(this._rejectWithErrorMessage);return p;};P.prototype.getPage=function(p){var o=this._readPage(p).then(function(b){this._storeETag(b);return b;}.bind(this)).then(this._convertODataToReferencePage).catch(this._rejectWithErrorMessage);return o;};P.prototype.createPage=function(p){var o=this._convertReferencePageToOData(p);return this._createPage(o).then(this._storeETag.bind(this));};P.prototype.updatePage=function(p){var o=this._convertReferencePageToOData(p);o.modifiedOn=this._oEtags[p.content.id].modifiedOn;return this._createPage(o).then(this._storeETag.bind(this));};P.prototype.deletePage=function(p){var o=new Promise(function(r,b){this._oODataModel.remove("/pageSet('"+encodeURIComponent(p)+"')",{eTag:this._oEtags[p].etag,success:r,error:b});}.bind(this));return o;};P.prototype._readPages=function(){return new Promise(function(r,b){this._oODataModel.read("/pageSet",{success:r,error:b});}.bind(this));};P.prototype._readPage=function(p){var o=new Promise(function(r,b){this._oODataModel.read("/pageSet('"+encodeURIComponent(p)+"')",{urlParameters:{"$expand":"sections/tiles"},success:r,error:b});}.bind(this));return o;};P.prototype._createPage=function(p){var o=new Promise(function(r,b){this._oODataModel.create("/pageSet",p,{success:r,error:b});}.bind(this));return o;};P.prototype._convertODataToPageList=function(p){var b;b=p.results.map(function(c){return{content:{id:c.id,title:c.title,description:c.description,createdBy:c.createdBy,createdOn:c.createdOn,modifiedBy:c.modifiedBy,modifiedOn:c.modifiedOn},metadata:{devclass:c.devclass,transportId:c.transportId}};});return b;};P.prototype._convertODataToReferencePage=function(p){return{content:{id:p.id,title:p.title,description:p.description,createdBy:p.createdBy,createdOn:p.createdOn,modifiedBy:p.modifiedBy,modifiedOn:p.modifiedOn,sections:p.sections.results.map(function(s){return{id:s.id,title:s.title,visualizations:s.tiles.results.map(function(t){return{vizId:t.catalogTile,inboundPermanentKey:t.targetMapping};})};})},metadata:{transportId:p.transportId,devclass:p.devclass}};};P.prototype._convertReferencePageToOData=function(p){var r=p.content,m=p.metadata;var o={id:r.id,title:r.title,description:r.description,devclass:m.devclass,transportId:m.transportId,sections:(r.sections||[]).map(function(s){return{id:s.id,title:s.title,tiles:(s.visualizations||[]).map(function(t){return{catalogTile:t.vizId,targetMapping:t.inboundPermanentKey};})};})};return o;};P.prototype._storeETag=function(p){this._oEtags[p.id]={modifiedOn:p.modifiedOn,etag:p.__metadata.etag};};P.prototype._rejectWithErrorMessage=function(e){return Promise.reject(e.message);};return P;},true);
